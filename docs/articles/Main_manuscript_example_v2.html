<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using slimr to investigate the population genetics of the Sandy Inland Mouse in the periodic rainfall environment of the Simpson Desert • slimr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using slimr to investigate the population genetics of the Sandy Inland Mouse in the periodic rainfall environment of the Simpson Desert">
<meta property="og:description" content="slimr">
<meta property="og:image" content="https://rdinnager.github.io/slimr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">slimr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Custom_vis.html">Custom Live Plotting for SLiM</a>
    </li>
    <li>
      <a href="../articles/Main_manuscript_example_v2.html">Using slimr to investigate the population genetics of the Sandy Inland Mouse in the periodic rainfall environment of the Simpson Desert</a>
    </li>
    <li>
      <a href="../articles/multispecies.html">Advanced Example: Multispecies Model</a>
    </li>
    <li>
      <a href="../articles/simple_example_using_migration_and_fst.html">simple_example_using_migration_and_fst</a>
    </li>
    <li>
      <a href="../articles/installing_SLiM_for_slimr.html">How to Install SLiM for Use with slimr</a>
    </li>
    <li>
      <a href="../articles/simple_nucleotide_example.html">Simple Example of a Simulation using Nucleotides</a>
    </li>
    <li>
      <a href="../articles/slimrlang_intro.html">Introduction to slimr: Writing SLiM scripts from R</a>
    </li>
    <li>
      <a href="../articles/useful_tables.html">Useful slimr Tables</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rdinnager/slimr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Main_manuscript_example_v2_files/htmlwidgets-1.6.2/htmlwidgets.js"></script><link href="Main_manuscript_example_v2_files/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="Main_manuscript_example_v2_files/leaflet-1.3.1/leaflet.js"></script><link href="Main_manuscript_example_v2_files/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="Main_manuscript_example_v2_files/proj4-2.6.2/proj4.min.js"></script><script src="Main_manuscript_example_v2_files/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="Main_manuscript_example_v2_files/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="Main_manuscript_example_v2_files/leaflet-binding-2.2.1/leaflet.js"></script><script src="Main_manuscript_example_v2_files/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script><script src="Main_manuscript_example_v2_files/leaflet-providers-plugin-2.2.1/leaflet-providers-plugin.js"></script><link href="Main_manuscript_example_v2_files/HomeButton-0.0.1/home-button.css" rel="stylesheet">
<script src="Main_manuscript_example_v2_files/HomeButton-0.0.1/home-button.js"></script><script src="Main_manuscript_example_v2_files/HomeButton-0.0.1/easy-button-src.min.js"></script><script src="Main_manuscript_example_v2_files/clipboard-0.0.1/setClipboardText.js"></script><link href="Main_manuscript_example_v2_files/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet">
<link href="Main_manuscript_example_v2_files/mapviewCSS-0.0.1/mapview.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using slimr to investigate the population
genetics of the Sandy Inland Mouse in the periodic rainfall environment
of the Simpson Desert</h1>
                        <h4 data-toc-skip class="author">Russell
Dinnage</h4>
            
            <h4 data-toc-skip class="date">17/07/2023</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rdinnager/slimr/blob/HEAD/vignettes/articles/Main_manuscript_example_v2.Rmd" class="external-link"><code>vignettes/articles/Main_manuscript_example_v2.Rmd</code></a></small>
      <div class="hidden name"><code>Main_manuscript_example_v2.Rmd</code></div>

    </div>

    
    
<style type="text/css" scoped>
PRE.fansi SPAN {padding-top: .25em; padding-bottom: .25em};
</style>
<div class="section level2">
<h2 id="a-look-at-the-data">A look at the data<a class="anchor" aria-label="anchor" href="#a-look-at-the-data"></a>
</h2>
<p>An ongoing project in the Simpson Desert of central Australia is
producing genomic sequence data for small mammals and reptiles collected
over more than 30 years. We have some preliminary data from this project
for the Sandy Inland Mouse (<em>Pseudomys hermannsburgensis</em>) that
we’d like to use to explore, through data analysis and simulation, and
hopefully gain some insight into where this project might ultimately
take us. First let’s load all the packages we use in the example, and
then load the genetic data we will be working with. The data is stored
in an <code>.Rdata</code> file containing a <code>genlight</code>
object, which stores binary Single Nucleotide Polymorphism (SNP) data,
defined in the <code>adegenet</code> package. We also have demographic
data in the form of trap capture data (captures per 100 trap nights; see
<a href="https://www.researchgate.net/publication/281365144_Desert_complex_environments" class="external-link">Dickman
et al. 2014</a> and <a href="https://esajournals.onlinelibrary.wiley.com/doi/full/10.1002/ecs2.1343" class="external-link">Greenville
et al. 2016</a> for capture methods).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/mapview" class="external-link">mapview</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://conflicted.r-lib.org/" class="external-link">conflicted</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavisVaughan/furrr" class="external-link">furrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggforce.data-imaginist.com" class="external-link">ggforce</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gganimate.com" class="external-link">gganimate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tdhock/directlabels" class="external-link">directlabels</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/thibautjombart/adegenet" class="external-link">adegenet</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## install dependencies for dartR if you don't have them</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/zhengxwen/SNPRelate" class="external-link">"SNPRelate"</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://bioconductor.github.io/BiocManager/" class="external-link">"BiocManager"</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"BiocManager"</span><span class="op">)</span></span>
<span>  <span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://bioconductor.github.io/BiocManager/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"SNPRelate"</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://green-striped-gecko.github.io/dartR/" class="external-link">"dartR"</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"dartR"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## install slimr if you don't have it already</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://rdinnager.github.io/slimr">"slimr"</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://devtools.r-lib.org/" class="external-link">"devtools"</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span>  <span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"rdinnager/slimr"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://green-striped-gecko.github.io/dartR/" class="external-link">dartR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rdinnager.github.io/slimr">slimr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapviewOptions.html" class="external-link">mapviewOptions</a></span><span class="op">(</span>fgb <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## because filter function exists in multiple packages we use</span></span>
<span><span class="co">## the conflicted package to make sure we R uses the version in dplyr</span></span>
<span><span class="fu"><a href="https://conflicted.r-lib.org/reference/conflict_prefer.html" class="external-link">conflict_prefer</a></span><span class="op">(</span><span class="st">"filter"</span>, <span class="st">"dplyr"</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://conflicted.r-lib.org/reference/conflict_prefer.html" class="external-link">conflict_prefer</a></span><span class="op">(</span><span class="st">"select"</span>, <span class="st">"dplyr"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://conflicted.r-lib.org/reference/conflict_prefer.html" class="external-link">conflict_prefer</a></span><span class="op">(</span><span class="st">"initialize"</span>, <span class="st">"slimr"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## load data</span></span>
<span><span class="va">gen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/herm.rdata"</span>, package <span class="op">=</span> <span class="st">"slimr"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gen</span></span></code></pre></div>
<pre><code><span><span class="co">##  /// GENLIGHT OBJECT /////////</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  // 167 genotypes,  39,978 binary SNPs, size: 28.4 Mb</span></span>
<span><span class="co">##  1028248 (15.4 %) missing data</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  // Basic content</span></span>
<span><span class="co">##    @gen: list of 167 SNPbin</span></span>
<span><span class="co">##    @ploidy: ploidy of each individual  (range: 2-2)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  // Optional content</span></span>
<span><span class="co">##    @ind.names:  167 individual labels</span></span>
<span><span class="co">##    @loc.names:  39978 locus labels</span></span>
<span><span class="co">##    @loc.all:  39978 alleles</span></span>
<span><span class="co">##    @position: integer storing positions of the SNPs</span></span>
<span><span class="co">##    @pop: population of each individual (group size range: 2-39)</span></span>
<span><span class="co">##    @other: a list containing: loc.metrics  latlong  ind.metrics  loc.metrics.flags  verbose  history</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">abund_summ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/hermannsburg_abund.csv"</span>, package <span class="op">=</span> <span class="st">"slimr"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">abund_summ</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">## # A tibble: 408 × 3</span></span>
<span><span class="co">##    date       pop    abund</span></span>
<span><span class="co">##    &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">##  1 1990-03-01 MC     0.525</span></span>
<span><span class="co">##  2 1990-06-01 MC     0.926</span></span>
<span><span class="co">##  3 1990-08-01 MC     0.794</span></span>
<span><span class="co">##  4 1990-09-01 MC     3.24 </span></span>
<span><span class="co">##  5 1991-04-01 MC     4.17 </span></span>
<span><span class="co">##  6 1991-05-01 MC     3.11 </span></span>
<span><span class="co">##  7 1991-07-01 MC    15.4  </span></span>
<span><span class="co">##  8 1991-08-01 MC     8.73 </span></span>
<span><span class="co">##  9 1991-10-01 MC     2.28 </span></span>
<span><span class="co">## 10 1991-11-01 MC     6.94 </span></span>
<span><span class="co">## # ℹ 398 more rows</span></span></code></pre>
<p>So we have SNP sequences from 167 individuals taken over three years
and several different sites. Before we take a look at the genetic data,
let’s set the environmental context a bit. These small mammals live in
the Simpson Desert, an arid ecosystem characterized by long periods of
little rain, with occasional major rainfall events. These tend to occur
every 6-10 years. After rainfall events, the desert turns green, it can
be seen from space, and our analysis of satellite reflectance data
confirms massive spikes in productivity after these rainfalls. Plants
grow, flower and seed massively during these periods, and so food is
abundant for small mammals. We can see the regular pulse of rainfall
just by looking at the mammal abundances – <em>Pseudomys
hermannsburgensis</em> in particular responds quickly to rainfall. Let’s
look at our live trapping data on abundances to see this pattern.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">abund_summ</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">abund</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">pop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/directlabels/man/geom_dl.html" class="external-link">geom_dl</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">pop</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"last.qp"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">pop</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Main_manuscript_example_v2_files/figure-html/analyse_traps-1.png" width="80%"></p>
<p>Wow, those pulses are quite clear and quite extreme!</p>
<p>Okay, now let’s go have a look at the SNP data we have for these
populations.</p>
<p>First, we will extract the metadata for the genetic samples and have
a look at how they are distributed in the Simpson Desert.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span><span class="op">~</span><span class="va">pop</span>, <span class="op">~</span><span class="va">SiteName</span>,</span>
<span>                 <span class="st">"CS"</span>, <span class="st">"Carlo"</span>,</span>
<span>                 <span class="st">"FRN"</span>, <span class="st">"Field River North"</span>,</span>
<span>                 <span class="st">"FRS"</span>, <span class="st">"Field River South"</span>,</span>
<span>                 <span class="st">"KSE"</span>, <span class="st">"Kunnamuka Swamp East"</span>,</span>
<span>                 <span class="st">"MC"</span>, <span class="st">"Main Camp"</span>,</span>
<span>                 <span class="st">"SS"</span>, <span class="st">"South Site"</span>,</span>
<span>                 <span class="st">"WS"</span>, <span class="st">"Way Site"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">gen_meta</span> <span class="op">&lt;-</span> <span class="va">gen</span><span class="op">@</span><span class="va">other</span><span class="op">$</span><span class="va">ind.metrics</span></span>
<span></span>
<span><span class="va">gen_meta</span> <span class="op">&lt;-</span> <span class="va">gen_meta</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co">## fix some minor errors in genetic metadata with respect to site names:</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pop <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">pop</span> <span class="op">==</span> <span class="st">"FR"</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">SiteGrid</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>                         <span class="va">pop</span> <span class="op">==</span> <span class="st">"KS"</span> <span class="op">~</span> <span class="st">"KSE"</span>,</span>
<span>                         <span class="cn">TRUE</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">pop</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">sites</span><span class="op">)</span></span></code></pre></div>
<pre class="fansi fansi-message"><code><span><span class="co">## Joining with `by = join_by(pop)`</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gen_meta</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">## # A tibble: 167 × 18</span></span>
<span><span class="co">##    id         pop     id2 Date     year month timem Species SiteGrid Trap  Sex  </span></span>
<span><span class="co">##    &lt;chr&gt;      &lt;chr&gt; &lt;int&gt; &lt;fct&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;fct&gt;   &lt;fct&gt;    &lt;fct&gt; &lt;fct&gt;</span></span>
<span><span class="co">##  1 P_herm_121 KSE     121 16/05/…  2006     5     1 Pseudo… KSEAS    AS.32 "F"  </span></span>
<span><span class="co">##  2 P_herm_193 FRN     193 17/09/…  2007     9    17 Pseudo… FRN1     1.09  "F"  </span></span>
<span><span class="co">##  3 P_herm_201 KSE     201 13/09/…  2007     9    17 Pseudo… KSE1     1.28  "F"  </span></span>
<span><span class="co">##  4 P_herm_129 SS      129 26/05/…  2006     5     1 Pseudo… SS3      3.02  "M"  </span></span>
<span><span class="co">##  5 P_herm_137 FRS     137 22/05/…  2006     5     1 Pseudo… FRSU     U.30  "M"  </span></span>
<span><span class="co">##  6 P_herm_145 FRS     145 23/05/…  2006     5     1 Pseudo… FRSU     U.27  "M"  </span></span>
<span><span class="co">##  7 P_herm_153 MC      153 28/05/…  2006     5     1 Pseudo… MC2      2.31  "M"  </span></span>
<span><span class="co">##  8 P_herm_161 CS      161 20/09/…  2007     9    17 Pseudo… CS2G     2G.01 ""   </span></span>
<span><span class="co">##  9 P_herm_169 CS      169 20/09/…  2007     9    17 Pseudo… CSMTG    MTG.… ""   </span></span>
<span><span class="co">## 10 P_herm_177 CS      177 21/09/…  2007     9    17 Pseudo… CS2      2.03  ""   </span></span>
<span><span class="co">## # ℹ 157 more rows</span></span>
<span><span class="co">## # ℹ 7 more variables: id_site &lt;fct&gt;, comments &lt;fct&gt;, X &lt;lgl&gt;, lat &lt;dbl&gt;,</span></span>
<span><span class="co">## #   lon &lt;dbl&gt;, datum &lt;fct&gt;, SiteName &lt;chr&gt;</span></span></code></pre>
<p>Extract and plot site coordinates:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="va">gen_meta</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">pop</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>lon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lon</span><span class="op">)</span>,</span>
<span>            lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lat</span><span class="op">)</span>,</span>
<span>            .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html" class="external-link">mapview</a></span><span class="op">(</span><span class="va">coords</span>, label <span class="op">=</span> <span class="va">coords</span><span class="op">$</span><span class="va">pop</span>, map.types <span class="op">=</span> <span class="st">"Esri.WorldImagery"</span><span class="op">)</span></span></code></pre></div>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-8d32cfd9db97395c4a5f" style="width:80%;height:768px;"></div>
<script type="application/json" data-for="htmlwidget-8d32cfd9db97395c4a5f">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["point",440]},{"method":"addCircleMarkers","args":[[-23.48386778333333,-23.749485,-23.81992299047619,-23.36474702592593,-23.73895491692308,-23.84593485454545,-23.78158072105263],[138.5325783333333,138.01406,138.0638412952381,138.2654012407407,138.4718861564102,138.4012590909091,138.3631675368421],6,null,"coords",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"point","stroke":true,"color":"#333333","weight":1,"opacity":[0.9,0.9,0.9,0.9,0.9,0.9,0.9],"fill":true,"fillColor":["#4B0055","#353E7C","#007094","#009B95","#00BE7D","#96D84B","#FDE333"],"fillOpacity":[0.6,0.6,0.6,0.6,0.6,0.6,0.6]},null,null,["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>pop&emsp;<\/th><td>CS&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>pop&emsp;<\/th><td>FRN&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>3&emsp;<\/td><\/tr><tr><td>1<\/td><th>pop&emsp;<\/th><td>FRS&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>4&emsp;<\/td><\/tr><tr><td>1<\/td><th>pop&emsp;<\/th><td>KSE&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>5&emsp;<\/td><\/tr><tr><td>1<\/td><th>pop&emsp;<\/th><td>MC&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>6&emsp;<\/td><\/tr><tr><td>1<\/td><th>pop&emsp;<\/th><td>SS&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>7&emsp;<\/td><\/tr><tr><td>1<\/td><th>pop&emsp;<\/th><td>WS&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["CS","FRN","FRS","KSE","MC","SS","WS"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[138.01406,-23.84593485454545,138.5325783333333,-23.36474702592593,true,"coords","Zoom to coords","<strong> coords <\/strong>","bottomright"]},{"method":"addLayersControl","args":["Esri.WorldImagery","coords",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#4B0055","#353E7C","#007094","#009B95","#00BE7D","#96D84B","#FDE333"],"labels":["CS","FRN","FRS","KSE","MC","SS","WS"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"coords","extra":null,"layerId":null,"className":"info legend","group":"coords"}]}],"limits":{"lat":[-23.84593485454545,-23.36474702592593],"lng":[138.01406,138.5325783333333]},"fitBounds":[-23.84593485454545,138.01406,-23.36474702592593,138.5325783333333,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script><p>Looks like our sites cluster into roughly 3 spatial groups. For
simplicity we can merge these sites into 3 subpopulations, which will
make it a bit simpler for our simulation later.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coords_3</span> <span class="op">&lt;-</span> <span class="va">gen_meta</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>three_pop <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">pop</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MC"</span>, <span class="st">"SS"</span>, <span class="st">"WS"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"BR"</span>,</span>
<span>                               <span class="va">pop</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FRN"</span>, <span class="st">"FRS"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"BL"</span>,</span>
<span>                               <span class="va">pop</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"KSE"</span>, <span class="st">"CS"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"TR"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">three_pop</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>lon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lon</span><span class="op">)</span>,</span>
<span>         lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lat</span><span class="op">)</span>,</span>
<span>         .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html" class="external-link">mapview</a></span><span class="op">(</span><span class="va">coords_3</span>, label <span class="op">=</span> <span class="va">coords_3</span><span class="op">$</span><span class="va">three_pop</span>, map.types <span class="op">=</span> <span class="st">"Esri.WorldImagery"</span><span class="op">)</span></span></code></pre></div>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-d701554a25665d09d09f" style="width:80%;height:768px;"></div>
<script type="application/json" data-for="htmlwidget-d701554a25665d09d09f">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["point",440]},{"method":"addCircleMarkers","args":[[-23.78556299512195,-23.76774722985507,-23.42744216140351],[138.0395577365854,138.430689757971,138.4060207631579],6,null,"coords_3",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"point","stroke":true,"color":"#333333","weight":1,"opacity":[0.9,0.9,0.9],"fill":true,"fillColor":["#4B0055","#009B95","#FDE333"],"fillOpacity":[0.6,0.6,0.6]},null,null,["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>three_pop&emsp;<\/th><td>BL&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>three_pop&emsp;<\/th><td>BR&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>3&emsp;<\/td><\/tr><tr><td>1<\/td><th>three_pop&emsp;<\/th><td>TR&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["BL","BR","TR"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[138.0395577365854,-23.78556299512195,138.430689757971,-23.42744216140351,true,"coords_3","Zoom to coords_3","<strong> coords_3 <\/strong>","bottomright"]},{"method":"addLayersControl","args":["Esri.WorldImagery","coords_3",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#4B0055","#009B95","#FDE333"],"labels":["BL","BR","TR"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"coords_3","extra":null,"layerId":null,"className":"info legend","group":"coords_3"}]}],"limits":{"lat":[-23.78556299512195,-23.42744216140351],"lng":[138.0395577365854,138.430689757971]},"fitBounds":[-23.78556299512195,138.0395577365854,-23.42744216140351,138.430689757971,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script><p>As it happens these merged subpopulations are roughly equidistant,
arranged in a triangle. If we assume the terrain between them is
similarly easy to traverse we can simplify our model of the system even
more and assume that all else being equal these subpopulations should
have roughly similar migration rates between them. We called these
subpopulations “BR”, “BL”, and “TR”, for Bottom Right, Bottom Left, and
Top Right (creatively named I know).</p>
<p>Given this setup, let us have a look at the Fst values between these
three subpopulations over the three years. We will use a custom function
to calculate pairwise Fst for our subpopulations. We will do it this way
so we can show some <code>slimr</code> functionality later, where we can
exploit the similarity of R and SLiM code to run our Fst function from
within SLiM, and get fast and live Fst estimates while a simulation is
running. This means that the Fst calculated for our observed and our
simulated data will be directly comparable when we do our downstream
analysis.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim.mutationFrequencies</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">subpop</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">gen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="st">"gen"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://green-striped-gecko.github.io/dartR/reference/gl.alf.html" class="external-link">gl.alf</a></span><span class="op">(</span><span class="va">gen</span><span class="op">[</span>pop <span class="op">=</span> <span class="va">subpop</span><span class="op">]</span><span class="op">)</span><span class="op">[</span> , <span class="fl">2</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">isFinite</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.finite</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="va">calculateFST</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">subpop1</span>, <span class="va">subpop2</span><span class="op">)</span> <span class="op">{</span></span>
<span>                  <span class="co">## Calculate the FST between two subpopulations</span></span>
<span>                  <span class="va">p1_p</span> <span class="op">=</span> <span class="fu">sim.mutationFrequencies</span><span class="op">(</span><span class="va">subpop1</span><span class="op">)</span>;</span>
<span>                  <span class="va">p2_p</span> <span class="op">=</span> <span class="fu">sim.mutationFrequencies</span><span class="op">(</span><span class="va">subpop2</span><span class="op">)</span>;</span>
<span>                  <span class="va">mean_p</span> <span class="op">=</span> <span class="op">(</span><span class="va">p1_p</span> <span class="op">+</span> <span class="va">p2_p</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2.0</span>;</span>
<span>                  <span class="va">H_t</span> <span class="op">=</span> <span class="fl">2.0</span> <span class="op">*</span> <span class="va">mean_p</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1.0</span> <span class="op">-</span> <span class="va">mean_p</span><span class="op">)</span>;</span>
<span>                  <span class="va">H_s</span> <span class="op">=</span> <span class="va">p1_p</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1.0</span> <span class="op">-</span> <span class="va">p1_p</span><span class="op">)</span> <span class="op">+</span> <span class="va">p2_p</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1.0</span> <span class="op">-</span> <span class="va">p2_p</span><span class="op">)</span>;</span>
<span>                  <span class="va">fst</span> <span class="op">=</span> <span class="fl">1.0</span> <span class="op">-</span> <span class="va">H_s</span><span class="op">/</span><span class="va">H_t</span>;</span>
<span>                  <span class="va">fst</span> <span class="op">=</span> <span class="va">fst</span><span class="op">[</span><span class="fu">isFinite</span><span class="op">(</span><span class="va">fst</span><span class="op">)</span><span class="op">]</span>; <span class="co">## exclude muts where mean_p is 0.0 or 1.0</span></span>
<span>                  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">fst</span><span class="op">)</span><span class="op">)</span>;</span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">pairFST</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">gen</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">pops</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/adegenet/man/accessors.html" class="external-link">pop</a></span><span class="op">(</span><span class="va">gen</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">pop_pairs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/combn.html" class="external-link">combn</a></span><span class="op">(</span><span class="va">pops</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">pair_fst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">pop_pairs</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">calculateFST</span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">fst_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pops</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pops</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">fst_mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">fst_mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">pops</span></span>
<span>  <span class="va">fst_mat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">pop_pairs</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pair_fst</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">fst_mat</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>We used several custom functions above and named them so that they
would match available functions in SLiM. That way, when we run our
simulations using <code>slimr</code>, SLiM will use its optimized
versions of these functions internally. We also create a function to run
the pairwise Fst function on all possible subpopulation pairs, which we
will now run on our observed SNP data. We used a function in the
<code>dartR</code> package to calculate allele frequencies to use in our
Fst calculation. In SLiM, this is a builtin function, which we will take
advantage of later. Note that the use of <code>get</code> and
<code>parent.frame</code> is a trick to get R to use the right
<code>gen</code> object without having to specify it as an argument,
which will let us reuse the functions later in SLiM, which cannot access
R objects while it is running.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gen_meta</span> <span class="op">&lt;-</span> <span class="va">gen_meta</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>three_pop <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">pop</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MC"</span>, <span class="st">"SS"</span>, <span class="st">"WS"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"BR"</span>,</span>
<span>                               <span class="va">pop</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FRN"</span>, <span class="st">"FRS"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"BL"</span>,</span>
<span>                               <span class="va">pop</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"KSE"</span>, <span class="st">"CS"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"TR"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gen</span><span class="op">@</span><span class="va">other</span><span class="op">$</span><span class="va">ind.metrics</span> <span class="op">&lt;-</span> <span class="va">gen_meta</span> </span>
<span><span class="fu"><a href="https://rdrr.io/pkg/adegenet/man/accessors.html" class="external-link">pop</a></span><span class="op">(</span><span class="va">gen</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">gen_meta</span><span class="op">$</span><span class="va">three_pop</span></span>
<span></span>
<span><span class="co">## remove population we have genetic data for but no abundance data</span></span>
<span><span class="va">gen</span> <span class="op">&lt;-</span> <span class="va">gen</span><span class="op">[</span><span class="va">gen</span><span class="op">@</span><span class="va">other</span><span class="op">$</span><span class="va">ind.metrics</span><span class="op">$</span><span class="va">pop</span> <span class="op">!=</span> <span class="st">"WS"</span><span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="va">fst</span> <span class="op">&lt;-</span> <span class="fu">pairFST</span><span class="op">(</span><span class="va">gen</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fst</span></span></code></pre></div>
<pre><code><span><span class="co">##            TR        BL BR</span></span>
<span><span class="co">## TR         NA        NA NA</span></span>
<span><span class="co">## BL 0.01437133        NA NA</span></span>
<span><span class="co">## BR 0.01358429 0.0156385 NA</span></span></code></pre>
<p>That is the overall Fst, but we really want to know how that is
changing over our three sampling time points. We have three years of
data, which happen to span a major rainfall event, from 2006, 2007, and
2008, where there was a major rainfall event in 2007. Let’s look at the
pairwise Fst over the three years.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fst_by_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2006</span>, <span class="fl">2007</span>, <span class="fl">2008</span><span class="op">)</span>,</span>
<span>                   <span class="op">~</span><span class="fu">pairFST</span><span class="op">(</span><span class="va">gen</span><span class="op">[</span><span class="va">gen</span><span class="op">@</span><span class="va">other</span><span class="op">$</span><span class="va">ind.metrics</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="va">.x</span>, <span class="op">]</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">as.dist</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fst_by_year</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2006"</span>, <span class="st">"2007"</span>, <span class="st">"2008"</span><span class="op">)</span></span>
<span><span class="va">fst_by_year</span></span></code></pre></div>
<pre><code><span><span class="co">## $`2006`</span></span>
<span><span class="co">##            TR         BR         BL</span></span>
<span><span class="co">## TR 0.00000000 0.07423650 0.07492284</span></span>
<span><span class="co">## BR 0.07423650 0.00000000 0.04449832</span></span>
<span><span class="co">## BL 0.07492284 0.04449832 0.00000000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`2007`</span></span>
<span><span class="co">##            BL         TR         BR</span></span>
<span><span class="co">## BL 0.00000000 0.02405952 0.03053511</span></span>
<span><span class="co">## TR 0.02405952 0.00000000 0.02336933</span></span>
<span><span class="co">## BR 0.03053511 0.02336933 0.00000000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`2008`</span></span>
<span><span class="co">##            BL         BR         TR</span></span>
<span><span class="co">## BL 0.00000000 0.06184445 0.06037648</span></span>
<span><span class="co">## BR 0.06184445 0.00000000 0.04472136</span></span>
<span><span class="co">## TR 0.06037648 0.04472136 0.00000000</span></span></code></pre>
<p>We can visualize that over the three years:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fst_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">imap_dfr</a></span><span class="op">(</span><span class="va">fst_by_year</span>,</span>
<span>                   <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/utils/combn.html" class="external-link">combn</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BL"</span>, <span class="st">"BR"</span>, <span class="st">"TR"</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>pop1 <span class="op">=</span> <span class="va">V1</span>, pop2 <span class="op">=</span> <span class="va">V2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>fst <span class="op">=</span> <span class="va">.x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">pop1</span>, <span class="va">pop2</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                            year <span class="op">=</span> <span class="va">.y</span>,</span>
<span>                            pop_combo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">pop1</span>, <span class="va">pop2</span>, sep <span class="op">=</span> <span class="st">" to "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">fst_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">fst</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">pop_combo</span>, group <span class="op">=</span> <span class="va">pop_combo</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Main_manuscript_example_v2_files/figure-html/vis_fst-1.png" width="80%"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## save for later</span></span>
<span><span class="co">#write_rds(fst_df, "data/fst_df.rds")</span></span></code></pre></div>
<p>So we see that during the rainfall year a precipitous drop in Fst
occurs, which has only partially recovered the following year. But
perhaps before we proceed we should make sure this difference in Fst is
really more than what we would expect based on random variation. To do
this we will use a simple boostrapping approach.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## split populations by site and year to make it easier to bootstrap within</span></span>
<span><span class="va">pop_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/adegenet/man/accessors.html" class="external-link">pop</a></span><span class="op">(</span><span class="va">gen</span><span class="op">)</span>, <span class="va">gen</span><span class="op">@</span><span class="va">other</span><span class="op">$</span><span class="va">ind.metrics</span><span class="op">$</span><span class="va">year</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span>
<span><span class="va">gen_set_bs</span> <span class="op">&lt;-</span> <span class="va">gen</span> </span>
<span><span class="fu"><a href="https://rdrr.io/pkg/adegenet/man/accessors.html" class="external-link">pop</a></span><span class="op">(</span><span class="va">gen_set_bs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">pop_year</span><span class="op">)</span></span>
<span><span class="co">## resample 15 individuals (with replacement) for each year site combination</span></span>
<span><span class="va">gen_bs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fu"><a href="https://green-striped-gecko.github.io/dartR/reference/gl.sample.html" class="external-link">gl.sample</a></span><span class="op">(</span><span class="va">gen_set_bs</span>, nsample <span class="op">=</span> <span class="fl">15</span>, verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">## run pairwise Fst code on each bootstrap sample</span></span>
<span><span class="va">fst_bs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">gen_bs</span>,</span>
<span>              <span class="op">~</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2006"</span>, <span class="st">"2007"</span>, <span class="st">"2008"</span><span class="op">)</span>,</span>
<span>                   <span class="kw">function</span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="fu">pairFST</span><span class="op">(</span><span class="va">.x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="va">year</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/adegenet/man/accessors.html" class="external-link">pop</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">as.dist</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2006"</span>, <span class="st">"2007"</span>, <span class="st">"2008"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## convert to tibble</span></span>
<span><span class="va">fst_bs_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">fst_bs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">imap_dfr</a></span><span class="op">(</span><span class="va">x</span>,</span>
<span>                                                 <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/utils/combn.html" class="external-link">combn</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BL"</span>, <span class="st">"BR"</span>, <span class="st">"TR"</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                                                   <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                                                   <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                                                   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>pop1 <span class="op">=</span> <span class="va">V1</span>, pop2 <span class="op">=</span> <span class="va">V2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                                                   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pop_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">pop1</span>, <span class="va">.y</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span>,</span>
<span>                                                          pop_2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">pop2</span>, <span class="va">.y</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                                                   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>fst <span class="op">=</span> <span class="va">.x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">pop_1</span>, <span class="va">pop_2</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                                                          year <span class="op">=</span> <span class="va">.y</span>,</span>
<span>                                                          pop_combo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">pop1</span>, <span class="va">pop2</span>, sep <span class="op">=</span> <span class="st">" to "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/imap.html" class="external-link">imap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.x</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>rep <span class="op">=</span> <span class="va">.y</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_rbind</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## create fst ci</span></span>
<span><span class="va">fst_ci</span> <span class="op">&lt;-</span> <span class="va">fst_bs_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">pop_combo</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mean_fst <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">fst</span><span class="op">)</span>,</span>
<span>            ci_lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">fst</span>, <span class="fl">0.025</span><span class="op">)</span>,</span>
<span>            median_fst <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">fst</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>            ci_upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">fst</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="fansi fansi-message"><code><span><span class="co">## `summarise()` has grouped output by 'year'. You can override using the</span></span>
<span><span class="co">## `.groups` argument.</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## test year diffs</span></span>
<span><span class="va">fst_years_diffs</span> <span class="op">&lt;-</span> <span class="va">fst_bs_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">rep</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>fst <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">fst</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">rep</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>year_07_06 <span class="op">=</span> <span class="va">fst</span><span class="op">[</span><span class="va">year</span> <span class="op">==</span> <span class="st">"2006"</span><span class="op">]</span> <span class="op">-</span> <span class="va">fst</span><span class="op">[</span><span class="va">year</span> <span class="op">==</span> <span class="st">"2007"</span><span class="op">]</span>,</span>
<span>            year_08_06 <span class="op">=</span> <span class="va">fst</span><span class="op">[</span><span class="va">year</span> <span class="op">==</span> <span class="st">"2008"</span><span class="op">]</span> <span class="op">-</span> <span class="va">fst</span><span class="op">[</span><span class="va">year</span> <span class="op">==</span> <span class="st">"2006"</span><span class="op">]</span>,</span>
<span>            year_07_08 <span class="op">=</span> <span class="va">fst</span><span class="op">[</span><span class="va">year</span> <span class="op">==</span> <span class="st">"2008"</span><span class="op">]</span> <span class="op">-</span> <span class="va">fst</span><span class="op">[</span><span class="va">year</span> <span class="op">==</span> <span class="st">"2007"</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>year_07_06_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">year_07_06</span><span class="op">)</span>,</span>
<span>            year_07_06_lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">year_07_06</span>, <span class="fl">0.025</span><span class="op">)</span>,</span>
<span>            year_07_06_median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">year_07_06</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>            year_07_06_upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">year_07_06</span>, <span class="fl">0.975</span><span class="op">)</span>,</span>
<span>            year_08_06_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">year_08_06</span><span class="op">)</span>,</span>
<span>            year_08_06_lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">year_08_06</span>, <span class="fl">0.025</span><span class="op">)</span>,</span>
<span>            year_08_06_median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">year_08_06</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>            year_08_06_upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">year_08_06</span>, <span class="fl">0.975</span><span class="op">)</span>,</span>
<span>            year_07_08_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">year_07_08</span><span class="op">)</span>,</span>
<span>            year_07_08_lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">year_07_08</span>, <span class="fl">0.025</span><span class="op">)</span>,</span>
<span>            year_07_08_median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">year_07_08</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>            year_07_08_upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">year_07_08</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="fansi fansi-message"><code><span><span class="co">## `summarise()` has grouped output by 'year'. You can override using the</span></span>
<span><span class="co">## `.groups` argument.</span></span></code></pre>
<p>Here is the same plot as above but with bootstrapped errorbars with
95% confidence intervals.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">fst_ci</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">mean_fst</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">pop_combo</span>, group <span class="op">=</span> <span class="va">pop_combo</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">pop_combo</span>, group <span class="op">=</span> <span class="va">pop_combo</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">pop_combo</span>, group <span class="op">=</span> <span class="va">pop_combo</span>,</span>
<span>                    ymin <span class="op">=</span> <span class="va">ci_lower</span>, ymax <span class="op">=</span> <span class="va">ci_upper</span><span class="op">)</span>,</span>
<span>                width <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Main_manuscript_example_v2_files/figure-html/plot_bs-1.png" width="80%"></p>
<p>It is hard to tell whether these differences are meaningful, but the
<code>fst_years_diffs</code> has bootstrapped estimates of the mean
difference between years. Any confidence interval that does not overlap
zero consitutes evidence that there is a real difference between those
years.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">year_diff_df</span> <span class="op">&lt;-</span> <span class="va">fst_years_diffs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"label"</span>, values_to <span class="op">=</span> <span class="st">"fst_diff"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html" class="external-link">separate</a></span><span class="op">(</span><span class="va">label</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"chaff"</span>, <span class="st">"year_1"</span>, <span class="st">"year_2"</span>, <span class="st">"quant"</span><span class="op">)</span>, <span class="st">"_"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"20"</span>, <span class="va">year_1</span><span class="op">)</span>,</span>
<span>         year_2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"20"</span>, <span class="va">year_2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">chaff</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">quant</span>, values_from <span class="op">=</span> <span class="va">fst_diff</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>`Fst Difference` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">year_1</span>, <span class="st">" - "</span>, <span class="va">year_2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">year_diff_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">mean</span>, <span class="va">`Fst Difference`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_linerange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">lower</span>,</span>
<span>                     xmax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Main_manuscript_example_v2_files/figure-html/plot_year_diff-1.png" width="80%"></p>
<p>This suggests that indeed, on average, the populations in 2006 and
2008 were significantly higher in Fst than in the intervening year of
2007, but Fst was more or less equal when comparing 2008 to 2006. So a
significant drop in Fst followed by a full recovery the next year.</p>
<p>Now, can we think of a reason why this pattern might occur? We have a
hypothesis! First, we’ll lay it out, then we will interrogate its logic
using the simulation tools provided by <code>slimr</code>. Earlier on we
talked about how the desert “turns green” after a big rainfall event.
This implies it reverts back to dry or “red” sands afterwards. Generally
this is true, however, some patches remain relatively green during the
dry periods. These are sometimes know as mesic ‘refugia’. We
hypothesized that during dry periods, our mouse population recedes into
these separate refugia across the landscape, where they become
relatively reproductively isolated. This leads to an inexorable increase
in Fst due to a genetic drift without gene flow. Then, when the rain
comes, the whole landscape becomes wet, the mice come out to play,
spreading throughout, reproducing along the way. The subpopulations of
the refugia intermix, leading to an erasure of the genomic
differentiation that had been in progress during the dry years. But can
this mechanism lead to the level of observed change in such a short
period? Are there other possible mechanisms? Let’s explore these ideas
with simulation!</p>
</div>
<div class="section level2">
<h2 id="a-simple-simulation">A simple simulation<a class="anchor" aria-label="anchor" href="#a-simple-simulation"></a>
</h2>
<p>To begin setup a simple simulation that captures some of the features
of the system we are studying. We will simulate three subpopulations, as
we have in our data, and allow migration between them at equal rates. We
will include evolutionary processes such as mutation, selection, sexual
reproduction, and recombination as additional processes happening in our
simulation. Our initial question is simply, can we observe Fst values
that change through time in a manner consistent with our observed
changes using combinations of just these processes? Thanks to
<code>slimr</code>, we can continue and write out the logic of our
proposed simulation directly in R, using syntax very similar to SLiM
(&gt;3.0). We can additionally make the simulation code easy to update
with different parameter combinations to try out.</p>
<p>We will use the following parameters in our simulation:</p>
<table class="table">
<colgroup>
<col width="40%">
<col width="59%">
</colgroup>
<thead><tr class="header">
<th>Parameter</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>mut_rate</td>
<td>mutation rate of simulated population</td>
</tr>
<tr class="even">
<td>genome_size</td>
<td>size of simulated genome</td>
</tr>
<tr class="odd">
<td>selection_strength</td>
<td>mean strength of selection specified as a standard deviation of
selection coeffs</td>
</tr>
<tr class="even">
<td>migration_rates</td>
<td>rate of migration amongst three pops when abundance is high, must be
between 0 and 1</td>
</tr>
<tr class="odd">
<td>abund_threshold</td>
<td>abundance (before scaling) above which migration between populations
is “turned” on</td>
</tr>
<tr class="even">
<td>recomb_rate</td>
<td>recombination rate, a nuisance parameter</td>
</tr>
<tr class="odd">
<td>popsize_scaling</td>
<td>multiply observed abundances by this value to get total subpop
size</td>
</tr>
</tbody>
</table>
<p>It should be noted that the following simulation are for SLiM version
4.0 or greater. They should also work in SLiM &lt;4.0 by changing any
references to <code>sim.cycle</code> to <code>sim.generation</code>.</p>
<p>Now for the code:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">default_genome_size</span> <span class="op">&lt;-</span> <span class="fl">300000</span></span>
<span></span>
<span><span class="va">pop_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slim_script.html">slim_script</a></span><span class="op">(</span></span>
<span>  </span>
<span>  <span class="fu"><a href="../reference/slim_block.html">slim_block</a></span><span class="op">(</span><span class="fu"><a href="../reference/callback_initialize.html">initialize</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">{</span></span>
<span>    </span>
<span>    <span class="fu">setSeed</span><span class="op">(</span><span class="fl">12345</span><span class="op">)</span>;</span>
<span>    <span class="fu"><a href="../reference/initializeMutationRate.html">initializeMutationRate</a></span><span class="op">(</span><span class="fu"><a href="../reference/r_template.html">slimr_template</a></span><span class="op">(</span><span class="st">"mut_rate"</span>, <span class="fl">1e-6</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    <span class="fu"><a href="../reference/initializeMutationType.html">initializeMutationType</a></span><span class="op">(</span><span class="st">"m1"</span>, <span class="fl">0.5</span>, <span class="st">"n"</span>, <span class="fl">0</span>, <span class="fu"><a href="../reference/r_template.html">slimr_template</a></span><span class="op">(</span><span class="st">"selection_strength"</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    <span class="fu"><a href="../reference/initializeGenomicElementType.html">initializeGenomicElementType</a></span><span class="op">(</span><span class="st">"g1"</span>, <span class="va">m1</span>, <span class="fl">1.0</span><span class="op">)</span>;</span>
<span>    <span class="fu"><a href="../reference/initializeGenomicElement.html">initializeGenomicElement</a></span><span class="op">(</span><span class="va">g1</span>, <span class="fl">0</span>, <span class="fu"><a href="../reference/r_template.html">slimr_template</a></span><span class="op">(</span><span class="st">"genome_size"</span>, <span class="va">default_genome_size</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>;</span>
<span>    <span class="fu"><a href="../reference/initializeRecombinationRate.html">initializeRecombinationRate</a></span><span class="op">(</span><span class="fu"><a href="../reference/r_template.html">slimr_template</a></span><span class="op">(</span><span class="st">"recomb_rate"</span>, <span class="fl">1e-8</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    <span class="fu"><a href="../reference/initializeSex.html">initializeSex</a></span><span class="op">(</span><span class="st">"A"</span><span class="op">)</span>;</span>
<span>    <span class="fu">defineConstant</span><span class="op">(</span><span class="st">"abund"</span>, <span class="fu"><a href="../reference/r_inline.html">slimr_inline</a></span><span class="op">(</span><span class="va">pop_abunds</span>, delay <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    <span class="fu">defineConstant</span><span class="op">(</span><span class="st">"sample_these"</span>, <span class="fu"><a href="../reference/r_inline.html">slimr_inline</a></span><span class="op">(</span><span class="va">sample_these</span>, delay <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/slim_block.html">slim_block</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">init_pop</span> <span class="op">=</span> <span class="fu"><a href="../reference/r_inline.html">slimr_inline</a></span><span class="op">(</span><span class="va">init_popsize</span>, delay <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co">## set populations to initial size</span></span>
<span>    <span class="fu">sim.addSubpop</span><span class="op">(</span><span class="st">"p1"</span>, <span class="fu">asInteger</span><span class="op">(</span><span class="va">init_pop</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    <span class="fu">sim.addSubpop</span><span class="op">(</span><span class="st">"p2"</span>, <span class="fu">asInteger</span><span class="op">(</span><span class="va">init_pop</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    <span class="fu">sim.addSubpop</span><span class="op">(</span><span class="st">"p3"</span>, <span class="fu">asInteger</span><span class="op">(</span><span class="va">init_pop</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="fu"><a href="../reference/slim_block.html">slim_block</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="../reference/late.html">late</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">{</span></span>
<span>    <span class="co">## get starting population from a file which we will fill-in later</span></span>
<span>    <span class="fu">sim.readFromPopulationFile</span><span class="op">(</span><span class="fu"><a href="../reference/r_inline.html">slimr_inline</a></span><span class="op">(</span><span class="va">starting_pop</span>, delay <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    <span class="co">## migration on or off flags for pops 1-3 (using tag)</span></span>
<span>    <span class="va">p1.tag</span> <span class="op">=</span> <span class="fl">0</span>;</span>
<span>    <span class="va">p2.tag</span> <span class="op">=</span> <span class="fl">0</span>;</span>
<span>    <span class="va">p3.tag</span> <span class="op">=</span> <span class="fl">0</span>;</span>
<span>  <span class="op">}</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="fu"><a href="../reference/slim_block.html">slim_block</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1000</span>, <span class="fu"><a href="../reference/late.html">late</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">{</span></span>
<span>    </span>
<span>    <span class="co">## update generation number</span></span>
<span>    <span class="co">## note in SLiM versions &lt; 4.0, this would be sim.generation instead</span></span>
<span>    <span class="va">gen</span> <span class="op">=</span> <span class="va">sim.cycle</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">50</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">gen</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">gen</span> <span class="op">=</span> <span class="fl">50</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co">## set population size to observed levels</span></span>
<span>    <span class="fu">p1.setSubpopulationSize</span><span class="op">(</span><span class="fu">asInteger</span><span class="op">(</span><span class="fu">ceil</span><span class="op">(</span><span class="va">abund</span><span class="op">[</span><span class="fl">0</span>, <span class="va">gen</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="../reference/r_template.html">slimr_template</a></span><span class="op">(</span><span class="st">"popsize_scaling"</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    <span class="fu">p2.setSubpopulationSize</span><span class="op">(</span><span class="fu">asInteger</span><span class="op">(</span><span class="fu">ceil</span><span class="op">(</span><span class="va">abund</span><span class="op">[</span><span class="fl">1</span>, <span class="va">gen</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">..popsize_scaling..</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    <span class="fu">p3.setSubpopulationSize</span><span class="op">(</span><span class="fu">asInteger</span><span class="op">(</span><span class="fu">ceil</span><span class="op">(</span><span class="va">abund</span><span class="op">[</span><span class="fl">2</span>, <span class="va">gen</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">..popsize_scaling..</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    </span>
<span>    <span class="co">## increase migration when above abundance threshold</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">p1.tag</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">abund</span><span class="op">[</span><span class="fl">0</span>, <span class="va">gen</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fu"><a href="../reference/r_template.html">slimr_template</a></span><span class="op">(</span><span class="st">"abund_threshold"</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">p2.setMigrationRates</span><span class="op">(</span><span class="va">p1</span>, <span class="fu"><a href="../reference/r_template.html">slimr_template</a></span><span class="op">(</span><span class="st">"migration_rate"</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="fu">p3.setMigrationRates</span><span class="op">(</span><span class="va">p1</span>, <span class="va">..migration_rate..</span><span class="op">)</span></span>
<span>      <span class="va">p1.tag</span> <span class="op">=</span> <span class="fl">1</span>;</span>
<span>    <span class="op">}</span> </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">p1.tag</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">abund</span><span class="op">[</span><span class="fl">0</span>, <span class="va">gen</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="va">..abund_threshold..</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">p2.setMigrationRates</span><span class="op">(</span><span class="va">p1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>      <span class="fu">p3.setMigrationRates</span><span class="op">(</span><span class="va">p1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>      <span class="va">p1.tag</span> <span class="op">=</span> <span class="fl">0</span>;</span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">p2.tag</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">abund</span><span class="op">[</span><span class="fl">1</span>, <span class="va">gen</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">..abund_threshold..</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">p1.setMigrationRates</span><span class="op">(</span><span class="va">p2</span>, <span class="va">..migration_rate..</span><span class="op">)</span></span>
<span>      <span class="fu">p3.setMigrationRates</span><span class="op">(</span><span class="va">p2</span>, <span class="va">..migration_rate..</span><span class="op">)</span></span>
<span>      <span class="va">p2.tag</span> <span class="op">=</span> <span class="fl">1</span>;</span>
<span>    <span class="op">}</span> </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">p2.tag</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">abund</span><span class="op">[</span><span class="fl">1</span>, <span class="va">gen</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="va">..abund_threshold..</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">p1.setMigrationRates</span><span class="op">(</span><span class="va">p2</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>      <span class="fu">p3.setMigrationRates</span><span class="op">(</span><span class="va">p2</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>      <span class="va">p2.tag</span> <span class="op">=</span> <span class="fl">0</span>;</span>
<span>    <span class="op">}</span>    </span>
<span>    </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">p3.tag</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">abund</span><span class="op">[</span><span class="fl">2</span>, <span class="va">gen</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">..abund_threshold..</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">p1.setMigrationRates</span><span class="op">(</span><span class="va">p3</span>, <span class="va">..migration_rate..</span><span class="op">)</span></span>
<span>      <span class="fu">p2.setMigrationRates</span><span class="op">(</span><span class="va">p3</span>, <span class="va">..migration_rate..</span><span class="op">)</span></span>
<span>      <span class="va">p3.tag</span> <span class="op">=</span> <span class="fl">1</span>;</span>
<span>    <span class="op">}</span> </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">p3.tag</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">abund</span><span class="op">[</span><span class="fl">2</span>, <span class="va">gen</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="va">..abund_threshold..</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">p1.setMigrationRates</span><span class="op">(</span><span class="va">p3</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>      <span class="fu">p2.setMigrationRates</span><span class="op">(</span><span class="va">p3</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>      <span class="va">p3.tag</span> <span class="op">=</span> <span class="fl">0</span>;</span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="fu"><a href="../reference/slim_block.html">slim_block</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fu"><a href="../reference/late.html">late</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">{</span></span>
<span>    <span class="fu">slimr_output_full</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">pop_sim</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">## &lt;slimr_script[5]&gt;</span></span>
<span><span class="co">## block_init:initialize() {</span></span>
<span><span class="co">##     setSeed(12345);</span></span>
<span><span class="co">##     initializeMutationRate(..mut_rate..);</span></span>
<span><span class="co">##     initializeMutationType("m1", 0.5, "n", 0, ..selection_strength..);</span></span>
<span><span class="co">##     initializeGenomicElementType("g1", m1, 1);</span></span>
<span><span class="co">##     initializeGenomicElement(g1, 0, ..genome_size.. - 1);</span></span>
<span><span class="co">##     initializeRecombinationRate(..recomb_rate..);</span></span>
<span><span class="co">##     initializeSex("A");</span></span>
<span><span class="co">##     defineConstant("abund", r_inline(pop_abunds));</span></span>
<span><span class="co">##     defineConstant("sample_these", r_inline(sample_these));</span></span>
<span><span class="co">## }</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## block_2:1 early() {</span></span>
<span><span class="co">##     init_pop = r_inline(init_popsize);</span></span>
<span><span class="co">##     sim.addSubpop("p1", asInteger(init_pop[0]));</span></span>
<span><span class="co">##     sim.addSubpop("p2", asInteger(init_pop[1]));</span></span>
<span><span class="co">##     sim.addSubpop("p3", asInteger(init_pop[2]));</span></span>
<span><span class="co">## }</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## block_3:1 late() {</span></span>
<span><span class="co">##     sim.readFromPopulationFile(r_inline(starting_pop));</span></span>
<span><span class="co">##     p1.tag = 0;</span></span>
<span><span class="co">##     p2.tag = 0;</span></span>
<span><span class="co">##     p3.tag = 0;</span></span>
<span><span class="co">## }</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## block_4:1:1000 late() {</span></span>
<span><span class="co">##     gen = sim.cycle%%50;</span></span>
<span><span class="co">##     if (gen == 0) {</span></span>
<span><span class="co">##         gen = 50;</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##     p1.setSubpopulationSize(asInteger(ceil(abund[0, gen - 1] * ..popsize_scaling..)));</span></span>
<span><span class="co">##     p2.setSubpopulationSize(asInteger(ceil(abund[1, gen - 1] * ..popsize_scaling..)));</span></span>
<span><span class="co">##     p3.setSubpopulationSize(asInteger(ceil(abund[2, gen - 1] * ..popsize_scaling..)));</span></span>
<span><span class="co">##     if (p1.tag == 0 &amp; abund[0, gen - 1] &gt; ..abund_threshold..) {</span></span>
<span><span class="co">##         p2.setMigrationRates(p1, ..migration_rate..);</span></span>
<span><span class="co">##         p3.setMigrationRates(p1, ..migration_rate..);</span></span>
<span><span class="co">##         p1.tag = 1;</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##     if (p1.tag == 1 &amp; abund[0, gen - 1] &lt;= ..abund_threshold..) {</span></span>
<span><span class="co">##         p2.setMigrationRates(p1, 0);</span></span>
<span><span class="co">##         p3.setMigrationRates(p1, 0);</span></span>
<span><span class="co">##         p1.tag = 0;</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##     if (p2.tag == 0 &amp; abund[1, gen - 1] &gt; ..abund_threshold..) {</span></span>
<span><span class="co">##         p1.setMigrationRates(p2, ..migration_rate..);</span></span>
<span><span class="co">##         p3.setMigrationRates(p2, ..migration_rate..);</span></span>
<span><span class="co">##         p2.tag = 1;</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##     if (p2.tag == 1 &amp; abund[1, gen - 1] &lt;= ..abund_threshold..) {</span></span>
<span><span class="co">##         p1.setMigrationRates(p2, 0);</span></span>
<span><span class="co">##         p3.setMigrationRates(p2, 0);</span></span>
<span><span class="co">##         p2.tag = 0;</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##     if (p3.tag == 0 &amp; abund[2, gen - 1] &gt; ..abund_threshold..) {</span></span>
<span><span class="co">##         p1.setMigrationRates(p3, ..migration_rate..);</span></span>
<span><span class="co">##         p2.setMigrationRates(p3, ..migration_rate..);</span></span>
<span><span class="co">##         p3.tag = 1;</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##     if (p3.tag == 1 &amp; abund[2, gen - 1] &lt;= ..abund_threshold..) {</span></span>
<span><span class="co">##         p1.setMigrationRates(p3, 0);</span></span>
<span><span class="co">##         p2.setMigrationRates(p3, 0);</span></span>
<span><span class="co">##         p3.tag = 0;</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">## }</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## block_5:1000 late() {</span></span>
<span><span class="co">##     {sim.outputFull() -&gt; full_output}</span></span>
<span><span class="co">## }</span></span>
<span><span class="co">## This slimr_script has templating in block(s) block_init</span></span>
<span><span class="co">## and block_4 for variables mut_rate and</span></span>
<span><span class="co">## selection_strength and genome_size and recomb_rate and</span></span>
<span><span class="co">## popsize_scaling and abund_threshold and migration_rate.</span></span></code></pre>
<p>The above script uses a number of different <code>slimr</code>
feature that we will explain here. To anyone who has used SLiM before,
the above script probably looks pretty familiar. For those of you not
familiar with SLiM, we will go over each part of the above script one by
one to gain an understanding of what the script is doing. Otherwise, if
you’d like to know more about SLiM, I would highly recommend reading the
SLiM manual, which is very detailed and packed full of examples.</p>
<p>We start by setting a variable that we will use in the
<code>slimr_script</code> and later on in the R script as well.</p>
<p>We then use the <code>slimr_script()</code> function to create a new
<code>slimr_script</code> object, which will contain all the information
needed to run it in SLiM later. <code>slimr_script</code> takes a list
of <code>slimr_block</code> objects as arguments, which are created with
the <code>slimr_block()</code> function. <code>slimr_block</code>
objects contain blocks of SLiM code. Generally, there are two main types
of code blocks in SLiM: <code>initialize</code> blocks and ‘event’
blocks. Out first block above is an <code>initialize</code> block, which
sets up the SLiM simulation. All <code>slimr_script()</code> calls must
contain at least one <code>initialize</code> block. Most of the action
with <code>slimr</code> happens in this block for this script. In it, we
set up the simulation with our parameters, using two ‘<code>slimr</code>
verbs’. ‘<code>slimr</code> verbs’ are R functions that can be inserted
into SLiM code and which modify the code for various useful purposes.
Here we are using <code><a href="../reference/r_template.html">slimr_template()</a></code>, which lets you created
‘templated’ variables in a script – these are placemarkers that can be
filled in with desired values later. We also use
<code><a href="../reference/r_inline.html">slimr_inline()</a></code>, which let’s you ‘inline’ R objects directly
into a script. Inlining means the object and its values are converted
into a text representation and passed to SLiM by embedding them directly
into the script. This all happens behind the scenes, so you don’t need
to worry about it if you are not interested. We have used the special
argument <code>delay = TRUE</code> to delay the evaluation of
<code><a href="../reference/r_inline.html">slimr_inline()</a></code> until later. This is because we haven’t
created the R objects <code><a href="../reference/r_inline.html">slimr_inline()</a></code> references yet.</p>
<p>The <code>initialize</code> block is followed by 4 more
<code>slimr_block</code> calls, each of which specifies SLiM ‘events’.
“block_2” sets up 3 subpopulations in generation 1, and “block_3” sets
up starting conditions for these subpopulation by reading from a file
(which we create later), also in generation 1. “block_4” contains most
of the logic of the simulation, running in every generation from 1 to
1000. Finally, “block_5” outputs the state of the simulation at the last
generation, generation 1000. We assigned the <code>slimr_script</code>
object to a variable called <code>pop_sim</code>, and printed this
object, obtaining a pretty output of our script, including special
syntax showing our templated variable, which look like this:
..variable_name.. So, in order to run this script in SLiM, we first need
to fill in values for our templated variables, and also make sure we the
R objects referred to in <code><a href="../reference/r_inline.html">slimr_inline()</a></code> calls exist in our
R session. We can then “render” our script into a runnable form.</p>
<p>so, how do we fill in the templated variables with values and fill-in
our <code>slimr_inline</code> calls with actual R objects? For that, we
use the <code>slim_script_render</code> function. The first thing we
need to do before we use it is to create the R objects that
<code>slimr_inline</code> refers to, otherwise we will get an error
about non-existent objects. So what do we need? We need a matrix of
abundances for our three subpopulations (for
<code>slimr_inline(pop_abunds)</code>), a matrix of starting population
abundances (for <code>slimr_inline(init_popsize)</code>) and a file name
pointing to a SLiM population data file containing initial population
conditions (for <code>slimr_inline(starting_pop</code>). We will later
create this file from our <code>genlight</code> object using
<code>slimr</code>. But first, let’s get our objects in order, choose
some parameter values and render ourselves a
<code>slimr_script</code>!</p>
<p>For our population abundances over time, we will use the
live-trapping data, and we will create a simplified cycle, taking only
part of the sequence, and then repeating it over and over throughout the
years. We will sample data between 1995 and 2009, interpolate that to 50
time points, then loop over it inside our <code>slimr_script</code>, as
we discussed above.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pop_abunds</span> <span class="op">&lt;-</span> <span class="va">abund_summ</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&lt;</span> <span class="st">"2009-10-01"</span> <span class="op">&amp;</span> <span class="va">date</span> <span class="op">&gt;</span> <span class="st">"1995-03-01"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>three_pop <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">pop</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MC"</span>, <span class="st">"SS"</span>, <span class="st">"WS"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"BR"</span>,</span>
<span>                               <span class="va">pop</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FRN"</span>, <span class="st">"FRS"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"BL"</span>,</span>
<span>                               <span class="va">pop</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"KSE"</span>, <span class="st">"CS"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"TR"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html" class="external-link">drop_na</a></span><span class="op">(</span><span class="va">three_pop</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">three_pop</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>abund <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">abund</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">pop_abunds</span> <span class="op">&lt;-</span> <span class="va">pop_abunds</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">date</span>, values_from <span class="op">=</span> <span class="va">abund</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pop_abunds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approx</a></span><span class="op">(</span><span class="va">pop_abunds</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>, n <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">$</span><span class="va">y</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approx</a></span><span class="op">(</span><span class="va">pop_abunds</span><span class="op">[</span><span class="fl">2</span>, <span class="op">]</span>, n <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">$</span><span class="va">y</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approx</a></span><span class="op">(</span><span class="va">pop_abunds</span><span class="op">[</span><span class="fl">3</span>, <span class="op">]</span>, n <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in xy.coords(x, y, setLab = FALSE): NAs introduced by coercion</span></span>
<span></span>
<span><span class="co">## Warning in xy.coords(x, y, setLab = FALSE): NAs introduced by coercion</span></span>
<span></span>
<span><span class="co">## Warning in xy.coords(x, y, setLab = FALSE): NAs introduced by coercion</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## replace exact zeroes</span></span>
<span><span class="va">pop_abunds</span><span class="op">[</span><span class="va">pop_abunds</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.02</span></span>
<span></span>
<span><span class="co">## set sample times corresponding to our genetic data (roughly)</span></span>
<span><span class="va">sample_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2006"</span> <span class="op">=</span> <span class="fl">40</span>, <span class="st">"2007"</span> <span class="op">=</span> <span class="fl">45</span>, <span class="st">"2008"</span> <span class="op">=</span> <span class="fl">49</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## plot our abundance sequence</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pop_abunds</span><span class="op">[</span><span class="fl">2</span>, <span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">pop_abunds</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">pop_abunds</span><span class="op">[</span><span class="fl">3</span>, <span class="op">]</span>, col <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">sample_times</span><span class="op">)</span></span></code></pre></div>
<p><img src="Main_manuscript_example_v2_files/figure-html/setup_robs-1.png" width="80%"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## save for later use</span></span>
<span><span class="co">#write_rds(pop_abunds, "data/pop_abunds.rds")</span></span></code></pre></div>
<p>So, that is out <code>pop_abunds</code>. For initial population
states we are going to base it on data from 2008, which is the third
sampling date, and which corresponds to what we think is a panmictic
population, which is just after, but not during the big rainfall event.
We will get the initial population sizes from here, as well as our
starting population data. Our initial population sizes need to be based
on this (rather than our abundance data we just generated above),
because the number of individuals at the start of our simulation must
match the number in the starting population data. The population will
then be immediately adjusted to our desired population size by
essentially drawing offspring from our smaller starting population pool.
This should give us populations with SNP frequencies resembling our
actual data at the start of the simulation.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## extract 2008 data</span></span>
<span><span class="va">gen_2008</span> <span class="op">&lt;-</span> <span class="va">gen</span><span class="op">[</span><span class="va">gen</span><span class="op">@</span><span class="va">other</span><span class="op">$</span><span class="va">ind.metrics</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2008</span>, <span class="op">]</span></span>
<span><span class="co">## count number of individuals in genetic sample per subpopulation</span></span>
<span><span class="va">init_popsize</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/adegenet/man/accessors.html" class="external-link">pop</a></span><span class="op">(</span><span class="va">gen_2008</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## set filename to be used for starting pop data (using slim_file to make sure SLiM can find it)</span></span>
<span><span class="va">starting_pop</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/slim_file.html">slim_file</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## setup generations to sample</span></span>
<span><span class="co">## we will just sample the three years corresponding to the data, but do it during the last 6 cycles, as "technical" replicates</span></span>
<span><span class="va">sample_these</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">14</span><span class="op">:</span><span class="fl">19</span><span class="op">)</span>,</span>
<span>                           <span class="op">~</span><span class="fl">50</span><span class="op">*</span><span class="va">.x</span> <span class="op">+</span> <span class="va">sample_times</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html" class="external-link">reduce</a></span><span class="op">(</span><span class="va">union</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## save for later</span></span>
<span><span class="co">#write_rds(sample_these, "data/sample_these.rds")</span></span>
<span><span class="co">#write_rds(init_popsize, "data/init_popsize.rds")</span></span></code></pre></div>
<p>Okay, now we are ready to use <code>slim_script_render</code> to
generate a script we can run. The first thing we can try is to render
the script without providing a template. Since we have provided defaults
for all of our templated variables, this should generate a script with
the default values (our ‘default’ script).</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">script_def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slim_script_render.html">slim_script_render</a></span><span class="op">(</span><span class="va">pop_sim</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Warning: A templated variable was not specified in the template and has been replaced by its default value.</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">script_def</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">## &lt;slimr_script[5]&gt;</span></span>
<span><span class="co">## block_init:initialize() {</span></span>
<span><span class="co">##     setSeed(12345);</span></span>
<span><span class="co">##     initializeMutationRate(1e-06);</span></span>
<span><span class="co">##     initializeMutationType("m1", 0.5, "n", 0, 0.1);</span></span>
<span><span class="co">##     initializeGenomicElementType("g1", m1, 1);</span></span>
<span><span class="co">##     initializeGenomicElement(g1, 0, 3e+05 - 1);</span></span>
<span><span class="co">##     initializeRecombinationRate(1e-08);</span></span>
<span><span class="co">##     initializeSex("A");</span></span>
<span><span class="co">##     defineConstant("abund", {. = matrix(c(0.926, 0.278, 0.463, 0.557, 0.153, ...), nrow = 3, ncol = 50)});</span></span>
<span><span class="co">##     defineConstant("sample_these", {. = c(740, 745, 749, 790, 795, 799, 840, 845, 849, 890, ...)});</span></span>
<span><span class="co">## }</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## block_2:1 early() {</span></span>
<span><span class="co">##     init_pop = {. = c(7, 13, 13)}</span></span>
<span><span class="co">##     sim.addSubpop("p1", asInteger(init_pop[0]));</span></span>
<span><span class="co">##     sim.addSubpop("p2", asInteger(init_pop[1]));</span></span>
<span><span class="co">##     sim.addSubpop("p3", asInteger(init_pop[2]));</span></span>
<span><span class="co">## }</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## block_3:1 late() {</span></span>
<span><span class="co">##     sim.readFromPopulationFile({. = "F:\\Rtemp\\RtmpEdD9Oa\\file722438057426.txt"});</span></span>
<span><span class="co">##     p1.tag = 0;</span></span>
<span><span class="co">##     p2.tag = 0;</span></span>
<span><span class="co">##     p3.tag = 0;</span></span>
<span><span class="co">## }</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## block_4:1:1000 late() {</span></span>
<span><span class="co">##     gen = sim.cycle%%50;</span></span>
<span><span class="co">##     if (gen == 0) {</span></span>
<span><span class="co">##         gen = 50;</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##     p1.setSubpopulationSize(asInteger(ceil(abund[0, gen - 1] * 100)));</span></span>
<span><span class="co">##     p2.setSubpopulationSize(asInteger(ceil(abund[1, gen - 1] * 100)));</span></span>
<span><span class="co">##     p3.setSubpopulationSize(asInteger(ceil(abund[2, gen - 1] * 100)));</span></span>
<span><span class="co">##     if (p1.tag == 0 &amp; abund[0, gen - 1] &gt; 5) {</span></span>
<span><span class="co">##         p2.setMigrationRates(p1, 0);</span></span>
<span><span class="co">##         p3.setMigrationRates(p1, 0);</span></span>
<span><span class="co">##         p1.tag = 1;</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##     if (p1.tag == 1 &amp; abund[0, gen - 1] &lt;= 5) {</span></span>
<span><span class="co">##         p2.setMigrationRates(p1, 0);</span></span>
<span><span class="co">##         p3.setMigrationRates(p1, 0);</span></span>
<span><span class="co">##         p1.tag = 0;</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##     if (p2.tag == 0 &amp; abund[1, gen - 1] &gt; 5) {</span></span>
<span><span class="co">##         p1.setMigrationRates(p2, 0);</span></span>
<span><span class="co">##         p3.setMigrationRates(p2, 0);</span></span>
<span><span class="co">##         p2.tag = 1;</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##     if (p2.tag == 1 &amp; abund[1, gen - 1] &lt;= 5) {</span></span>
<span><span class="co">##         p1.setMigrationRates(p2, 0);</span></span>
<span><span class="co">##         p3.setMigrationRates(p2, 0);</span></span>
<span><span class="co">##         p2.tag = 0;</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##     if (p3.tag == 0 &amp; abund[2, gen - 1] &gt; 5) {</span></span>
<span><span class="co">##         p1.setMigrationRates(p3, 0);</span></span>
<span><span class="co">##         p2.setMigrationRates(p3, 0);</span></span>
<span><span class="co">##         p3.tag = 1;</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##     if (p3.tag == 1 &amp; abund[2, gen - 1] &lt;= 5) {</span></span>
<span><span class="co">##         p1.setMigrationRates(p3, 0);</span></span>
<span><span class="co">##         p2.setMigrationRates(p3, 0);</span></span>
<span><span class="co">##         p3.tag = 0;</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">## }</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## block_5:1000 late() {</span></span>
<span><span class="co">##     {sim.outputFull() -&gt; full_output}</span></span>
<span><span class="co">## }</span></span></code></pre>
<p>Okay, so now we can see that we have an indication that our R objects
will be inserted into the SLiM script. We can try and run this in SLiM
now, but we will get an error:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slim_run.html">slim_run</a></span><span class="op">(</span><span class="va">script_def</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Simulation finished with exit status: 1</span></span></code></pre>
<pre><code><span><span class="co">## Warning: </span></span>
<span><span class="co">## Failed! Error:</span></span></code></pre>
<pre><code><span><span class="co">## ERROR (Species::InitializePopulationFromFile): initialization file does not exist or is empty.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Error on script line 26, character 8:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     sim.readFromPopulationFile("F:\\Rtemp\\RtmpEdD9Oa\\file722438057426.txt");</span></span>
<span><span class="co">##         ^^^^^^^^^^^^^^^^^^^^^^</span></span></code></pre>
<p>This is because the <code>starting_pop.txt</code> doesn’t exist yet,
and SLiM has thrown an error telling us this (which slimr passes from
SLiM to us through the R console). Let’s create the initial population
file using <code>slim_make_pop_init</code>. We need to pass this
function either a <code>genlight</code> or a SNP matrix. Since our
<code>genlight</code> object has some missing values, and SLiM cannot
handle missing values, we will first convert to a SNP matrix, and then
fill-in missing values by interpolation. Essentially we just fill-in
missing values randomly with a draw from a binomial distribution.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">snp_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">gen_2008</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">snp_mat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  int [1:33, 1:39978] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##  - attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##   ..$ : chr [1:33] "P_herm_281" "P_herm_289" "P_herm_297" "P_herm_265" ...</span></span>
<span><span class="co">##   ..$ : chr [1:39978] "15067413-48-G/A" "15067414-5-C/T" "15067416-63-G/A" "15067419-10-G/C" ...</span></span></code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## replace NAs</span></span>
<span><span class="va">nas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">snp_mat</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.finite</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">snp_mat</span><span class="op">[</span> , <span class="op">!</span><span class="va">nas</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">snp_mat</span><span class="op">[</span> , <span class="op">!</span><span class="va">nas</span><span class="op">]</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.finite</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>;</span>
<span>  <span class="va">x</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.finite</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.finite</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="va">tab</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>;</span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">snp_mat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  int [1:33, 1:39978] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##  - attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##   ..$ : chr [1:33] "P_herm_281" "P_herm_289" "P_herm_297" "P_herm_265" ...</span></span>
<span><span class="co">##   ..$ : chr [1:39978] "15067413-48-G/A" "15067414-5-C/T" "15067416-63-G/A" "15067419-10-G/C" ...</span></span></code></pre>
<p>Then, we make our starting population file!</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sexes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">gen_2008</span><span class="op">@</span><span class="va">other</span><span class="op">$</span><span class="va">ind.metrics</span><span class="op">$</span><span class="va">Sex</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## sex ratio of sample is skewed to female, so replace actually sexes with extra males</span></span>
<span><span class="co">## otherwise simulation crashes because it is unable to sample enough females? Need</span></span>
<span><span class="co">## to look more into this bug.</span></span>
<span><span class="va">sexes</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/adegenet/man/accessors.html" class="external-link">pop</a></span><span class="op">(</span><span class="va">gen_2008</span><span class="op">)</span> <span class="op">==</span> <span class="st">"BL"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"M"</span>, <span class="st">"F"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in sexes[pop(gen_2008) == "BL"] &lt;- c("M", "F"): number of items to</span></span>
<span><span class="co">## replace is not a multiple of replacement length</span></span></code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sexes</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/adegenet/man/accessors.html" class="external-link">pop</a></span><span class="op">(</span><span class="va">gen_2008</span><span class="op">)</span> <span class="op">==</span> <span class="st">"BR"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"M"</span>, <span class="st">"F"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in sexes[pop(gen_2008) == "BR"] &lt;- c("M", "F"): number of items to</span></span>
<span><span class="co">## replace is not a multiple of replacement length</span></span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sexes</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/adegenet/man/accessors.html" class="external-link">pop</a></span><span class="op">(</span><span class="va">gen_2008</span><span class="op">)</span> <span class="op">==</span> <span class="st">"TR"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"M"</span>, <span class="st">"F"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in sexes[pop(gen_2008) == "TR"] &lt;- c("M", "F"): number of items to</span></span>
<span><span class="co">## replace is not a multiple of replacement length</span></span></code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## now make initial population file</span></span>
<span><span class="fu"><a href="../reference/slim_make_pop_input.html">slim_make_pop_input</a></span><span class="op">(</span><span class="va">snp_mat</span>, <span class="va">starting_pop</span>, <span class="co">## filename </span></span>
<span>                    sim_gen <span class="op">=</span> <span class="fl">1</span>, <span class="co">## set generation to first generation</span></span>
<span>                    ind_pops <span class="op">=</span> <span class="va">gen_2008</span><span class="op">@</span><span class="va">other</span><span class="op">$</span><span class="va">ind.metrics</span><span class="op">$</span><span class="va">three_pop</span>, <span class="co">## use subpops</span></span>
<span>                    ind_sex <span class="op">=</span> <span class="va">sexes</span>, <span class="co">## set sexes</span></span>
<span>                    <span class="co">## random positions:</span></span>
<span>                    mut_pos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="va">default_genome_size</span> <span class="op">-</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/pkg/adegenet/man/accessors.html" class="external-link">nLoc</a></span><span class="op">(</span><span class="va">gen_2008</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    version <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "F:\\Rtemp\\RtmpEdD9Oa\\file722438057426.txt"</span></span></code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## look at the first 50 line to see if it worked:</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_lines.html" class="external-link">read_lines</a></span><span class="op">(</span><span class="va">starting_pop</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "#OUT 1 A"                      "Version: 3"                   </span></span>
<span><span class="co">##  [3] "Populations:"                  "p1 7 S 0.42857142857142855"   </span></span>
<span><span class="co">##  [5] "p2 13 S 0.46153846153846156"   "p3 13 S 0.46153846153846156"  </span></span>
<span><span class="co">##  [7] "Mutations:"                    "0 0 m1 117793 0 0.5 p1 1 2"   </span></span>
<span><span class="co">##  [9] "1 1 m1 166306 0 0.5 p1 1 9"    "2 2 m1 230205 0 0.5 p1 1 4"   </span></span>
<span><span class="co">## [11] "3 3 m1 9509 0 0.5 p1 1 14"     "4 4 m1 47183 0 0.5 p1 1 8"    </span></span>
<span><span class="co">## [13] "5 5 m1 42660 0 0.5 p1 1 4"     "6 6 m1 179506 0 0.5 p1 1 4"   </span></span>
<span><span class="co">## [15] "7 7 m1 202318 0 0.5 p1 1 5"    "8 8 m1 84153 0 0.5 p1 1 2"    </span></span>
<span><span class="co">## [17] "9 9 m1 108690 0 0.5 p1 1 3"    "10 10 m1 160149 0 0.5 p1 1 6" </span></span>
<span><span class="co">## [19] "11 11 m1 161502 0 0.5 p1 1 16" "12 12 m1 122621 0 0.5 p1 1 25"</span></span>
<span><span class="co">## [21] "13 13 m1 22539 0 0.5 p1 1 2"   "14 14 m1 131828 0 0.5 p1 1 1" </span></span>
<span><span class="co">## [23] "15 15 m1 256203 0 0.5 p1 1 66" "16 16 m1 241478 0 0.5 p1 1 3" </span></span>
<span><span class="co">## [25] "17 17 m1 206033 0 0.5 p1 1 66" "18 18 m1 14002 0 0.5 p1 1 1"  </span></span>
<span><span class="co">## [27] "19 19 m1 164031 0 0.5 p1 1 62" "20 20 m1 41191 0 0.5 p1 1 12" </span></span>
<span><span class="co">## [29] "21 21 m1 8677 0 0.5 p1 1 15"   "22 22 m1 94041 0 0.5 p1 1 64" </span></span>
<span><span class="co">## [31] "23 23 m1 148047 0 0.5 p1 1 8"  "24 24 m1 96155 0 0.5 p1 1 2"  </span></span>
<span><span class="co">## [33] "25 25 m1 25365 0 0.5 p1 1 3"   "26 26 m1 196396 0 0.5 p1 1 14"</span></span>
<span><span class="co">## [35] "27 27 m1 100302 0 0.5 p1 1 18" "28 28 m1 209291 0 0.5 p1 1 1" </span></span>
<span><span class="co">## [37] "29 29 m1 207284 0 0.5 p1 1 2"  "30 30 m1 6485 0 0.5 p1 1 1"   </span></span>
<span><span class="co">## [39] "31 31 m1 178114 0 0.5 p1 1 8"  "32 32 m1 186245 0 0.5 p1 1 3" </span></span>
<span><span class="co">## [41] "33 33 m1 174584 0 0.5 p1 1 65" "34 34 m1 66593 0 0.5 p1 1 1"  </span></span>
<span><span class="co">## [43] "35 35 m1 150064 0 0.5 p1 1 1"  "36 36 m1 163884 0 0.5 p1 1 19"</span></span>
<span><span class="co">## [45] "37 37 m1 257974 0 0.5 p1 1 11" "38 38 m1 287205 0 0.5 p1 1 18"</span></span>
<span><span class="co">## [47] "39 39 m1 130973 0 0.5 p1 1 4"  "40 40 m1 216234 0 0.5 p1 1 63"</span></span>
<span><span class="co">## [49] "41 41 m1 280741 0 0.5 p1 1 11" "42 42 m1 106279 0 0.5 p1 1 8"</span></span></code></pre>
<p>And now we can try running our simulation:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slim_run.html">slim_run</a></span><span class="op">(</span><span class="va">script_def</span>, throw_error <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Simulation finished with exit status: 0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Success!</span></span></code></pre>
<p>Okay, so now we have a working simulation! We’ve currently just
output the full population information at the end of the simulation,
which doesn’t give us too much information about our question, but just
to convince ourselves the simulation produced genetic information, we
can extract our output as a <code>genlight</code> object and plot it.
<em>Note</em>: The conversion can take awhile.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pop_res</span> <span class="op">&lt;-</span> <span class="fu">slimr</span><span class="fu">::</span><span class="fu"><a href="../reference/slim_extract_genlight.html">slim_extract_genlight</a></span><span class="op">(</span><span class="va">res</span>, <span class="st">"full_output"</span><span class="op">)</span></span>
<span><span class="co">## reorder by subpop</span></span>
<span><span class="va">pop_res</span> <span class="op">&lt;-</span> <span class="va">pop_res</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/adegenet/man/accessors.html" class="external-link">pop</a></span><span class="op">(</span><span class="va">pop_res</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pop_res</span><span class="op">)</span></span></code></pre></div>
<p><img src="Main_manuscript_example_v2_files/figure-html/plot_genlight-1.png" width="80%"></p>
<p>So this shows that our three populations are characterized by mostly
non-overlapping fixed mutations. This makes sense since our default
parameters specified some selection, and no migration. Mutation with
positive selection coefficients would have sweeped to fixation, and the
lack of migration between subpopulation means that each subpopulation is
likely to have had a different set of mutations go to fixation, and no
way for these to then spread to other subpopulations.</p>
<p>Okay, to get an idea of what sort of dynamics of Fst we will get with
different versions of this simulation, let’s create a version where we
calculate Fst during the simulation, and output it for tracking. Then we
can make some time-series plots. When it comes to comparing simulation
outputs to our actual data we will make yet another version where we
will only output just before, during, and just after the population
explosions corresponding to rainfall. To add a Fst calculation to our
simulation we will use the <code>slim_function</code> function, which
allows you to specify a SLiM function to use in your SLiM code. This Fst
function is based on the one described in the SLiM manual, and can also
be found online here: <a href="https://github.com/MesserLab/SLiM-Extras/blob/master/functions/calcFST.txt" class="external-link">https://github.com/MesserLab/SLiM-Extras/blob/master/functions/calcFST.txt</a>.
We have already used the function as an R function when we calculated
Fst for our observed data. Now we can convert it to a SLiM function.
<code>slim_function</code> requires us to specify the function arguments
and the function names as character strings, and then the body of the
function as <code>slimr</code> code. If inserted into a
<code>slim_script</code> call, the function will then be accessible
inside the rest of the code in the <code>slim_script</code> call. We can
use the previously specified R function code body by simply extracting
it using <code><a href="https://rlang.r-lib.org/reference/fn_body.html" class="external-link">rlang::fn_body()</a></code>. We also need to make sure it is
evaluated before insertion, which we assure using the evaluation forcing
operator <code>!!</code>.</p>
<p><em>Note:</em> The latest version of SLiM (v4.1), which was released
after the initial version of this vignette was written, now has a
built-in function called <code>calcFST</code>, which means we
technically no longer need to use a custom function for this
functionality. However, we have kept this section of the vignette to
show how custom functions can be specified and used in
<code>slimr</code>.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/slim_script.html">slim_script</a></span><span class="op">(</span></span>
<span>  </span>
<span>  <span class="fu"><a href="../reference/slim_function.html">slim_function</a></span><span class="op">(</span><span class="st">"o&lt;Subpopulation&gt;$ subpop1"</span>, <span class="st">"o&lt;Subpopulation&gt;$ subpop2"</span>,</span>
<span>                name <span class="op">=</span> <span class="st">"calculateFST"</span>,</span>
<span>                return_type <span class="op">=</span> <span class="st">"f$"</span>, body <span class="op">=</span> <span class="va">calculateFST</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="fu"><a href="../reference/slim_block.html">slim_block</a></span><span class="op">(</span><span class="fu"><a href="../reference/callback_initialize.html">initialize</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">{</span></span>
<span>    </span>
<span>    <span class="fu">setSeed</span><span class="op">(</span><span class="fl">12345</span><span class="op">)</span>;</span>
<span>    <span class="fu"><a href="../reference/initializeMutationRate.html">initializeMutationRate</a></span><span class="op">(</span><span class="fu"><a href="../reference/r_template.html">slimr_template</a></span><span class="op">(</span><span class="st">"mut_rate"</span>, <span class="fl">1e-6</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    <span class="fu"><a href="../reference/initializeMutationType.html">initializeMutationType</a></span><span class="op">(</span><span class="st">"m1"</span>, <span class="fl">0.5</span>, <span class="st">"n"</span>, <span class="fl">0</span>, <span class="fu"><a href="../reference/r_template.html">slimr_template</a></span><span class="op">(</span><span class="st">"selection_strength"</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    <span class="fu"><a href="../reference/initializeGenomicElementType.html">initializeGenomicElementType</a></span><span class="op">(</span><span class="st">"g1"</span>, <span class="va">m1</span>, <span class="fl">1.0</span><span class="op">)</span>;</span>
<span>    <span class="fu"><a href="../reference/initializeGenomicElement.html">initializeGenomicElement</a></span><span class="op">(</span><span class="va">g1</span>, <span class="fl">0</span>, <span class="fu"><a href="../reference/r_template.html">slimr_template</a></span><span class="op">(</span><span class="st">"genome_size"</span>, <span class="op">!</span><span class="op">!</span><span class="va">default_genome_size</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>;</span>
<span>    <span class="fu"><a href="../reference/initializeRecombinationRate.html">initializeRecombinationRate</a></span><span class="op">(</span><span class="fu"><a href="../reference/r_template.html">slimr_template</a></span><span class="op">(</span><span class="st">"recomb_rate"</span>, <span class="fl">1e-8</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    <span class="fu"><a href="../reference/initializeSex.html">initializeSex</a></span><span class="op">(</span><span class="st">"A"</span><span class="op">)</span>;</span>
<span>    <span class="fu">defineConstant</span><span class="op">(</span><span class="st">"abund"</span>, <span class="fu"><a href="../reference/r_inline.html">slimr_inline</a></span><span class="op">(</span><span class="va">pop_abunds</span>, delay <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    <span class="fu">defineConstant</span><span class="op">(</span><span class="st">"sample_these"</span>, <span class="fu"><a href="../reference/r_inline.html">slimr_inline</a></span><span class="op">(</span><span class="va">sample_these</span>, delay <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/slim_block.html">slim_block</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">init_pop</span> <span class="op">=</span> <span class="fu"><a href="../reference/r_inline.html">slimr_inline</a></span><span class="op">(</span><span class="va">init_popsize</span>, delay <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co">## set populations to initial size</span></span>
<span>    <span class="fu">sim.addSubpop</span><span class="op">(</span><span class="st">"p1"</span>, <span class="fu">asInteger</span><span class="op">(</span><span class="va">init_pop</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    <span class="fu">sim.addSubpop</span><span class="op">(</span><span class="st">"p2"</span>, <span class="fu">asInteger</span><span class="op">(</span><span class="va">init_pop</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    <span class="fu">sim.addSubpop</span><span class="op">(</span><span class="st">"p3"</span>, <span class="fu">asInteger</span><span class="op">(</span><span class="va">init_pop</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="fu"><a href="../reference/slim_block.html">slim_block</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="../reference/late.html">late</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">{</span></span>
<span>    <span class="co">## get starting population from a file which we will fill-in later</span></span>
<span>    <span class="fu">sim.readFromPopulationFile</span><span class="op">(</span><span class="fu"><a href="../reference/r_inline.html">slimr_inline</a></span><span class="op">(</span><span class="va">starting_pop</span>, delay <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    <span class="co">## migration on or off flags for pops 1-3 (using tag)</span></span>
<span>    <span class="va">p1.tag</span> <span class="op">=</span> <span class="fl">0</span>;</span>
<span>    <span class="va">p2.tag</span> <span class="op">=</span> <span class="fl">0</span>;</span>
<span>    <span class="va">p3.tag</span> <span class="op">=</span> <span class="fl">0</span>;</span>
<span>  <span class="op">}</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="fu"><a href="../reference/slim_block.html">slim_block</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1000</span>, <span class="fu"><a href="../reference/late.html">late</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">{</span></span>
<span>    </span>
<span>    <span class="co">## update generation number</span></span>
<span>    <span class="co">## note in SLiM versions &lt; 4.0, this would be sim.generation instead</span></span>
<span>    <span class="va">gen</span> <span class="op">=</span> <span class="va">sim.cycle</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">50</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">gen</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">gen</span> <span class="op">=</span> <span class="fl">50</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co">## set population size to observed levels</span></span>
<span>    <span class="fu">p1.setSubpopulationSize</span><span class="op">(</span><span class="fu">asInteger</span><span class="op">(</span><span class="fu">ceil</span><span class="op">(</span><span class="va">abund</span><span class="op">[</span><span class="fl">0</span>, <span class="va">gen</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="../reference/r_template.html">slimr_template</a></span><span class="op">(</span><span class="st">"popsize_scaling"</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    <span class="fu">p2.setSubpopulationSize</span><span class="op">(</span><span class="fu">asInteger</span><span class="op">(</span><span class="fu">ceil</span><span class="op">(</span><span class="va">abund</span><span class="op">[</span><span class="fl">1</span>, <span class="va">gen</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">..popsize_scaling..</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    <span class="fu">p3.setSubpopulationSize</span><span class="op">(</span><span class="fu">asInteger</span><span class="op">(</span><span class="fu">ceil</span><span class="op">(</span><span class="va">abund</span><span class="op">[</span><span class="fl">2</span>, <span class="va">gen</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">..popsize_scaling..</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    </span>
<span>    <span class="co">## increase migration when above abundance threshold</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">p1.tag</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">abund</span><span class="op">[</span><span class="fl">0</span>, <span class="va">gen</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fu"><a href="../reference/r_template.html">slimr_template</a></span><span class="op">(</span><span class="st">"abund_threshold"</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">p2.setMigrationRates</span><span class="op">(</span><span class="va">p1</span>, <span class="fu"><a href="../reference/r_template.html">slimr_template</a></span><span class="op">(</span><span class="st">"migration_rate"</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="fu">p3.setMigrationRates</span><span class="op">(</span><span class="va">p1</span>, <span class="va">..migration_rate..</span><span class="op">)</span></span>
<span>      <span class="va">p1.tag</span> <span class="op">=</span> <span class="fl">1</span>;</span>
<span>    <span class="op">}</span> </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">p1.tag</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">abund</span><span class="op">[</span><span class="fl">0</span>, <span class="va">gen</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="va">..abund_threshold..</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">p2.setMigrationRates</span><span class="op">(</span><span class="va">p1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>      <span class="fu">p3.setMigrationRates</span><span class="op">(</span><span class="va">p1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>      <span class="va">p1.tag</span> <span class="op">=</span> <span class="fl">0</span>;</span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">p2.tag</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">abund</span><span class="op">[</span><span class="fl">1</span>, <span class="va">gen</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">..abund_threshold..</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">p1.setMigrationRates</span><span class="op">(</span><span class="va">p2</span>, <span class="va">..migration_rate..</span><span class="op">)</span></span>
<span>      <span class="fu">p3.setMigrationRates</span><span class="op">(</span><span class="va">p2</span>, <span class="va">..migration_rate..</span><span class="op">)</span></span>
<span>      <span class="va">p2.tag</span> <span class="op">=</span> <span class="fl">1</span>;</span>
<span>    <span class="op">}</span> </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">p2.tag</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">abund</span><span class="op">[</span><span class="fl">1</span>, <span class="va">gen</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="va">..abund_threshold..</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">p1.setMigrationRates</span><span class="op">(</span><span class="va">p2</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>      <span class="fu">p3.setMigrationRates</span><span class="op">(</span><span class="va">p2</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>      <span class="va">p2.tag</span> <span class="op">=</span> <span class="fl">0</span>;</span>
<span>    <span class="op">}</span>    </span>
<span>    </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">p3.tag</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">abund</span><span class="op">[</span><span class="fl">2</span>, <span class="va">gen</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">..abund_threshold..</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">p1.setMigrationRates</span><span class="op">(</span><span class="va">p3</span>, <span class="va">..migration_rate..</span><span class="op">)</span></span>
<span>      <span class="fu">p2.setMigrationRates</span><span class="op">(</span><span class="va">p3</span>, <span class="va">..migration_rate..</span><span class="op">)</span></span>
<span>      <span class="va">p3.tag</span> <span class="op">=</span> <span class="fl">1</span>;</span>
<span>    <span class="op">}</span> </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">p3.tag</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">abund</span><span class="op">[</span><span class="fl">2</span>, <span class="va">gen</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="va">..abund_threshold..</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">p1.setMigrationRates</span><span class="op">(</span><span class="va">p3</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>      <span class="fu">p2.setMigrationRates</span><span class="op">(</span><span class="va">p3</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>      <span class="va">p3.tag</span> <span class="op">=</span> <span class="fl">0</span>;</span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co">## output Fst</span></span>
<span>    <span class="fu"><a href="../reference/r_output.html">slimr_output</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">calculateFST</span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span><span class="op">)</span>, <span class="fu">calculateFST</span><span class="op">(</span><span class="va">p1</span>, <span class="va">p3</span><span class="op">)</span>, <span class="fu">calculateFST</span><span class="op">(</span><span class="va">p2</span>, <span class="va">p3</span><span class="op">)</span><span class="op">)</span>, <span class="st">"fsts"</span><span class="op">)</span>;</span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="fu"><a href="../reference/slim_block.html">slim_block</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fu"><a href="../reference/late.html">late</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">{</span></span>
<span>    <span class="fu">sim.simulationFinished</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">pop_sim_fst</span></span></code></pre></div>
<p>Now let’s run that for our defaults to see how it works.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fst_script</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slim_script_render.html">slim_script_render</a></span><span class="op">(</span><span class="va">pop_sim_fst</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Warning: A templated variable was not specified in the template and has been replaced by its default value.</span></span></code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fst_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slim_run.html">slim_run</a></span><span class="op">(</span><span class="va">fst_script</span>, throw_error <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Simulation finished with exit status: 0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Success!</span></span></code></pre>
<p>So now we can have a look at how the Fst data was returned, which is
the default way <code>slimr</code> returns data that is a vector:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fst_res</span><span class="op">$</span><span class="va">output_data</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">## # A tibble: 1,000 × 5</span></span>
<span><span class="co">##    generation name  expression                                       type  data </span></span>
<span><span class="co">##         &lt;int&gt; &lt;chr&gt; &lt;chr&gt;                                            &lt;chr&gt; &lt;chr&gt;</span></span>
<span><span class="co">##  1          1 fsts  c(calculateFST(p1, p2), calculateFST(p1, p3), c… "flo… 0.04…</span></span>
<span><span class="co">##  2          2 fsts  c(calculateFST(p1, p2), calculateFST(p1, p3), c… "flo… 0.04…</span></span>
<span><span class="co">##  3          3 fsts  c(calculateFST(p1, p2), calculateFST(p1, p3), c… "flo… 0.05…</span></span>
<span><span class="co">##  4          4 fsts  c(calculateFST(p1, p2), calculateFST(p1, p3), c… "flo… 0.05…</span></span>
<span><span class="co">##  5          5 fsts  c(calculateFST(p1, p2), calculateFST(p1, p3), c… "flo… 0.06…</span></span>
<span><span class="co">##  6          6 fsts  c(calculateFST(p1, p2), calculateFST(p1, p3), c… "flo… 0.09…</span></span>
<span><span class="co">##  7          7 fsts  c(calculateFST(p1, p2), calculateFST(p1, p3), c… "flo… 0.10…</span></span>
<span><span class="co">##  8          8 fsts  c(calculateFST(p1, p2), calculateFST(p1, p3), c… "flo… 0.11…</span></span>
<span><span class="co">##  9          9 fsts  c(calculateFST(p1, p2), calculateFST(p1, p3), c… "flo… 0.11…</span></span>
<span><span class="co">## 10         10 fsts  c(calculateFST(p1, p2), calculateFST(p1, p3), c… "flo… 0.11…</span></span>
<span><span class="co">## # ℹ 990 more rows</span></span></code></pre>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/typeof.html" class="external-link">typeof</a></span><span class="op">(</span><span class="va">fst_res</span><span class="op">$</span><span class="va">output_data</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "character"</span></span></code></pre>
<p>So it is currently in the form of a character vector separated by
spaces. This is pretty straightforward to extract, so let’s do it
(<em>Note</em>: <code>slimr</code> has the ability to automatically
convert this output to more user friendly form, but here we will do it
the hard way to show how you can flexibly extract different kinds of
data, even if a built-in <code>slimr</code> function doesn’t exist to
handle the type of output you want).</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">extract_fst</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fst_res</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">fst_dat</span> <span class="op">&lt;-</span> <span class="va">fst_res</span><span class="op">$</span><span class="va">output_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">generation</span>, <span class="va">data</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html" class="external-link">str_split</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">" "</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_longer.html" class="external-link">unnest_longer</a></span><span class="op">(</span><span class="va">data</span>, values_to <span class="op">=</span> <span class="st">"fst"</span>, indices_to <span class="op">=</span> <span class="st">"index"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>fst <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">fst</span><span class="op">)</span>, `subpop\npair` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BL-BR"</span>, <span class="st">"BL-TR"</span>, <span class="st">"BR-TR"</span><span class="op">)</span><span class="op">[</span><span class="va">index</span><span class="op">]</span><span class="op">)</span> </span>
<span>  <span class="va">fst_dat</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">fst_dat</span> <span class="op">&lt;-</span> <span class="fu">extract_fst</span><span class="op">(</span><span class="va">fst_res</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">fst_dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">generation</span>, <span class="va">fst</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">`subpop\npair`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_sqrt</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggforce</span><span class="fu">::</span><span class="fu"><a href="https://ggforce.data-imaginist.com/reference/facet_zoom.html" class="external-link">facet_zoom</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">generation</span> <span class="op">&gt;</span> <span class="fl">750</span> <span class="op">&amp;</span> <span class="va">generation</span> <span class="op">&lt;</span> <span class="fl">1000</span>,</span>
<span>                      y <span class="op">=</span> <span class="va">fst</span> <span class="op">&gt;</span> <span class="fl">0.1</span>,</span>
<span>                      horizontal <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                      zoom.size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Main_manuscript_example_v2_files/figure-html/process_fst-1.png" width="80%"></p>
<p>We can see that pairwise Fst rapidly increases between all three
subpopulations, reaching nearly its theoretical maximum of 1.0, and then
periodically dipping slightly. Let’s look at how this equilibrium
pattern corresponds with population sizes. We will look at mean
population size and mean Fst.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pop_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">pop_abunds</span>, <span class="fl">2</span>, <span class="va">mean</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span>length.out <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="va">fst_dat</span><span class="op">$</span><span class="va">generation</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span> <span class="co">## don't forget popsize_scaling</span></span>
<span></span>
<span><span class="va">plot_cycle</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fst_dat</span>, <span class="va">pop_mean</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">fst_pop</span> <span class="op">&lt;-</span> <span class="va">fst_dat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">generation</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>fst <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">fst</span><span class="op">)</span>,</span>
<span>                     .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>popsize <span class="op">=</span> <span class="va">pop_mean</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">generation</span> <span class="op">&gt;</span> <span class="fl">750</span><span class="op">)</span> <span class="co">## only take data after equilibrium reached</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">fst_pop</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">popsize</span>, <span class="va">fst</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">generation</span><span class="op">)</span>, </span>
<span>              arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="st">"cm"</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"closed"</span><span class="op">)</span>, </span>
<span>              alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"point"</span>, x <span class="op">=</span> <span class="va">fst_pop</span><span class="op">$</span><span class="va">popsize</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">fst_pop</span><span class="op">$</span><span class="va">fst</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, colour <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">plot_cycle</span><span class="op">(</span><span class="va">fst_dat</span>, <span class="va">pop_mean</span><span class="op">)</span></span></code></pre></div>
<p><img src="Main_manuscript_example_v2_files/figure-html/compare_popsize_fst-1.png" width="80%"></p>
<p>The plot above shows how Fst and population size are changing through
time together for 250 generations (the red dot is the starting point at
generation 750). It appears that as population size begins increasing
the Fst begins to drop slightly. This drop in Fst continues even as
population size begins to decrease again (a lag effect?), then Fst
suddenly increases back to nearly 1.0 as population size reaches a low.
I suspect this pattern is due to ephemeral effects of increased
efficiency of selection when population size is high. As new mutations
begin sweeping to fixation there is an intermediate period where they
are at intermediate frequency – this has the tendency to lead to
reductions in within-population heterozygosity (relative to total
heterozygosity), and leads to the subpopulation becoming slightly more
similar due to chance collisions between genes being selected in both
populations.</p>
<p>Due to overplotting however, some of the details of the plot may be
difficult to see. Instead let’s use <code>gganimate</code> to create an
animated version that might show the dynamics a bit better.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">animate_cycle</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fst_dat</span>, <span class="va">pop_mean</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">fst_pop</span> <span class="op">&lt;-</span> <span class="va">fst_dat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">generation</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>fst <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">fst</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>popsize <span class="op">=</span> <span class="va">pop_mean</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">generation</span> <span class="op">&gt;</span> <span class="fl">250</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="va">anim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">fst_pop</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">popsize</span>, <span class="va">fst</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://gganimate.com/reference/transition_reveal.html" class="external-link">transition_reveal</a></span><span class="op">(</span><span class="va">generation</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://gganimate.com/reference/shadow_wake.html" class="external-link">shadow_wake</a></span><span class="op">(</span><span class="fl">0.02</span>, falloff <span class="op">=</span> <span class="st">"sine-in"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Generation: {frame_along}"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://gganimate.com/reference/animate.html" class="external-link">animate</a></span><span class="op">(</span><span class="va">anim</span>, nframes <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="va">fst_pop</span><span class="op">$</span><span class="va">generation</span><span class="op">)</span> <span class="op">*</span> <span class="fl">5</span>, fps <span class="op">=</span> <span class="fl">30</span>, </span>
<span>          start_pause <span class="op">=</span> <span class="fl">10</span>, end_pause <span class="op">=</span> <span class="fl">10</span>, renderer <span class="op">=</span> <span class="fu"><a href="https://gganimate.com/reference/renderers.html" class="external-link">gifski_renderer</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">animate_cycle</span><span class="op">(</span><span class="va">fst_dat</span>, <span class="va">pop_mean</span><span class="op">)</span></span></code></pre></div>
<p><img src="../../docs/articles/Main_manuscript_example_v2_files/figure-html/animate_it-1.gif" width="80%"></p>
<p>The above animation shows 750 generations of the dynamics, with the
black dot showing the position of the population in terms of the mean
population size, and the mean pairwise Fst, at different time points. We
can clearly see the cycles occurring and its direction.</p>
<p>In any event, this is obviously a pretty unrealistic scenario, and it
bears little resemblance to what is happening in our actual data. So,
let us try a few other sets of parameters, and see if we can get
something closer to what we observe in our data. Now we can finally see
how we specify non-default values to our templated variables using
<code>slim_script_render</code>. Let’s start by changing the
<code>migration_rate</code> parameter, which controls how much migration
we get between subpopulations when they go over their threshold
population size. Let’s set it to maximum migration (0.5) – this model is
similar to our hypothesis for the pattern we see. We will also set
selection to practically zero, so we can isolate drift as a mechanism.
We set a parameter value in our script like this:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## set migration rate to 0.5 (maximum migration, e.g. 50% of population switches place)</span></span>
<span><span class="co">## population will become panmictic over a certain popsize threshold</span></span>
<span><span class="va">fst_script_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slim_script_render.html">slim_script_render</a></span><span class="op">(</span><span class="va">pop_sim_fst</span>, template <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>migration_rate <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                                                                 selection_strength <span class="op">=</span> <span class="fl">1e-12</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Warning: A templated variable was not specified in the template and has been replaced by its default value.</span></span></code></pre>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## now run the sim and show plots of results</span></span>
<span><span class="va">fst_res_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slim_run.html">slim_run</a></span><span class="op">(</span><span class="va">fst_script_2</span>, throw_error <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Simulation finished with exit status: 0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Success!</span></span></code></pre>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fst_dat_2</span> <span class="op">&lt;-</span> <span class="fu">extract_fst</span><span class="op">(</span><span class="va">fst_res_2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">fst_dat_2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">generation</span>, <span class="va">fst</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">`subpop\npair`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_sqrt</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggforce</span><span class="fu">::</span><span class="fu"><a href="https://ggforce.data-imaginist.com/reference/facet_zoom.html" class="external-link">facet_zoom</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">generation</span> <span class="op">&gt;</span> <span class="fl">750</span> <span class="op">&amp;</span> <span class="va">generation</span> <span class="op">&lt;</span> <span class="fl">1000</span>,</span>
<span>                      y <span class="op">=</span> <span class="va">fst</span> <span class="op">&lt;</span> <span class="fl">0.5</span>,</span>
<span>                      horizontal <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                      zoom.size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Main_manuscript_example_v2_files/figure-html/try_more_params-1.png" width="80%"></p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_cycle</span><span class="op">(</span><span class="va">fst_dat_2</span>, <span class="va">pop_mean</span><span class="op">)</span></span></code></pre></div>
<p><img src="Main_manuscript_example_v2_files/figure-html/try_more_params-2.png" width="80%"></p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">animate_cycle</span><span class="op">(</span><span class="va">fst_dat_2</span>, <span class="va">pop_mean</span><span class="op">)</span></span></code></pre></div>
<p><img src="../../docs/articles/Main_manuscript_example_v2_files/figure-html/try_more_params-1.gif" width="80%"></p>
<p>This shows a very distinct pattern relative to our last run. Now we
see that Fst tends to be very low, particularly when population sizes
are high (e.g. when migration is “turned on”), as expected. Fst
increases in the intervening periods of low population size, which can
only be explained by drift. Our Fst values are closer to the magnitude
of values we see in our data, which max out at around 0.05, though they
still tend to be much higher in this simulation overall.</p>
<p>Let’s try one more scenario before we attempt to more formally
compare the simulations to our data. Let’s set our
<code>abund_threshold</code> controlling at what population size the
subpopulation begins exchanging individuals to zero. This means that
migration will be on all the time. We will also increase selection.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fst_script_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slim_script_render.html">slim_script_render</a></span><span class="op">(</span><span class="va">pop_sim_fst</span>, template <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>migration_rate <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                                                                 selection_strength <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>                                                                 abund_threshold <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Warning: A templated variable was not specified in the template and has been replaced by its default value.</span></span></code></pre>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fst_res_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slim_run.html">slim_run</a></span><span class="op">(</span><span class="va">fst_script_3</span>, throw_error <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Simulation finished with exit status: 0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Success!</span></span></code></pre>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fst_dat_3</span> <span class="op">&lt;-</span> <span class="fu">extract_fst</span><span class="op">(</span><span class="va">fst_res_3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">fst_dat_3</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">generation</span>, <span class="va">fst</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">`subpop\npair`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_sqrt</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggforce</span><span class="fu">::</span><span class="fu"><a href="https://ggforce.data-imaginist.com/reference/facet_zoom.html" class="external-link">facet_zoom</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">generation</span> <span class="op">&gt;</span> <span class="fl">750</span> <span class="op">&amp;</span> <span class="va">generation</span> <span class="op">&lt;</span> <span class="fl">1000</span>,</span>
<span>                      y <span class="op">=</span> <span class="va">fst</span> <span class="op">&lt;</span> <span class="fl">0.2</span>,</span>
<span>                      horizontal <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                      zoom.size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Main_manuscript_example_v2_files/figure-html/mig_always-1.png" width="80%"></p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_cycle</span><span class="op">(</span><span class="va">fst_dat_3</span>, <span class="va">pop_mean</span><span class="op">)</span></span></code></pre></div>
<p><img src="Main_manuscript_example_v2_files/figure-html/mig_always-2.png" width="80%"></p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">animate_cycle</span><span class="op">(</span><span class="va">fst_dat_3</span>, <span class="va">pop_mean</span><span class="op">)</span></span></code></pre></div>
<p><img src="../../docs/articles/Main_manuscript_example_v2_files/figure-html/mig_always-1.gif" width="80%"></p>
<p>We can again see that we get rapid fluctuations in Fst relating to
changes in population size. Here they are a bit more rapid but don’t
reach the same extremes of Fst. The fluctuations presumably still occur
because at very low population size, drift still allows the
subpopulations to drift apart due to chance alone, even though they are
panmictic (in other words, if you choose any two random subsets of
individuals you would expect a higher pairwise Fst during times of low
population size). Before we move on, what happens if we reduce the
migration rate with an abundance threshold:</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fst_script_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slim_script_render.html">slim_script_render</a></span><span class="op">(</span><span class="va">pop_sim_fst</span>, template <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>migration_rate <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>                                                                 selection_strength <span class="op">=</span> <span class="fl">1e-12</span>,</span>
<span>                                                                 abund_threshold <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Warning: A templated variable was not specified in the template and has been replaced by its default value.</span></span></code></pre>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fst_res_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slim_run.html">slim_run</a></span><span class="op">(</span><span class="va">fst_script_4</span>, throw_error <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Simulation finished with exit status: 0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Success!</span></span></code></pre>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fst_dat_4</span> <span class="op">&lt;-</span> <span class="fu">extract_fst</span><span class="op">(</span><span class="va">fst_res_4</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">fst_dat_4</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">generation</span>, <span class="va">fst</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">`subpop\npair`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_sqrt</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggforce</span><span class="fu">::</span><span class="fu"><a href="https://ggforce.data-imaginist.com/reference/facet_zoom.html" class="external-link">facet_zoom</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">generation</span> <span class="op">&gt;</span> <span class="fl">750</span> <span class="op">&amp;</span> <span class="va">generation</span> <span class="op">&lt;</span> <span class="fl">1000</span>,</span>
<span>                      y <span class="op">=</span> <span class="va">fst</span> <span class="op">&lt;</span> <span class="fl">0.2</span>,</span>
<span>                      horizontal <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                      zoom.size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Main_manuscript_example_v2_files/figure-html/sel_migr_on-1.png" width="80%"></p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_cycle</span><span class="op">(</span><span class="va">fst_dat_4</span>, <span class="va">pop_mean</span><span class="op">)</span></span></code></pre></div>
<p><img src="Main_manuscript_example_v2_files/figure-html/sel_migr_on-2.png" width="80%"></p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">animate_cycle</span><span class="op">(</span><span class="va">fst_dat_4</span>, <span class="va">pop_mean</span><span class="op">)</span></span></code></pre></div>
<p><img src="../../docs/articles/Main_manuscript_example_v2_files/figure-html/sel_migr_on-1.gif" width="80%"></p>
<p>Again we see those fluctuations. All in all, this suggests that it is
likely to be difficult to distinguish what processes are driving the
pattern of Fst we see in our study. There clearly are some differences
in the details of the dynamics, particularly when you compare our cycle
plots between the different scenarios. However, we only have three years
of data, just spanning a rainfall (or population explosion) event, which
means considerably less information to go on. It looks like it is going
to be difficult to disentangle the effects of migration from just the
effects of population size, which is perhaps not surprising, given that
these two factors are linked in our model (e.g. our hypothesis is that
migration increases with high rainfall, which also is linked with
population increases). Unfortunately the two processes have a similar
effect on Fst, migration creates gene flow which reduces population
differentiation, but increasing population increases effective
population size, and thus reducing the strength of drift relative to
selection, me</p>
<p>So the next thing we should do is get our simulation to output data
we can compare directly to our data. In this case we will just output
full population information at several time points, and calculate Fst
post-hoc using our custom R function to make sure that our methods of
calculating Fst are the same. We will also sample the subpopulations in
our simulation to try and match sample size with our real data as
well.</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samp_sizes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">gen</span><span class="op">$</span><span class="va">other</span><span class="op">$</span><span class="va">ind.metrics</span><span class="op">$</span><span class="va">three_pop</span>, <span class="va">gen</span><span class="op">$</span><span class="va">other</span><span class="op">$</span><span class="va">ind.metrics</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span></span>
<span><span class="va">samp_sizes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">cbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">6</span>, <span class="va">samp_sizes</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## save for later</span></span>
<span><span class="co">#write_rds(samp_sizes, "data/samp_sizes.rds")</span></span>
<span></span>
<span><span class="fu"><a href="../reference/slim_script.html">slim_script</a></span><span class="op">(</span></span>
<span>  </span>
<span>  <span class="fu"><a href="../reference/slim_block.html">slim_block</a></span><span class="op">(</span><span class="fu"><a href="../reference/callback_initialize.html">initialize</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">{</span></span>
<span>    </span>
<span>    <span class="co">#setSeed(12345); don't want to set the seed because we want diff each time</span></span>
<span>    <span class="co">#initializeSLiMOptions(keepPedigrees=T);</span></span>
<span>    <span class="fu"><a href="../reference/initializeMutationRate.html">initializeMutationRate</a></span><span class="op">(</span><span class="fu"><a href="../reference/r_template.html">slimr_template</a></span><span class="op">(</span><span class="st">"mut_rate"</span>, <span class="fl">1e-6</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    <span class="fu"><a href="../reference/initializeMutationType.html">initializeMutationType</a></span><span class="op">(</span><span class="st">"m1"</span>, <span class="fl">0.5</span>, <span class="st">"n"</span>, <span class="fl">0</span>, <span class="fu"><a href="../reference/r_template.html">slimr_template</a></span><span class="op">(</span><span class="st">"selection_strength"</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    <span class="fu"><a href="../reference/initializeGenomicElementType.html">initializeGenomicElementType</a></span><span class="op">(</span><span class="st">"g1"</span>, <span class="va">m1</span>, <span class="fl">1.0</span><span class="op">)</span>;</span>
<span>    <span class="fu"><a href="../reference/initializeGenomicElement.html">initializeGenomicElement</a></span><span class="op">(</span><span class="va">g1</span>, <span class="fl">0</span>, <span class="fu"><a href="../reference/r_template.html">slimr_template</a></span><span class="op">(</span><span class="st">"genome_size"</span>, <span class="op">!</span><span class="op">!</span><span class="va">default_genome_size</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>;</span>
<span>    <span class="fu"><a href="../reference/initializeRecombinationRate.html">initializeRecombinationRate</a></span><span class="op">(</span><span class="fu"><a href="../reference/r_template.html">slimr_template</a></span><span class="op">(</span><span class="st">"recomb_rate"</span>, <span class="fl">1e-8</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    <span class="fu"><a href="../reference/initializeSex.html">initializeSex</a></span><span class="op">(</span><span class="st">"A"</span><span class="op">)</span>;</span>
<span>    <span class="fu">defineConstant</span><span class="op">(</span><span class="st">"abund"</span>, <span class="fu"><a href="../reference/r_inline.html">slimr_inline</a></span><span class="op">(</span><span class="va">pop_abunds</span>, delay <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    <span class="fu">defineConstant</span><span class="op">(</span><span class="st">"sample_these"</span>, <span class="fu"><a href="../reference/r_inline.html">slimr_inline</a></span><span class="op">(</span><span class="va">sample_these</span>, delay <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    <span class="fu">defineConstant</span><span class="op">(</span><span class="st">"samp_sizes"</span>, <span class="fu"><a href="../reference/r_inline.html">slimr_inline</a></span><span class="op">(</span><span class="va">samp_sizes</span>, delay <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/slim_block.html">slim_block</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">init_pop</span> <span class="op">=</span> <span class="fu"><a href="../reference/r_inline.html">slimr_inline</a></span><span class="op">(</span><span class="va">init_popsize</span>, delay <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co">## set populations to initial size</span></span>
<span>    <span class="fu">sim.addSubpop</span><span class="op">(</span><span class="st">"p1"</span>, <span class="fu">asInteger</span><span class="op">(</span><span class="va">init_pop</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    <span class="fu">sim.addSubpop</span><span class="op">(</span><span class="st">"p2"</span>, <span class="fu">asInteger</span><span class="op">(</span><span class="va">init_pop</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    <span class="fu">sim.addSubpop</span><span class="op">(</span><span class="st">"p3"</span>, <span class="fu">asInteger</span><span class="op">(</span><span class="va">init_pop</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="fu"><a href="../reference/slim_block.html">slim_block</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="../reference/late.html">late</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">{</span></span>
<span>    <span class="co">## get starting population from a file which we will fill-in later</span></span>
<span>    <span class="fu">sim.readFromPopulationFile</span><span class="op">(</span><span class="fu"><a href="../reference/r_inline.html">slimr_inline</a></span><span class="op">(</span><span class="va">starting_pop</span>, delay <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    <span class="co">## migration on or off flags for pops 1-3 (using tag)</span></span>
<span>    <span class="va">p1.tag</span> <span class="op">=</span> <span class="fl">0</span>;</span>
<span>    <span class="va">p2.tag</span> <span class="op">=</span> <span class="fl">0</span>;</span>
<span>    <span class="va">p3.tag</span> <span class="op">=</span> <span class="fl">0</span>;</span>
<span>  <span class="op">}</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="fu"><a href="../reference/slim_block.html">slim_block</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1000</span>, <span class="fu"><a href="../reference/late.html">late</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">{</span></span>
<span>    </span>
<span>    <span class="co">## update generation number</span></span>
<span>    <span class="co">## note in SLiM versions &lt; 4.0, this would be sim.generation instead</span></span>
<span>    <span class="va">gen</span> <span class="op">=</span> <span class="va">sim.cycle</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">50</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">gen</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">gen</span> <span class="op">=</span> <span class="fl">50</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co">## set population size to observed levels</span></span>
<span>    <span class="fu">p1.setSubpopulationSize</span><span class="op">(</span><span class="fu">asInteger</span><span class="op">(</span><span class="fu">ceil</span><span class="op">(</span><span class="va">abund</span><span class="op">[</span><span class="fl">0</span>, <span class="va">gen</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="../reference/r_template.html">slimr_template</a></span><span class="op">(</span><span class="st">"popsize_scaling"</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    <span class="fu">p2.setSubpopulationSize</span><span class="op">(</span><span class="fu">asInteger</span><span class="op">(</span><span class="fu">ceil</span><span class="op">(</span><span class="va">abund</span><span class="op">[</span><span class="fl">1</span>, <span class="va">gen</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">..popsize_scaling..</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    <span class="fu">p3.setSubpopulationSize</span><span class="op">(</span><span class="fu">asInteger</span><span class="op">(</span><span class="fu">ceil</span><span class="op">(</span><span class="va">abund</span><span class="op">[</span><span class="fl">2</span>, <span class="va">gen</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">..popsize_scaling..</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>;</span>
<span>    </span>
<span>    <span class="co">## increase migration when above abundance threshold</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">p1.tag</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">abund</span><span class="op">[</span><span class="fl">0</span>, <span class="va">gen</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fu"><a href="../reference/r_template.html">slimr_template</a></span><span class="op">(</span><span class="st">"abund_threshold"</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">p2.setMigrationRates</span><span class="op">(</span><span class="va">p1</span>, <span class="fu"><a href="../reference/r_template.html">slimr_template</a></span><span class="op">(</span><span class="st">"migration_rate"</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="fu">p3.setMigrationRates</span><span class="op">(</span><span class="va">p1</span>, <span class="va">..migration_rate..</span><span class="op">)</span></span>
<span>      <span class="va">p1.tag</span> <span class="op">=</span> <span class="fl">1</span>;</span>
<span>    <span class="op">}</span> </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">p1.tag</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">abund</span><span class="op">[</span><span class="fl">0</span>, <span class="va">gen</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="va">..abund_threshold..</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">p2.setMigrationRates</span><span class="op">(</span><span class="va">p1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>      <span class="fu">p3.setMigrationRates</span><span class="op">(</span><span class="va">p1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>      <span class="va">p1.tag</span> <span class="op">=</span> <span class="fl">0</span>;</span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">p2.tag</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">abund</span><span class="op">[</span><span class="fl">1</span>, <span class="va">gen</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">..abund_threshold..</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">p1.setMigrationRates</span><span class="op">(</span><span class="va">p2</span>, <span class="va">..migration_rate..</span><span class="op">)</span></span>
<span>      <span class="fu">p3.setMigrationRates</span><span class="op">(</span><span class="va">p2</span>, <span class="va">..migration_rate..</span><span class="op">)</span></span>
<span>      <span class="va">p2.tag</span> <span class="op">=</span> <span class="fl">1</span>;</span>
<span>    <span class="op">}</span> </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">p2.tag</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">abund</span><span class="op">[</span><span class="fl">1</span>, <span class="va">gen</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="va">..abund_threshold..</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">p1.setMigrationRates</span><span class="op">(</span><span class="va">p2</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>      <span class="fu">p3.setMigrationRates</span><span class="op">(</span><span class="va">p2</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>      <span class="va">p2.tag</span> <span class="op">=</span> <span class="fl">0</span>;</span>
<span>    <span class="op">}</span>    </span>
<span>    </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">p3.tag</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">abund</span><span class="op">[</span><span class="fl">2</span>, <span class="va">gen</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">..abund_threshold..</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">p1.setMigrationRates</span><span class="op">(</span><span class="va">p3</span>, <span class="va">..migration_rate..</span><span class="op">)</span></span>
<span>      <span class="fu">p2.setMigrationRates</span><span class="op">(</span><span class="va">p3</span>, <span class="va">..migration_rate..</span><span class="op">)</span></span>
<span>      <span class="va">p3.tag</span> <span class="op">=</span> <span class="fl">1</span>;</span>
<span>    <span class="op">}</span> </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">p3.tag</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">abund</span><span class="op">[</span><span class="fl">2</span>, <span class="va">gen</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="va">..abund_threshold..</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">p1.setMigrationRates</span><span class="op">(</span><span class="va">p3</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>      <span class="fu">p2.setMigrationRates</span><span class="op">(</span><span class="va">p3</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>      <span class="va">p3.tag</span> <span class="op">=</span> <span class="fl">0</span>;</span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co">## only run if the generation (cycle) is in our sample_these list</span></span>
<span>    <span class="co">## note in SLiM versions &lt; 4.0, this would be sim.generation instead of sim.cycle</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">sample_these</span>, <span class="va">sim.cycle</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co">## find the sample size that matches the matching "year" for our obs data</span></span>
<span>      <span class="va">ssizes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/drop.html" class="external-link">drop</a></span><span class="op">(</span><span class="va">samp_sizes</span><span class="op">[</span> , <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">sample_these</span> <span class="op">==</span> <span class="va">sim.cycle</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> </span>
<span>      <span class="co">## sample individuals</span></span>
<span>      <span class="va">ind_sample</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">p1.individuals</span>, <span class="va">ssizes</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">p2.individuals</span>, <span class="va">ssizes</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">p3.individuals</span>, <span class="va">ssizes</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="co">## output individuals genomes</span></span>
<span>      <span class="fu"><a href="../reference/r_output.html">slimr_output</a></span><span class="op">(</span><span class="fu">ind_sample.genomes.output</span><span class="op">(</span><span class="op">)</span>, <span class="st">"pop_sample"</span>, do_every <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>;</span>
<span>      <span class="fu"><a href="../reference/r_output.html">slimr_output</a></span><span class="op">(</span><span class="va">ind_sample.genomes.individual.subpopulation</span>, <span class="st">"subpops"</span>, do_every <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="fu"><a href="../reference/slim_block.html">slim_block</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fu"><a href="../reference/late.html">late</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">{</span></span>
<span>    <span class="fu">sim.simulationFinished</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">pop_sim_samp</span></span></code></pre></div>
<p>Let’s give it a try! Here we will demonstrate another feature of
<code>slimr</code>. By specifying a <code>reps</code> argument to
<code>slim_script_render</code> we can generate replicate simulations.
This returns a <code>slimr_script_coll</code> object, which stands for
slimr script collection. This can be run using <code>slim_run</code>
just like a regular <code>slimr_script</code>, but each simulation in
the collection will be run, either sequentially, or in parallel,
depending on what argument we use. We will run in parallel on 6 cores,
and run 6 replicates of our entire simulation, with the same parameters.
So then we will have 6 replicate samples within each simulation and 6
replicate simulation for a total of 36 replicates for each of our 3
sampling time points.</p>
<p>To run in parallel we must first set a plan for the package
<a href="https://future.futureverse.org" class="external-link">future</a>, which <a href="https://rdinnager.github.io/slimr">slimr</a> uses under the hood
for parallelism:</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu"><a href="https://future.futureverse.org/reference/multisession.html" class="external-link">multisession</a></span><span class="op">(</span>workers <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now we can run our script!</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samp_script</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slim_script_render.html">slim_script_render</a></span><span class="op">(</span><span class="va">pop_sim_samp</span>, template <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>migration_rate <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                                                                 selection_strength <span class="op">=</span> <span class="fl">1e-12</span>,</span>
<span>                                                                 abund_threshold <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>                                   reps <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Warning: A templated variable was not specified in the template and has been replaced by its default value.</span></span></code></pre>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samp_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slim_run.html">slim_run</a></span><span class="op">(</span><span class="va">samp_script</span>, throw_error <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Just to confirm we sampled the generations we wanted:</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">samp_res</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">output_data</span><span class="op">$</span><span class="va">generation</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] 740 745 749 790 795 799 840 845 849 890 895 899 940 945 949 990 995 999</span></span></code></pre>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample_these</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] 740 745 749 790 795 799 840 845 849 890 895 899 940 945 949 990 995 999</span></span></code></pre>
<p>The last step is to take the output of the simulation, convert it
into a set of <code>genlight</code> objects, and then calculate Fst on
those using the same function used to calculate Fst for our real data.
Then we can plot a distribution of expected Fst values at our three time
points based on this simulation, and compare that with our real data. We
can convert the genomic information to genlight using
<code><a href="../reference/slim_extract_genlight.html">slim_extract_genlight()</a></code>. By specifying the
<code>name</code> argument, <code><a href="../reference/slim_extract_genlight.html">slim_extract_genlight()</a></code> will
only use rows with that name. Additionally we can create a separate
genlight for each generation sample by using the <code>by</code>
argument, like this:</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slim_genlights</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slim_extract_genlight.html">slim_extract_genlight</a></span><span class="op">(</span><span class="va">samp_res</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, name <span class="op">=</span> <span class="st">"pop_sample"</span>,</span>
<span>                                       by <span class="op">=</span> <span class="st">"generation"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">slim_genlights</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">## # A tibble: 18 × 2</span></span>
<span><span class="co">##    generation genlight        </span></span>
<span><span class="co">##         &lt;int&gt; &lt;list&gt;          </span></span>
<span><span class="co">##  1        740 &lt;genlight[,509]&gt;</span></span>
<span><span class="co">##  2        745 &lt;genlight[,750]&gt;</span></span>
<span><span class="co">##  3        749 &lt;genlight[,624]&gt;</span></span>
<span><span class="co">##  4        790 &lt;genlight[,519]&gt;</span></span>
<span><span class="co">##  5        795 &lt;genlight[,754]&gt;</span></span>
<span><span class="co">##  6        799 &lt;genlight[,654]&gt;</span></span>
<span><span class="co">##  7        840 &lt;genlight[,308]&gt;</span></span>
<span><span class="co">##  8        845 &lt;genlight[,525]&gt;</span></span>
<span><span class="co">##  9        849 &lt;genlight[,427]&gt;</span></span>
<span><span class="co">## 10        890 &lt;genlight[,347]&gt;</span></span>
<span><span class="co">## 11        895 &lt;genlight[,550]&gt;</span></span>
<span><span class="co">## 12        899 &lt;genlight[,501]&gt;</span></span>
<span><span class="co">## 13        940 &lt;genlight[,408]&gt;</span></span>
<span><span class="co">## 14        945 &lt;genlight[,652]&gt;</span></span>
<span><span class="co">## 15        949 &lt;genlight[,538]&gt;</span></span>
<span><span class="co">## 16        990 &lt;genlight[,548]&gt;</span></span>
<span><span class="co">## 17        995 &lt;genlight[,810]&gt;</span></span>
<span><span class="co">## 18        999 &lt;genlight[,664]&gt;</span></span></code></pre>
<p>We now have a tibble containing genlight objects for each generation
sample. Let’s plot one to make sure it worked.</p>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">slim_genlights</span><span class="op">$</span><span class="va">genlight</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="Main_manuscript_example_v2_files/figure-html/plot_one_gl-1.png" width="80%"></p>
<p>Now because we output a sample of individuals’ genomes in our
simulation, and SLiM doesn’t include information on the subpopulation of
origin in its genome output, we also output the associated subpopulation
for each genome and included it the <code>"subpops"</code> data rows. We
can now extract this and reassociate with the genome data. This is
possible because SLiM always outputs this data in the same order. Note
that we sampled 50 individuals which means we have 100 genomes. These
were reassembled into individuals by
<code><a href="../reference/slim_extract_genlight.html">slim_extract_genlight()</a></code>, and we can likewise aggregate our
subpopulation information by noting that SLiM always outputs the two
genomes from a single individual one after the other. We can use the
<code>slimr</code> function <code><a href="../reference/slim_results_to_data.html">slim_results_to_data()</a></code> function
which automatically attempts to convert the data stored in our results
object to usable data in the form of a tibble. This also works with
a</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slim_subpops</span> <span class="op">&lt;-</span> <span class="va">samp_res</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">output_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"subpops"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/slim_results_to_data.html">slim_results_to_data</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">slim_subpops</span> </span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">## # A tibble: 18 × 5</span></span>
<span><span class="co">##    type                                        expression generation name  data </span></span>
<span><span class="co">##    &lt;chr&gt;                                       &lt;chr&gt;           &lt;int&gt; &lt;chr&gt; &lt;lis&gt;</span></span>
<span><span class="co">##  1 "object&lt;Subpopulation&gt; [0:73] Subpopulatio… ind_sampl…        740 subp… &lt;chr&gt;</span></span>
<span><span class="co">##  2 "object&lt;Subpopulation&gt; [0:155] Subpopulati… ind_sampl…        745 subp… &lt;chr&gt;</span></span>
<span><span class="co">##  3 "object&lt;Subpopulation&gt; [0:65] Subpopulatio… ind_sampl…        749 subp… &lt;chr&gt;</span></span>
<span><span class="co">##  4 "object&lt;Subpopulation&gt; [0:73] Subpopulatio… ind_sampl…        790 subp… &lt;chr&gt;</span></span>
<span><span class="co">##  5 "object&lt;Subpopulation&gt; [0:155] Subpopulati… ind_sampl…        795 subp… &lt;chr&gt;</span></span>
<span><span class="co">##  6 "object&lt;Subpopulation&gt; [0:65] Subpopulatio… ind_sampl…        799 subp… &lt;chr&gt;</span></span>
<span><span class="co">##  7 "object&lt;Subpopulation&gt; [0:73] Subpopulatio… ind_sampl…        840 subp… &lt;chr&gt;</span></span>
<span><span class="co">##  8 "object&lt;Subpopulation&gt; [0:155] Subpopulati… ind_sampl…        845 subp… &lt;chr&gt;</span></span>
<span><span class="co">##  9 "object&lt;Subpopulation&gt; [0:65] Subpopulatio… ind_sampl…        849 subp… &lt;chr&gt;</span></span>
<span><span class="co">## 10 "object&lt;Subpopulation&gt; [0:73] Subpopulatio… ind_sampl…        890 subp… &lt;chr&gt;</span></span>
<span><span class="co">## 11 "object&lt;Subpopulation&gt; [0:155] Subpopulati… ind_sampl…        895 subp… &lt;chr&gt;</span></span>
<span><span class="co">## 12 "object&lt;Subpopulation&gt; [0:65] Subpopulatio… ind_sampl…        899 subp… &lt;chr&gt;</span></span>
<span><span class="co">## 13 "object&lt;Subpopulation&gt; [0:73] Subpopulatio… ind_sampl…        940 subp… &lt;chr&gt;</span></span>
<span><span class="co">## 14 "object&lt;Subpopulation&gt; [0:155] Subpopulati… ind_sampl…        945 subp… &lt;chr&gt;</span></span>
<span><span class="co">## 15 "object&lt;Subpopulation&gt; [0:65] Subpopulatio… ind_sampl…        949 subp… &lt;chr&gt;</span></span>
<span><span class="co">## 16 "object&lt;Subpopulation&gt; [0:73] Subpopulatio… ind_sampl…        990 subp… &lt;chr&gt;</span></span>
<span><span class="co">## 17 "object&lt;Subpopulation&gt; [0:155] Subpopulati… ind_sampl…        995 subp… &lt;chr&gt;</span></span>
<span><span class="co">## 18 "object&lt;Subpopulation&gt; [0:65] Subpopulatio… ind_sampl…        999 subp… &lt;chr&gt;</span></span></code></pre>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slim_subpops</span> <span class="op">&lt;-</span> <span class="va">slim_subpops</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_longer.html" class="external-link">unnest_longer</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">data</span>, values_to <span class="op">=</span> <span class="st">"subpop"</span>, indices_to <span class="op">=</span> <span class="st">"genome_num"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>individual_num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">samp_sizes</span><span class="op">[</span> , <span class="fl">1</span><span class="op">]</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                            <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">samp_sizes</span><span class="op">[</span> , <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                            <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">samp_sizes</span><span class="op">[</span> , <span class="fl">3</span><span class="op">]</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">slim_subpops</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">## # A tibble: 1,776 × 7</span></span>
<span><span class="co">##    type             expression generation name  subpop genome_num individual_num</span></span>
<span><span class="co">##    &lt;chr&gt;            &lt;chr&gt;           &lt;int&gt; &lt;chr&gt; &lt;chr&gt;       &lt;int&gt;          &lt;int&gt;</span></span>
<span><span class="co">##  1 "object&lt;Subpopu… ind_sampl…        740 subp… Subpo…          1              1</span></span>
<span><span class="co">##  2 "object&lt;Subpopu… ind_sampl…        740 subp… Subpo…          2              1</span></span>
<span><span class="co">##  3 "object&lt;Subpopu… ind_sampl…        740 subp… Subpo…          3              2</span></span>
<span><span class="co">##  4 "object&lt;Subpopu… ind_sampl…        740 subp… Subpo…          4              2</span></span>
<span><span class="co">##  5 "object&lt;Subpopu… ind_sampl…        740 subp… Subpo…          5              3</span></span>
<span><span class="co">##  6 "object&lt;Subpopu… ind_sampl…        740 subp… Subpo…          6              3</span></span>
<span><span class="co">##  7 "object&lt;Subpopu… ind_sampl…        740 subp… Subpo…          7              4</span></span>
<span><span class="co">##  8 "object&lt;Subpopu… ind_sampl…        740 subp… Subpo…          8              4</span></span>
<span><span class="co">##  9 "object&lt;Subpopu… ind_sampl…        740 subp… Subpo…          9              5</span></span>
<span><span class="co">## 10 "object&lt;Subpopu… ind_sampl…        740 subp… Subpo…         10              5</span></span>
<span><span class="co">## # ℹ 1,766 more rows</span></span></code></pre>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slim_subpops</span> <span class="op">&lt;-</span> <span class="va">slim_subpops</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">generation</span>, <span class="va">individual_num</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>subpop <span class="op">=</span> <span class="va">subpop</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>            .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">slim_subpops</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">## # A tibble: 888 × 3</span></span>
<span><span class="co">##    generation individual_num subpop           </span></span>
<span><span class="co">##         &lt;int&gt;          &lt;int&gt; &lt;chr&gt;            </span></span>
<span><span class="co">##  1        740              1 Subpopulation&lt;p1&gt;</span></span>
<span><span class="co">##  2        740              2 Subpopulation&lt;p1&gt;</span></span>
<span><span class="co">##  3        740              3 Subpopulation&lt;p1&gt;</span></span>
<span><span class="co">##  4        740              4 Subpopulation&lt;p1&gt;</span></span>
<span><span class="co">##  5        740              5 Subpopulation&lt;p1&gt;</span></span>
<span><span class="co">##  6        740              6 Subpopulation&lt;p1&gt;</span></span>
<span><span class="co">##  7        740              7 Subpopulation&lt;p1&gt;</span></span>
<span><span class="co">##  8        740              8 Subpopulation&lt;p1&gt;</span></span>
<span><span class="co">##  9        740              9 Subpopulation&lt;p1&gt;</span></span>
<span><span class="co">## 10        740             10 Subpopulation&lt;p1&gt;</span></span>
<span><span class="co">## # ℹ 878 more rows</span></span></code></pre>
<p>Okay, now we can add this to the genlights we generated earlier.</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## reorder by individual label</span></span>
<span><span class="va">slim_genlights</span><span class="op">$</span><span class="va">genlight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">slim_genlights</span><span class="op">$</span><span class="va">genlight</span>,</span>
<span>                               <span class="op">~</span><span class="va">.x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">ind.names</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## add subpop data</span></span>
<span><span class="va">slim_genlights</span><span class="op">$</span><span class="va">genlight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2</a></span><span class="op">(</span><span class="va">slim_genlights</span><span class="op">$</span><span class="va">genlight</span>, </span>
<span>                                <span class="va">slim_subpops</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                                  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_split.html" class="external-link">group_split</a></span><span class="op">(</span><span class="va">generation</span><span class="op">)</span>,</span>
<span>                                <span class="op">~</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/pkg/adegenet/man/accessors.html" class="external-link">pop</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">.y</span><span class="op">$</span><span class="va">subpop</span>; <span class="va">.x</span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Let’s look at that plot again but reordered by population.</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_gl</span> <span class="op">&lt;-</span> <span class="va">slim_genlights</span><span class="op">$</span><span class="va">genlight</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">test_gl</span> <span class="op">&lt;-</span> <span class="va">test_gl</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/adegenet/man/accessors.html" class="external-link">pop</a></span><span class="op">(</span><span class="va">test_gl</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">test_gl</span><span class="op">)</span></span></code></pre></div>
<p><img src="Main_manuscript_example_v2_files/figure-html/plot_reordered-1.png" width="80%"></p>
<p>Now we are ready to calculate our pairwise Fsts for each sample.</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fst_by_generation_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">slim_genlights</span><span class="op">$</span><span class="va">genlight</span>,</span>
<span>                   <span class="op">~</span><span class="fu">pairFST</span><span class="op">(</span><span class="va">.x</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">as.dist</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fst_by_generation_sim</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">slim_genlights</span><span class="op">$</span><span class="va">generation</span></span>
<span><span class="va">fst_by_generation_sim</span></span></code></pre></div>
<pre><code><span><span class="co">## $`740`</span></span>
<span><span class="co">##                   Subpopulation&lt;p1&gt; Subpopulation&lt;p2&gt; Subpopulation&lt;p3&gt;</span></span>
<span><span class="co">## Subpopulation&lt;p1&gt;       0.000000000       0.006868622        0.01071799</span></span>
<span><span class="co">## Subpopulation&lt;p2&gt;       0.006868622       0.000000000        0.01590407</span></span>
<span><span class="co">## Subpopulation&lt;p3&gt;       0.010717986       0.015904072        0.00000000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`745`</span></span>
<span><span class="co">##                   Subpopulation&lt;p1&gt; Subpopulation&lt;p2&gt; Subpopulation&lt;p3&gt;</span></span>
<span><span class="co">## Subpopulation&lt;p1&gt;       0.000000000       0.007452122       0.007390905</span></span>
<span><span class="co">## Subpopulation&lt;p2&gt;       0.007452122       0.000000000       0.009817015</span></span>
<span><span class="co">## Subpopulation&lt;p3&gt;       0.007390905       0.009817015       0.000000000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`749`</span></span>
<span><span class="co">##                   Subpopulation&lt;p1&gt; Subpopulation&lt;p2&gt; Subpopulation&lt;p3&gt;</span></span>
<span><span class="co">## Subpopulation&lt;p1&gt;        0.00000000        0.01224182        0.01722751</span></span>
<span><span class="co">## Subpopulation&lt;p2&gt;        0.01224182        0.00000000        0.01584085</span></span>
<span><span class="co">## Subpopulation&lt;p3&gt;        0.01722751        0.01584085        0.00000000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`790`</span></span>
<span><span class="co">##                   Subpopulation&lt;p1&gt; Subpopulation&lt;p2&gt; Subpopulation&lt;p3&gt;</span></span>
<span><span class="co">## Subpopulation&lt;p1&gt;       0.000000000       0.008190359        0.02748787</span></span>
<span><span class="co">## Subpopulation&lt;p2&gt;       0.008190359       0.000000000        0.02376266</span></span>
<span><span class="co">## Subpopulation&lt;p3&gt;       0.027487866       0.023762659        0.00000000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`795`</span></span>
<span><span class="co">##                   Subpopulation&lt;p1&gt; Subpopulation&lt;p2&gt; Subpopulation&lt;p3&gt;</span></span>
<span><span class="co">## Subpopulation&lt;p1&gt;        0.00000000       0.019101570       0.015305827</span></span>
<span><span class="co">## Subpopulation&lt;p2&gt;        0.01910157       0.000000000       0.007011274</span></span>
<span><span class="co">## Subpopulation&lt;p3&gt;        0.01530583       0.007011274       0.000000000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`799`</span></span>
<span><span class="co">##                   Subpopulation&lt;p1&gt; Subpopulation&lt;p2&gt; Subpopulation&lt;p3&gt;</span></span>
<span><span class="co">## Subpopulation&lt;p1&gt;        0.00000000        0.02937367        0.02953601</span></span>
<span><span class="co">## Subpopulation&lt;p2&gt;        0.02937367        0.00000000        0.01304019</span></span>
<span><span class="co">## Subpopulation&lt;p3&gt;        0.02953601        0.01304019        0.00000000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`840`</span></span>
<span><span class="co">##                   Subpopulation&lt;p1&gt; Subpopulation&lt;p2&gt; Subpopulation&lt;p3&gt;</span></span>
<span><span class="co">## Subpopulation&lt;p1&gt;        0.00000000        0.01790289        0.03155570</span></span>
<span><span class="co">## Subpopulation&lt;p2&gt;        0.01790289        0.00000000        0.04443851</span></span>
<span><span class="co">## Subpopulation&lt;p3&gt;        0.03155570        0.04443851        0.00000000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`845`</span></span>
<span><span class="co">##                   Subpopulation&lt;p1&gt; Subpopulation&lt;p2&gt; Subpopulation&lt;p3&gt;</span></span>
<span><span class="co">## Subpopulation&lt;p1&gt;       0.000000000       0.008468425       0.009469408</span></span>
<span><span class="co">## Subpopulation&lt;p2&gt;       0.008468425       0.000000000       0.007178540</span></span>
<span><span class="co">## Subpopulation&lt;p3&gt;       0.009469408       0.007178540       0.000000000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`849`</span></span>
<span><span class="co">##                   Subpopulation&lt;p1&gt; Subpopulation&lt;p2&gt; Subpopulation&lt;p3&gt;</span></span>
<span><span class="co">## Subpopulation&lt;p1&gt;        0.00000000        0.05451409        0.03534917</span></span>
<span><span class="co">## Subpopulation&lt;p2&gt;        0.05451409        0.00000000        0.01496291</span></span>
<span><span class="co">## Subpopulation&lt;p3&gt;        0.03534917        0.01496291        0.00000000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`890`</span></span>
<span><span class="co">##                   Subpopulation&lt;p1&gt; Subpopulation&lt;p2&gt; Subpopulation&lt;p3&gt;</span></span>
<span><span class="co">## Subpopulation&lt;p1&gt;        0.00000000        0.01805284        0.06063659</span></span>
<span><span class="co">## Subpopulation&lt;p2&gt;        0.01805284        0.00000000        0.09274040</span></span>
<span><span class="co">## Subpopulation&lt;p3&gt;        0.06063659        0.09274040        0.00000000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`895`</span></span>
<span><span class="co">##                   Subpopulation&lt;p1&gt; Subpopulation&lt;p2&gt; Subpopulation&lt;p3&gt;</span></span>
<span><span class="co">## Subpopulation&lt;p1&gt;       0.000000000        0.03619680       0.007898948</span></span>
<span><span class="co">## Subpopulation&lt;p2&gt;       0.036196796        0.00000000       0.025193171</span></span>
<span><span class="co">## Subpopulation&lt;p3&gt;       0.007898948        0.02519317       0.000000000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`899`</span></span>
<span><span class="co">##                   Subpopulation&lt;p1&gt; Subpopulation&lt;p2&gt; Subpopulation&lt;p3&gt;</span></span>
<span><span class="co">## Subpopulation&lt;p1&gt;        0.00000000        0.03030347        0.02855643</span></span>
<span><span class="co">## Subpopulation&lt;p2&gt;        0.03030347        0.00000000        0.02647997</span></span>
<span><span class="co">## Subpopulation&lt;p3&gt;        0.02855643        0.02647997        0.00000000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`940`</span></span>
<span><span class="co">##                   Subpopulation&lt;p1&gt; Subpopulation&lt;p2&gt; Subpopulation&lt;p3&gt;</span></span>
<span><span class="co">## Subpopulation&lt;p1&gt;        0.00000000        0.01182880        0.02001984</span></span>
<span><span class="co">## Subpopulation&lt;p2&gt;        0.01182880        0.00000000        0.02763523</span></span>
<span><span class="co">## Subpopulation&lt;p3&gt;        0.02001984        0.02763523        0.00000000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`945`</span></span>
<span><span class="co">##                   Subpopulation&lt;p1&gt; Subpopulation&lt;p2&gt; Subpopulation&lt;p3&gt;</span></span>
<span><span class="co">## Subpopulation&lt;p1&gt;       0.000000000       0.012288572       0.007830131</span></span>
<span><span class="co">## Subpopulation&lt;p2&gt;       0.012288572       0.000000000       0.008468013</span></span>
<span><span class="co">## Subpopulation&lt;p3&gt;       0.007830131       0.008468013       0.000000000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`949`</span></span>
<span><span class="co">##                   Subpopulation&lt;p1&gt; Subpopulation&lt;p2&gt; Subpopulation&lt;p3&gt;</span></span>
<span><span class="co">## Subpopulation&lt;p1&gt;        0.00000000        0.02418577        0.03688533</span></span>
<span><span class="co">## Subpopulation&lt;p2&gt;        0.02418577        0.00000000        0.01777150</span></span>
<span><span class="co">## Subpopulation&lt;p3&gt;        0.03688533        0.01777150        0.00000000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`990`</span></span>
<span><span class="co">##                   Subpopulation&lt;p1&gt; Subpopulation&lt;p2&gt; Subpopulation&lt;p3&gt;</span></span>
<span><span class="co">## Subpopulation&lt;p1&gt;        0.00000000        0.02521869        0.03493360</span></span>
<span><span class="co">## Subpopulation&lt;p2&gt;        0.02521869        0.00000000        0.03465002</span></span>
<span><span class="co">## Subpopulation&lt;p3&gt;        0.03493360        0.03465002        0.00000000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`995`</span></span>
<span><span class="co">##                   Subpopulation&lt;p1&gt; Subpopulation&lt;p2&gt; Subpopulation&lt;p3&gt;</span></span>
<span><span class="co">## Subpopulation&lt;p1&gt;        0.00000000       0.011318902       0.010413951</span></span>
<span><span class="co">## Subpopulation&lt;p2&gt;        0.01131890       0.000000000       0.005724975</span></span>
<span><span class="co">## Subpopulation&lt;p3&gt;        0.01041395       0.005724975       0.000000000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`999`</span></span>
<span><span class="co">##                   Subpopulation&lt;p1&gt; Subpopulation&lt;p2&gt; Subpopulation&lt;p3&gt;</span></span>
<span><span class="co">## Subpopulation&lt;p1&gt;         0.0000000        0.02618320        0.02459370</span></span>
<span><span class="co">## Subpopulation&lt;p2&gt;         0.0261832        0.00000000        0.03405698</span></span>
<span><span class="co">## Subpopulation&lt;p3&gt;         0.0245937        0.03405698        0.00000000</span></span></code></pre>
<p>So in this simulation we have very low pairwise fst, including a fair
number of negative numbers. This is expected given the high level of
migration we used in the simulation (essentially we simulated just one
panmictic population, with very weak selection). Now we can write a
little function to summarise these results, and plot them along with our
observed values. We will also write some new code to get the data from
all 6 of our simulation replicates and combine them. Then we can run a
few more simulations with different parameters and see how they stack
up!</p>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_result</span> <span class="op">&lt;-</span> <span class="va">samp_res</span></span>
<span><span class="va">observed_fst</span> <span class="op">&lt;-</span> <span class="va">fst_df</span></span>
<span><span class="va">plot_fst_comparison</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sim_result</span>, <span class="va">observed_fst</span>, <span class="va">tech_reps</span> <span class="op">=</span> <span class="fl">6L</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">slim_genlights</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slim_extract_genlight.html">slim_extract_genlight</a></span><span class="op">(</span><span class="va">sim_result</span>, name <span class="op">=</span> <span class="st">"pop_sample"</span>,</span>
<span>                                       by <span class="op">=</span> <span class="st">"generation"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sim_result</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"rep_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">sim_result</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">slim_subpops</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">imap_dfr</a></span><span class="op">(</span><span class="va">sim_result</span>, <span class="op">~</span> <span class="va">.x</span><span class="op">$</span><span class="va">output_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"subpops"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">generation</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co">## deals with an intermittent bug</span></span>
<span>                            <span class="fu"><a href="../reference/slim_results_to_data.html">slim_results_to_data</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                            <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_longer.html" class="external-link">unnest_longer</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">data</span>, values_to <span class="op">=</span> <span class="st">"subpop"</span>,</span>
<span>                                          indices_to <span class="op">=</span> <span class="st">"genome_num"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>individual_num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">samp_sizes</span><span class="op">[</span> ,</span>
<span>                                                                            <span class="fl">1</span><span class="op">]</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                                                      <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">samp_sizes</span><span class="op">[</span> , <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                                                      <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">samp_sizes</span><span class="op">[</span> , <span class="fl">3</span><span class="op">]</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                                     <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">tech_reps</span><span class="op">)</span>,</span>
<span>                                   rep <span class="op">=</span> <span class="va">.y</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">generation</span>, <span class="va">individual_num</span>, <span class="va">rep</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>subpop <span class="op">=</span> <span class="va">subpop</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                                      .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## reorder by individual label</span></span>
<span>  <span class="va">slim_genlights</span><span class="op">$</span><span class="va">genlight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">slim_genlights</span><span class="op">$</span><span class="va">genlight</span>,</span>
<span>                                 <span class="op">~</span><span class="va">.x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">ind.names</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span></span>
<span>  <span class="co">## add subpop data</span></span>
<span>  <span class="va">slim_genlights</span><span class="op">$</span><span class="va">genlight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2</a></span><span class="op">(</span><span class="va">slim_genlights</span><span class="op">$</span><span class="va">genlight</span>, </span>
<span>                                  <span class="va">slim_subpops</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_split.html" class="external-link">group_split</a></span><span class="op">(</span><span class="va">rep</span>, <span class="va">generation</span><span class="op">)</span>,</span>
<span>                                  <span class="op">~</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/pkg/adegenet/man/accessors.html" class="external-link">pop</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">.y</span><span class="op">$</span><span class="va">subpop</span>; <span class="va">.x</span><span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="va">fst_by_year_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">slim_genlights</span><span class="op">$</span><span class="va">genlight</span>,</span>
<span>                     <span class="op">~</span><span class="fu">pairFST</span><span class="op">(</span><span class="va">.x</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">as.dist</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2006"</span>, <span class="st">"2007"</span>, <span class="st">"2008"</span><span class="op">)</span>, <span class="va">tech_reps</span> <span class="op">*</span> <span class="fl">6</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="va">fst_sim_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">imap_dfr</a></span><span class="op">(</span><span class="va">fst_by_year_sim</span>,</span>
<span>                     <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/utils/combn.html" class="external-link">combn</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Subpopulation&lt;p1&gt;"</span>, </span>
<span>                              <span class="st">"Subpopulation&lt;p2&gt;"</span>, </span>
<span>                              <span class="st">"Subpopulation&lt;p3&gt;"</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>pop1 <span class="op">=</span> <span class="va">V1</span>, pop2 <span class="op">=</span> <span class="va">V2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>fst <span class="op">=</span> <span class="va">.x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">pop1</span>, <span class="va">pop2</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                              year <span class="op">=</span> <span class="va">years</span><span class="op">[</span><span class="va">.y</span><span class="op">]</span>,</span>
<span>                              rep <span class="op">=</span> <span class="va">slim_genlights</span><span class="op">$</span><span class="va">rep</span><span class="op">[</span><span class="va">.y</span><span class="op">]</span>,</span>
<span>                              generation <span class="op">=</span> <span class="va">slim_genlights</span><span class="op">$</span><span class="va">generation</span><span class="op">[</span><span class="va">.y</span><span class="op">]</span>,</span>
<span>                              pop_combo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">pop1</span>, <span class="va">pop2</span>, sep <span class="op">=</span> <span class="st">" to "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">rep</span>, <span class="va">generation</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>fst <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">fst</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>iter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">tech_reps</span><span class="op">*</span><span class="fl">6</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">all_summ</span> <span class="op">&lt;-</span> <span class="va">fst_sim_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>fst_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">fst</span><span class="op">)</span>, fst_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">fst</span><span class="op">)</span>,</span>
<span>              fst <span class="op">=</span> <span class="va">fst_mean</span>,</span>
<span>              .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">fst_obs_df</span> <span class="op">&lt;-</span> <span class="va">observed_fst</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>fst_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">fst</span><span class="op">)</span>,</span>
<span>              fst <span class="op">=</span> <span class="va">fst_mean</span>,</span>
<span>              iter <span class="op">=</span> <span class="fl">99999</span>,</span>
<span>              .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">fst_plot_df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">fst_sim_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"simulated"</span><span class="op">)</span>,</span>
<span>                           <span class="va">fst_obs_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"observed"</span><span class="op">)</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="va">fst_plot_df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">all_summ</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"simulated"</span><span class="op">)</span>,</span>
<span>                           <span class="va">fst_obs_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"observed"</span><span class="op">)</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">fst_plot_df1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">fst</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">fst_mean</span> <span class="op">-</span> <span class="va">fst_sd</span>,</span>
<span>                      ymax <span class="op">=</span> <span class="va">fst_mean</span> <span class="op">+</span> <span class="va">fst_sd</span><span class="op">)</span>,</span>
<span>                  width <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                  data <span class="op">=</span> <span class="va">all_summ</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span>, alpha <span class="op">=</span> <span class="va">type</span>, size <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span>, alpha <span class="op">=</span> <span class="va">type</span>, group <span class="op">=</span> <span class="va">iter</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">fst</span><span class="op">)</span>,  size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>               data <span class="op">=</span> <span class="va">all_summ</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">fst</span><span class="op">)</span>, group <span class="op">=</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">all_summ</span>, </span>
<span>              inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_alpha_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_size_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="va">p1</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">plot_fst_comparison</span><span class="op">(</span><span class="va">samp_res</span>, <span class="va">fst_df</span><span class="op">)</span></span></code></pre></div>
<p><img src="Main_manuscript_example_v2_files/figure-html/plot_fst_fun-1.png" width="80%"></p>
<p>This function plots the means of the pairwise Fst calculated from the
simulation along with error bars representing 2 standard deviations
around the mean, and the blue lines are each of the 36 replicates (6
temporal times 6 simulation runs). The red dots are the observed data.
In this case, the match is not bad, the simulation generates a drop is
Fst in 2007, with a rebound in 2008, but overall the Fst values are too
low and the rebound is too strong. Let’s try running our simulation
again with some of the parameter combinations we explored earlier and
see how this plot looks for them!</p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## set migration rate to 0.5 (maximum migration, e.g. 50% of population switches place)</span></span>
<span><span class="co">## population will become panmictic over a certain popsize threshold</span></span>
<span><span class="va">fst_samp_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slim_script_render.html">slim_script_render</a></span><span class="op">(</span><span class="va">pop_sim_samp</span>, template <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>migration_rate <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                                                                selection_strength <span class="op">=</span> <span class="fl">1e-12</span><span class="op">)</span>,</span>
<span>                                  reps <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Warning: A templated variable was not specified in the template and has been replaced by its default value.</span></span></code></pre>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## now run the sim and show plots of results</span></span>
<span><span class="va">samp_res_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slim_run.html">slim_run</a></span><span class="op">(</span><span class="va">fst_samp_2</span>, throw_error <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                       parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">plot_fst_comparison</span><span class="op">(</span><span class="va">samp_res_2</span>, <span class="va">fst_df</span><span class="op">)</span></span></code></pre></div>
<p><img src="Main_manuscript_example_v2_files/figure-html/more_sims_1-1.png" width="80%"></p>
<p>Okay, well that simulation produces Fsts within a similar average
range as the observed, but interestingly Fst is too high in 2006 and
then too low in 2007 and 2008 during and after the rainfall event. This
is something that we couldn’t tell from the plots of Fst over time,
which showed fluctuations but did not show the detail of exactly when
the fluctuations occurred. Let’s try another set of parameters!</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## set migration rate to 0.5 (maximum migration, e.g. 50% of population switches place)</span></span>
<span><span class="co">## population is panmictic all the time with abund_threshold = 0,</span></span>
<span><span class="co">## now there is stronger selection too</span></span>
<span><span class="va">fst_samp_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slim_script_render.html">slim_script_render</a></span><span class="op">(</span><span class="va">pop_sim_samp</span>, template <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>migration_rate <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                                                                selection_strength <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>                                                                abund_threshold <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>                                  reps <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Warning: A templated variable was not specified in the template and has been replaced by its default value.</span></span></code></pre>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## now run the sim and show plots of results</span></span>
<span><span class="va">samp_res_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slim_run.html">slim_run</a></span><span class="op">(</span><span class="va">fst_samp_3</span>, throw_error <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                       parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">plot_fst_comparison</span><span class="op">(</span><span class="va">samp_res_3</span>, <span class="va">fst_df</span><span class="op">)</span></span></code></pre></div>
<p><img src="Main_manuscript_example_v2_files/figure-html/more_sims_2-1.png" width="80%"></p>
<p>Now the pattern across years is again similar to the real data,
though again the rebound is a little too strong and again overall Fst
values are too low. To me, the second simulation that was based most
strongly on our hypothesis was quite promising. Let’s tweak the
parameters of that one slightly to see if we can get a bit better
fit.</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fst_samp_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slim_script_render.html">slim_script_render</a></span><span class="op">(</span><span class="va">pop_sim_samp</span>, template <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>migration_rate <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>                                                                selection_strength <span class="op">=</span> <span class="fl">1e-12</span>,</span>
<span>                                                                abund_threshold <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                                  reps <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Warning: A templated variable was not specified in the template and has been replaced by its default value.</span></span></code></pre>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## now run the sim and show plots of results</span></span>
<span><span class="va">samp_res_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slim_run.html">slim_run</a></span><span class="op">(</span><span class="va">fst_samp_4</span>, throw_error <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                       parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">plot_fst_comparison</span><span class="op">(</span><span class="va">samp_res_4</span>, <span class="va">fst_df</span><span class="op">)</span></span></code></pre></div>
<p><img src="Main_manuscript_example_v2_files/figure-html/more_sims_3-1.png" width="80%"></p>
<p>So that is not much better. So far, we haven’t found a perfect
simulation, but we have discovered that quite a range of different
evolutionary scenarios can create fairly similar patterns. The next step
may be to do some formal fitting of the simulation data to the observed
using a method such as Approximate Bayesian Computation (ABC). This
would be straightforward using <code>slimr</code>, since R already has
good packages for performing ABC with custom simulation code. It may be
the case that for distinguishing the evolutionary forces we are
interested in here that we may need more data, or data of a different
kind. We could also use simulation to further ask, is there anything we
could measure or calculate, besides Fst, from the genomes of
individuals, that could better distinguish multiple evolutionary forces?
I will leave that project up to future work, but hopefully I have
demonstrated the potential of having a tighter integration between data
analysis platforms and simulation software.</p>
<p>Last but not least, this is the session information for this run of
the above code. We can only guarantee reproducibility of this document
if the session where it is being run matches the following:</p>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-lib/sessioninfo#readme" class="external-link">sessioninfo</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-lib.github.io/sessioninfo/reference/session_info.html" class="external-link">session_info</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">## ─ Session info ───────────────────────────────────────────────────────────────</span></span>
<span><span class="co">##  setting  value</span></span>
<span><span class="co">##  version  R version 4.3.2 (2023-10-31 ucrt)</span></span>
<span><span class="co">##  os       Windows 11 x64 (build 22000)</span></span>
<span><span class="co">##  system   x86_64, mingw32</span></span>
<span><span class="co">##  ui       RTerm</span></span>
<span><span class="co">##  language en</span></span>
<span><span class="co">##  collate  English_Australia.utf8</span></span>
<span><span class="co">##  ctype    English_Australia.utf8</span></span>
<span><span class="co">##  tz       America/New_York</span></span>
<span><span class="co">##  date     2023-12-18</span></span>
<span><span class="co">##  pandoc   3.1.1 @ C:/Program Files/RStudio/resources/app/bin/quarto/bin/tools/ (via rmarkdown)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ─ Packages ───────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">##  package           * version   date (UTC) lib source</span></span>
<span><span class="co">##  ade4              * 1.7-22    2023-02-06 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  adegenet          * 2.1.10    2023-01-26 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  ape                 5.7-1     2023-03-13 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  base64enc           0.1-3     2015-07-28 [2] CRAN (R 4.3.1)</span></span>
<span><span class="co">##  bit                 4.0.5     2022-11-15 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  bit64               4.0.5     2020-08-30 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  brew                1.0-8     2022-09-29 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  bslib               0.5.1     2023-08-11 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  cachem              1.0.8     2023-05-01 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  calibrate           1.7.7     2020-06-19 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  class               7.3-22    2023-05-03 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  classInt            0.4-10    2023-09-05 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  cli                 3.6.1     2023-03-23 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  cluster             2.1.4     2022-08-22 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  codetools           0.2-19    2023-02-01 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  colorspace          2.1-0     2023-01-23 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  combinat            0.0-8     2012-10-29 [2] CRAN (R 4.3.1)</span></span>
<span><span class="co">##  conflicted        * 1.2.0     2023-02-01 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  crayon              1.5.2     2022-09-29 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  crosstalk           1.2.0     2021-11-04 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  dartR             * 2.9.7     2023-06-07 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  dartR.data        * 1.0.2     2022-11-16 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  data.table          1.14.8    2023-02-17 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  DBI                 1.1.3     2022-06-18 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  desc                1.4.2     2022-09-08 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  digest              0.6.33    2023-07-07 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  directlabels      * 2023.8.25 2023-09-01 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  dismo               1.3-14    2023-05-21 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  doParallel          1.0.17    2022-02-07 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  dotCall64           1.1-0     2023-10-17 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  dplyr             * 1.1.3     2023-09-03 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  e1071               1.7-13    2023-02-01 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  ellipsis            0.3.2     2021-04-29 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  evaluate            0.23      2023-11-01 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  fansi               1.0.5     2023-10-08 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  farver              2.1.1     2022-07-06 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  fastmap             1.1.1     2023-02-24 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  fields              15.2      2023-08-17 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  foreach             1.5.2     2022-02-02 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  fs                  1.6.3     2023-07-20 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  furrr             * 0.3.1     2022-08-15 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  future            * 1.33.0    2023-07-01 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  gap                 1.5-3     2023-08-26 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  gap.datasets        0.0.6     2023-08-25 [2] CRAN (R 4.3.1)</span></span>
<span><span class="co">##  gdata               3.0.0     2023-10-16 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  gdistance           1.6.4     2023-06-19 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  gdsfmt            * 1.38.0    2023-10-24 [2] Bioconductor</span></span>
<span><span class="co">##  generics            0.1.3     2022-07-05 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  genetics            1.3.8.1.3 2021-03-01 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  GGally              2.1.2     2021-06-21 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  gganimate         * 1.0.8     2022-09-08 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  ggforce           * 0.4.1     2022-10-04 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  ggplot2           * 3.4.4     2023-10-12 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  gifski              1.12.0-2  2023-08-12 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  globals             0.16.2    2022-11-21 [2] CRAN (R 4.3.1)</span></span>
<span><span class="co">##  glue                1.6.2     2022-02-24 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  gridExtra           2.3       2017-09-09 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  gtable              0.3.4     2023-08-21 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  gtools              3.9.4     2022-11-27 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  here              * 1.0.1     2020-12-13 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  highr               0.10      2022-12-22 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  hms                 1.1.3     2023-03-21 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  htmltools           0.5.7     2023-11-03 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  htmlwidgets         1.6.2     2023-03-17 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  httpuv              1.6.12    2023-10-23 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  igraph              1.5.1     2023-08-10 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  iterators           1.0.14    2022-02-05 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  jquerylib           0.1.4     2021-04-26 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  jsonlite            1.8.7     2023-06-29 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  KernSmooth          2.23-22   2023-07-10 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  knitr               1.45      2023-10-30 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  labeling            0.4.3     2023-08-29 [2] CRAN (R 4.3.1)</span></span>
<span><span class="co">##  later               1.3.1     2023-05-02 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  lattice             0.21-9    2023-10-01 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  leafem              0.2.3     2023-09-17 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  leaflet             2.2.1     2023-11-13 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  leaflet.providers   2.0.0     2023-10-17 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  leafpop             0.1.0     2021-05-22 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  lifecycle           1.0.4     2023-11-07 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  listenv             0.9.0     2022-12-16 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  lubridate         * 1.9.3     2023-09-27 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  magrittr            2.0.3     2022-03-30 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  maps                3.4.1.1   2023-11-03 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  mapview           * 2.11.2    2023-10-13 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  MASS                7.3-60    2023-05-04 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  Matrix              1.6-1.1   2023-09-18 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  memoise             2.0.1     2021-11-26 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  mgcv                1.9-0     2023-07-11 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  mime                0.12      2021-09-28 [2] CRAN (R 4.3.1)</span></span>
<span><span class="co">##  mmod                1.3.3     2017-04-06 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  munsell             0.5.0     2018-06-12 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  mvtnorm             1.2-3     2023-08-25 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  nlme                3.1-163   2023-08-09 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  parallelly          1.36.0    2023-05-26 [2] CRAN (R 4.3.1)</span></span>
<span><span class="co">##  patchwork         * 1.1.3     2023-08-14 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  pegas               1.2       2023-02-23 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  permute             0.9-7     2022-01-27 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  pillar              1.9.0     2023-03-22 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  pkgconfig           2.0.3     2019-09-22 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  pkgdown             2.0.7     2022-12-14 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  plyr                1.8.9     2023-10-02 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  png                 0.1-8     2022-11-29 [2] CRAN (R 4.3.1)</span></span>
<span><span class="co">##  polyclip            1.10-6    2023-09-27 [2] CRAN (R 4.3.1)</span></span>
<span><span class="co">##  PopGenReport        3.1       2023-10-11 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  prettycode          1.1.0     2019-12-16 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  prettyunits         1.2.0     2023-09-24 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  processx            3.8.2     2023-06-30 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  progress            1.2.2     2019-05-16 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  promises            1.2.1     2023-08-10 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  proxy               0.4-27    2022-06-09 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  ps                  1.7.5     2023-04-18 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  purrr             * 1.0.2     2023-08-10 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  quadprog            1.5-8     2019-11-20 [2] CRAN (R 4.3.1)</span></span>
<span><span class="co">##  R.methodsS3         1.8.2     2022-06-13 [2] CRAN (R 4.3.1)</span></span>
<span><span class="co">##  R.oo                1.25.0    2022-06-12 [2] CRAN (R 4.3.1)</span></span>
<span><span class="co">##  R.utils             2.12.2    2022-11-11 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  R6                  2.5.1     2021-08-19 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  ragg                1.2.6     2023-10-10 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  raster              3.6-26    2023-10-14 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  rbibutils           2.2.16    2023-10-25 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  RColorBrewer        1.1-3     2022-04-03 [2] CRAN (R 4.3.1)</span></span>
<span><span class="co">##  Rcpp                1.0.11    2023-07-06 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  Rdpack              2.6       2023-11-08 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  readr             * 2.1.4     2023-02-10 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  reshape             0.8.9     2022-04-12 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  reshape2            1.4.4     2020-04-09 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  RgoogleMaps         1.5.1     2023-11-06 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  rlang               1.1.2     2023-11-04 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  rmarkdown           2.25      2023-09-18 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  rprojroot           2.0.4     2023-11-05 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  rstudioapi          0.15.0    2023-07-07 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  sass                0.4.7     2023-07-15 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  satellite           1.0.4     2021-10-12 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  scales              1.2.1     2022-08-20 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  seqinr              4.2-30    2023-04-05 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  sessioninfo       * 1.2.2     2021-12-06 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  sf                * 1.0-14    2023-07-11 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  shiny               1.7.5.1   2023-10-14 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  slimr             * 0.4.0     2023-12-18 [1] local</span></span>
<span><span class="co">##  SNPRelate         * 1.36.0    2023-10-24 [2] Bioconductor</span></span>
<span><span class="co">##  sp                  2.1-1     2023-10-16 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  spam                2.10-0    2023-10-23 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  StAMPP              1.6.3     2021-08-08 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  stringi             1.8.1     2023-11-13 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  stringr           * 1.5.1     2023-11-14 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  svglite             2.1.2     2023-10-11 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  systemfonts         1.0.5     2023-10-09 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  terra               1.7-55    2023-10-13 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  textshaping         0.3.7     2023-10-09 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  tibble            * 3.2.1     2023-03-20 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  tidyr             * 1.3.0     2023-01-24 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  tidyselect          1.2.0     2022-10-10 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  timechange          0.2.0     2023-01-11 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  tweenr              2.0.2     2022-09-06 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  tzdb                0.4.0     2023-05-12 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  units               0.8-4     2023-09-13 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  utf8                1.2.4     2023-10-22 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  uuid                1.1-1     2023-08-17 [2] CRAN (R 4.3.1)</span></span>
<span><span class="co">##  vctrs               0.6.4     2023-10-12 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  vegan               2.6-4     2022-10-11 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  viridisLite         0.4.2     2023-05-02 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  vroom               1.6.4     2023-10-02 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  withr               2.5.2     2023-10-30 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  xfun                0.41      2023-11-01 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  xtable              1.8-4     2019-04-21 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  yaml                2.3.7     2023-01-23 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">##  zeallot             0.1.0     2018-01-28 [2] CRAN (R 4.3.2)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  [1] F:/Rtemp/Rtmps3TqGx/temp_libpath5eb8694e531a</span></span>
<span><span class="co">##  [2] C:/R/R-4.3.2/library</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ──────────────────────────────────────────────────────────────────────────────</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Russell Dinnage, Stephen Sarre, Bernd Gruber, Richard Duncan.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
