<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Example: Multispecies Model • slimr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Advanced Example: Multispecies Model">
<meta property="og:description" content="slimr">
<meta property="og:image" content="https://rdinnager.github.io/slimr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">slimr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Custom_vis.html">Custom Live Plotting for SLiM</a>
    </li>
    <li>
      <a href="../articles/Main_manuscript_example_v2.html">Using slimr to investigate the population genetics of the Sandy Inland Mouse in the periodic rainfall environment of the Simpson Desert</a>
    </li>
    <li>
      <a href="../articles/multispecies.html">Advanced Example: Multispecies Model</a>
    </li>
    <li>
      <a href="../articles/simple_example_using_migration_and_fst.html">simple_example_using_migration_and_fst</a>
    </li>
    <li>
      <a href="../articles/installing_SLiM_for_slimr.html">How to Install SLiM for Use with slimr</a>
    </li>
    <li>
      <a href="../articles/simple_nucleotide_example.html">Simple Example of a Simulation using Nucleotides</a>
    </li>
    <li>
      <a href="../articles/slimrlang_intro.html">Introduction to slimr: Writing SLiM scripts from R</a>
    </li>
    <li>
      <a href="../articles/useful_tables.html">Useful slimr Tables</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rdinnager/slimr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Advanced Example: Multispecies Model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rdinnager/slimr/blob/HEAD/vignettes/articles/multispecies.Rmd" class="external-link"><code>vignettes/articles/multispecies.Rmd</code></a></small>
      <div class="hidden name"><code>multispecies.Rmd</code></div>

    </div>

    
    
<style type="text/css" scoped>
PRE.fansi SPAN {padding-top: .25em; padding-bottom: .25em};
</style>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rdinnager.github.io/slimr">slimr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Welcome to the slimr package for forward population genetics simulation in SLiM. For more information on SLiM please visit https://messerlab.org/slim/ .</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'slimr'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:methods':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     initialize</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     interaction</span></span></code></pre></div>
<p>This example is based on recipe 19.5 (spatial host-parasite model)
and 19.6 (evolutionary trait-matching host-parasite mode) from the SLiM
Manual, a spatial trait-matching host parasite model. We will use all of
the main <code>slimr</code> verbs in this model. We will then show how
<code>slimr</code> can be used in conjunction with SLiMGUI to aid in
model development.</p>
<p>For the purposes of modifying existing SLiM models in
<code>slimr</code>, we can use some neat <code>slimr</code>
functionality. <code>slimr</code> includes all of the recipes for SLiM
scripts found in the SLiM Manual. to look at one of the recipes you can
simply access the <code>slim_recipes</code>. Here we simply print out
the recipe from section 5.3.4 of the SLiM Manual:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">slim_recipes</span><span class="op">$</span><span class="va">`5.3.4`</span><span class="op">)</span></span>
<span><span class="co">#&gt; // Keywords: migration, dispersal, SLiMgui</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; initialize() {</span></span>
<span><span class="co">#&gt;  initializeMutationRate(1e-7);</span></span>
<span><span class="co">#&gt;  initializeMutationType("m1", 0.5, "f", 0.0);</span></span>
<span><span class="co">#&gt;  initializeMutationType("m2", 0.5, "f", 0.3);</span></span>
<span><span class="co">#&gt;  initializeGenomicElementType("g1", m1, 1.0);</span></span>
<span><span class="co">#&gt;  initializeGenomicElement(g1, 0, 99999);</span></span>
<span><span class="co">#&gt;  initializeRecombinationRate(1e-8);</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; 1 late() {</span></span>
<span><span class="co">#&gt;  mSide = 10; // number of subpops along one side of the grid</span></span>
<span><span class="co">#&gt;  for (i in 1:(mSide * mSide))</span></span>
<span><span class="co">#&gt;      sim.addSubpop(i, 500);</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt;  subpops = sim.subpopulations;</span></span>
<span><span class="co">#&gt;  for (x in 1:mSide)</span></span>
<span><span class="co">#&gt;      for (y in 1:mSide)</span></span>
<span><span class="co">#&gt;      {</span></span>
<span><span class="co">#&gt;          destID = (x - 1) + (y - 1) * mSide + 1;</span></span>
<span><span class="co">#&gt;          ds = subpops[destID - 1];</span></span>
<span><span class="co">#&gt;          if (x &gt; 1)   // left to right</span></span>
<span><span class="co">#&gt;              ds.setMigrationRates(destID - 1, runif(1, 0.0, 0.05));</span></span>
<span><span class="co">#&gt;          if (x &lt; mSide)   // right to left</span></span>
<span><span class="co">#&gt;              ds.setMigrationRates(destID + 1, runif(1, 0.0, 0.05));</span></span>
<span><span class="co">#&gt;          if (y &gt; 1)   // top to bottom</span></span>
<span><span class="co">#&gt;              ds.setMigrationRates(destID - mSide, runif(1, 0.0, 0.05));</span></span>
<span><span class="co">#&gt;          if (y &lt; mSide)   // bottom to top</span></span>
<span><span class="co">#&gt;              ds.setMigrationRates(destID + mSide, runif(1, 0.0, 0.05));</span></span>
<span><span class="co">#&gt;          </span></span>
<span><span class="co">#&gt;          // set up SLiMgui's population visualization nicely</span></span>
<span><span class="co">#&gt;          xd = ((x - 1) / (mSide - 1)) * 0.9 + 0.05;</span></span>
<span><span class="co">#&gt;          yd = ((y - 1) / (mSide - 1)) * 0.9 + 0.05;</span></span>
<span><span class="co">#&gt;          ds.configureDisplay(c(xd, yd), 0.4);</span></span>
<span><span class="co">#&gt;      }</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt;  // remove 25% of the subpopulations</span></span>
<span><span class="co">#&gt;  subpops[sample(0:99, 25)].setSubpopulationSize(0);</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt;  // introduce a beneficial mutation</span></span>
<span><span class="co">#&gt;  target_subpop = sample(sim.subpopulations, 1);</span></span>
<span><span class="co">#&gt;  sample(target_subpop.genomes, 10).addNewDrawnMutation(m2, 20000);</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; 10000 late() { sim.outputFixedMutations(); }</span></span></code></pre></div>
<p>SLiM recipes can be converted into <code>slimr_script</code> object
using the function <code><a href="../reference/as_slimr_script.html">as_slimr_script()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_script</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_slimr_script.html">as_slimr_script</a></span><span class="op">(</span><span class="va">slim_recipes</span><span class="op">$</span><span class="va">`5.3.4`</span><span class="op">)</span></span>
<span><span class="va">test_script</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; &lt;slimr_script[3]&gt;</span></span>
<span><span class="co">#&gt; block_init_1:initialize() {</span></span>
<span><span class="co">#&gt;     initializeMutationRate(1e-07);</span></span>
<span><span class="co">#&gt;     initializeMutationType("m1", 0.5, "f", asFloat(0));</span></span>
<span><span class="co">#&gt;     initializeMutationType("m2", 0.5, "f", 0.3);</span></span>
<span><span class="co">#&gt;     initializeGenomicElementType("g1", m1, asFloat(1));</span></span>
<span><span class="co">#&gt;     initializeGenomicElement(g1, 0, 99999);</span></span>
<span><span class="co">#&gt;     initializeRecombinationRate(1e-08);</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; block_2:1 late() {</span></span>
<span><span class="co">#&gt;     mSide = 10;</span></span>
<span><span class="co">#&gt;     for (i in 1:(mSide * mSide)) sim.addSubpop(i, 500);</span></span>
<span><span class="co">#&gt;     subpops = sim.subpopulations;</span></span>
<span><span class="co">#&gt;     for (x in 1:mSide) for (y in 1:mSide) {</span></span>
<span><span class="co">#&gt;         destID = (x - 1) + (y - 1) * mSide + 1;</span></span>
<span><span class="co">#&gt;         ds = subpops[destID - 1];</span></span>
<span><span class="co">#&gt;         if (x &gt; 1) ds.setMigrationRates(destID - 1, runif(1, asFloat(0), 0.05));</span></span>
<span><span class="co">#&gt;         if (x &lt; mSide) ds.setMigrationRates(destID + 1, runif(1, asFloat(0), 0.05));</span></span>
<span><span class="co">#&gt;         if (y &gt; 1) ds.setMigrationRates(destID - mSide, runif(1, asFloat(0), 0.05));</span></span>
<span><span class="co">#&gt;         if (y &lt; mSide) ds.setMigrationRates(destID + mSide, runif(1, asFloat(0), 0.05));</span></span>
<span><span class="co">#&gt;         xd = ((x - 1)/(mSide - 1)) * 0.9 + 0.05;</span></span>
<span><span class="co">#&gt;         yd = ((y - 1)/(mSide - 1)) * 0.9 + 0.05;</span></span>
<span><span class="co">#&gt;         ds.configureDisplay(c(xd, yd), 0.4);</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     subpops[sample(0:99, 25)] %.% setSubpopulationSize(0);</span></span>
<span><span class="co">#&gt;     target_subpop = sample(sim.subpopulations, 1);</span></span>
<span><span class="co">#&gt;     sample(target_subpop.genomes, 10) %.% addNewDrawnMutation(m2, 20000);</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; block_3:10000 late() {</span></span>
<span><span class="co">#&gt;     sim.outputFixedMutations();</span></span>
<span><span class="co">#&gt; }</span></span></code></pre>
<p>However, we cannot edit or modify a <code>slimr_script</code> once it
has been created. To edit and mix and match between different
<code>slimr_script</code> objects we need to be able to reconstruct the
<code>slimr_script()</code> call that could recreate the above.
<code>slimr</code> provides the <code>reconstruct</code> function for
this purpose:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="../reference/reconstruct.html">reconstruct</a></span><span class="op">(</span><span class="va">test_script</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; slim_script(</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     slim_block(initialize(),  {</span></span>
<span><span class="co">#&gt;         initializeMutationRate(1e-07)</span></span>
<span><span class="co">#&gt;         initializeMutationType("m1", 0.5, "f", asFloat(0))</span></span>
<span><span class="co">#&gt;         initializeMutationType("m2", 0.5, "f", 0.3)</span></span>
<span><span class="co">#&gt;         initializeGenomicElementType("g1", m1, asFloat(1))</span></span>
<span><span class="co">#&gt;         initializeGenomicElement(g1, 0, 99999)</span></span>
<span><span class="co">#&gt;         initializeRecombinationRate(1e-08)</span></span>
<span><span class="co">#&gt;     }),</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     slim_block(1, late(),  {</span></span>
<span><span class="co">#&gt;         mSide = 10</span></span>
<span><span class="co">#&gt;         for (i in 1:(mSide * mSide)) sim.addSubpop(i, 500)</span></span>
<span><span class="co">#&gt;         subpops = sim.subpopulations</span></span>
<span><span class="co">#&gt;         for (x in 1:mSide) for (y in 1:mSide) {</span></span>
<span><span class="co">#&gt;             destID = (x - 1) + (y - 1) * mSide + 1</span></span>
<span><span class="co">#&gt;             ds = subpops[destID - 1]</span></span>
<span><span class="co">#&gt;             if (x &gt; 1) ds.setMigrationRates(destID - 1, runif(1, asFloat(0), 0.05))</span></span>
<span><span class="co">#&gt;             if (x &lt; mSide) ds.setMigrationRates(destID + 1, runif(1, asFloat(0), 0.05))</span></span>
<span><span class="co">#&gt;             if (y &gt; 1) ds.setMigrationRates(destID - mSide, runif(1, asFloat(0), 0.05))</span></span>
<span><span class="co">#&gt;             if (y &lt; mSide) ds.setMigrationRates(destID + mSide, runif(1, asFloat(0), 0.05))</span></span>
<span><span class="co">#&gt;             xd = ((x - 1)/(mSide - 1)) * 0.9 + 0.05</span></span>
<span><span class="co">#&gt;             yd = ((y - 1)/(mSide - 1)) * 0.9 + 0.05</span></span>
<span><span class="co">#&gt;             ds.configureDisplay(c(xd, yd), 0.4)</span></span>
<span><span class="co">#&gt;         }</span></span>
<span><span class="co">#&gt;         subpops[sample(0:99, 25)] %.% setSubpopulationSize(0)</span></span>
<span><span class="co">#&gt;         target_subpop = sample(sim.subpopulations, 1)</span></span>
<span><span class="co">#&gt;         sample(target_subpop.genomes, 10) %.% addNewDrawnMutation(m2, 20000)</span></span>
<span><span class="co">#&gt;     }),</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     slim_block(10000, late(),  {</span></span>
<span><span class="co">#&gt;         sim.outputFixedMutations()</span></span>
<span><span class="co">#&gt;     })</span></span>
<span><span class="co">#&gt; )</span></span></code></pre></div>
<p>Now we can simply copy and paste that output into an R script, which
we can edit as we like. We can do the two steps above in a single step
using <code><a href="../reference/as_slimr_code.html">as_slimr_code()</a></code>, which takes a SLiM script as a
character vector and returns the <code>slimr</code> code equivalent, and
printing it to the console.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/as_slimr_code.html">as_slimr_code</a></span><span class="op">(</span><span class="va">slim_recipes</span><span class="op">$</span><span class="va">`5.3.4`</span><span class="op">)</span></span>
<span><span class="co">#&gt; slim_script(</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     slim_block(initialize(),  {</span></span>
<span><span class="co">#&gt;         initializeMutationRate(1e-07)</span></span>
<span><span class="co">#&gt;         initializeMutationType("m1", 0.5, "f", asFloat(0))</span></span>
<span><span class="co">#&gt;         initializeMutationType("m2", 0.5, "f", 0.3)</span></span>
<span><span class="co">#&gt;         initializeGenomicElementType("g1", m1, asFloat(1))</span></span>
<span><span class="co">#&gt;         initializeGenomicElement(g1, 0, 99999)</span></span>
<span><span class="co">#&gt;         initializeRecombinationRate(1e-08)</span></span>
<span><span class="co">#&gt;     }),</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     slim_block(1, late(),  {</span></span>
<span><span class="co">#&gt;         mSide = 10</span></span>
<span><span class="co">#&gt;         for (i in 1:(mSide * mSide)) sim.addSubpop(i, 500)</span></span>
<span><span class="co">#&gt;         subpops = sim.subpopulations</span></span>
<span><span class="co">#&gt;         for (x in 1:mSide) for (y in 1:mSide) {</span></span>
<span><span class="co">#&gt;             destID = (x - 1) + (y - 1) * mSide + 1</span></span>
<span><span class="co">#&gt;             ds = subpops[destID - 1]</span></span>
<span><span class="co">#&gt;             if (x &gt; 1) ds.setMigrationRates(destID - 1, runif(1, asFloat(0), 0.05))</span></span>
<span><span class="co">#&gt;             if (x &lt; mSide) ds.setMigrationRates(destID + 1, runif(1, asFloat(0), 0.05))</span></span>
<span><span class="co">#&gt;             if (y &gt; 1) ds.setMigrationRates(destID - mSide, runif(1, asFloat(0), 0.05))</span></span>
<span><span class="co">#&gt;             if (y &lt; mSide) ds.setMigrationRates(destID + mSide, runif(1, asFloat(0), 0.05))</span></span>
<span><span class="co">#&gt;             xd = ((x - 1)/(mSide - 1)) * 0.9 + 0.05</span></span>
<span><span class="co">#&gt;             yd = ((y - 1)/(mSide - 1)) * 0.9 + 0.05</span></span>
<span><span class="co">#&gt;             ds.configureDisplay(c(xd, yd), 0.4)</span></span>
<span><span class="co">#&gt;         }</span></span>
<span><span class="co">#&gt;         subpops[sample(0:99, 25)] %.% setSubpopulationSize(0)</span></span>
<span><span class="co">#&gt;         target_subpop = sample(sim.subpopulations, 1)</span></span>
<span><span class="co">#&gt;         sample(target_subpop.genomes, 10) %.% addNewDrawnMutation(m2, 20000)</span></span>
<span><span class="co">#&gt;     }),</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     slim_block(10000, late(),  {</span></span>
<span><span class="co">#&gt;         sim.outputFixedMutations()</span></span>
<span><span class="co">#&gt;     })</span></span>
<span><span class="co">#&gt; )</span></span></code></pre></div>
<p>Here is the <code>slimr</code> code to create recipes 19.5 and
19.6</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/as_slimr_code.html">as_slimr_code</a></span><span class="op">(</span><span class="va">slim_recipes</span><span class="op">$</span><span class="va">`19.5`</span><span class="op">)</span></span>
<span><span class="co">#&gt; slim_script(</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     slim_block(all = initialize(),  {</span></span>
<span><span class="co">#&gt;         defineConstant("K", 100)</span></span>
<span><span class="co">#&gt;         defineConstant("R", log(20))</span></span>
<span><span class="co">#&gt;         defineConstant("A", 0.015)</span></span>
<span><span class="co">#&gt;         defineConstant("SIDE", 10)</span></span>
<span><span class="co">#&gt;         defineConstant("S", SIDE * SIDE)</span></span>
<span><span class="co">#&gt;         defineConstant("N0_host", asInteger((135.6217 + 0.01) * S))</span></span>
<span><span class="co">#&gt;         defineConstant("N0_parasitoid", asInteger((109.301 + 0.01) * S))</span></span>
<span><span class="co">#&gt;         defineConstant("S_P", 0.5)</span></span>
<span><span class="co">#&gt;         defineConstant("S_H", 0.2)</span></span>
<span><span class="co">#&gt;         defineConstant("D_H", 0.2)</span></span>
<span><span class="co">#&gt;         defineConstant("CROSS_SCRIPT", "subpop.addCrossed(individual, mate);")</span></span>
<span><span class="co">#&gt;         initializeSLiMModelType("nonWF")</span></span>
<span><span class="co">#&gt;         initializeInteractionType(1, "xy", maxDistance = S_P)</span></span>
<span><span class="co">#&gt;         i1.setInteractionFunction("l", asFloat(1))</span></span>
<span><span class="co">#&gt;         initializeInteractionType(2, "xy", maxDistance = S_H)</span></span>
<span><span class="co">#&gt;         i2.setInteractionFunction("l", asFloat(1))</span></span>
<span><span class="co">#&gt;     }),</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     slim_block(host = initialize(),  {</span></span>
<span><span class="co">#&gt;         initializeSpecies(avatar = "🐛", color = "cornflowerblue")</span></span>
<span><span class="co">#&gt;         initializeSLiMOptions(dimensionality = "xy")</span></span>
<span><span class="co">#&gt;     }),</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     slim_block(parasitoid = initialize(),  {</span></span>
<span><span class="co">#&gt;         initializeSpecies(avatar = "🦟", color = "red")</span></span>
<span><span class="co">#&gt;         initializeSLiMOptions(dimensionality = "xy")</span></span>
<span><span class="co">#&gt;     }),</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     slim_block(all = 2, 250, first(),  {</span></span>
<span><span class="co">#&gt;         host_pop = host.subpopulations</span></span>
<span><span class="co">#&gt;         hosts = host_pop.individuals</span></span>
<span><span class="co">#&gt;         parasitoid_pop = parasitoid.subpopulations</span></span>
<span><span class="co">#&gt;         parasitoids = parasitoid_pop.individuals</span></span>
<span><span class="co">#&gt;         i1.evaluate(c(host_pop, parasitoid_pop))</span></span>
<span><span class="co">#&gt;         i2.evaluate(host_pop)</span></span>
<span><span class="co">#&gt;         parasitoid_density_byhost = i1.localPopulationDensity(hosts, parasitoid_pop)</span></span>
<span><span class="co">#&gt;         parasitoids.tag = 0</span></span>
<span><span class="co">#&gt;         parasitoids.setValue("PREY_POS", NULL)</span></span>
<span><span class="co">#&gt;         P_parasitized_byhost = 1 - exp(-A * parasitoid_density_byhost)</span></span>
<span><span class="co">#&gt;         killed = (runif(hosts.size()) &lt; P_parasitized_byhost)</span></span>
<span><span class="co">#&gt;         hosts.tag = asInteger(killed)</span></span>
<span><span class="co">#&gt;         preys = hosts[killed]</span></span>
<span><span class="co">#&gt;         for (prey in preys) {</span></span>
<span><span class="co">#&gt;             hunter = i1.drawByStrength(prey, 1, parasitoid_pop)</span></span>
<span><span class="co">#&gt;             preyPos = prey.spatialPosition</span></span>
<span><span class="co">#&gt;             preyPos = c(hunter.getValue("PREY_POS"), preyPos)</span></span>
<span><span class="co">#&gt;             hunter.tag = hunter.tag + 1</span></span>
<span><span class="co">#&gt;             hunter.setValue("PREY_POS", preyPos)</span></span>
<span><span class="co">#&gt;         }</span></span>
<span><span class="co">#&gt;         unhunted = hosts[!killed]</span></span>
<span><span class="co">#&gt;         host_density_by_unhunted = i2.localPopulationDensity(unhunted, host_pop)</span></span>
<span><span class="co">#&gt;         P_survives_by_unhunted = exp(-host_density_by_unhunted/K)</span></span>
<span><span class="co">#&gt;         survived = (runif(unhunted.size()) &lt; P_survives_by_unhunted)</span></span>
<span><span class="co">#&gt;         dead = unhunted[!survived]</span></span>
<span><span class="co">#&gt;         dead.tag = 1</span></span>
<span><span class="co">#&gt;     }),</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     slim_block(host = reproduction(),  {</span></span>
<span><span class="co">#&gt;         if (individual.tag != 0) return</span></span>
<span><span class="co">#&gt;         mate = i2.drawByStrength(individual)</span></span>
<span><span class="co">#&gt;         if (mate.size()) {</span></span>
<span><span class="co">#&gt;             litterSize = rpois(1, exp(R))</span></span>
<span><span class="co">#&gt;             if (litterSize &gt; 0) {</span></span>
<span><span class="co">#&gt;                 offspring = sapply(seqLen(litterSize), CROSS_SCRIPT)</span></span>
<span><span class="co">#&gt;                 positions = rep(individual.spatialPosition, litterSize)</span></span>
<span><span class="co">#&gt;                 positions = positions + rnorm(litterSize * 2, 0, D_H)</span></span>
<span><span class="co">#&gt;                 positions = p1.pointReflected(positions)</span></span>
<span><span class="co">#&gt;                 offspring.setSpatialPosition(positions)</span></span>
<span><span class="co">#&gt;             }</span></span>
<span><span class="co">#&gt;         }</span></span>
<span><span class="co">#&gt;     }),</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     slim_block(parasitoid = reproduction(),  {</span></span>
<span><span class="co">#&gt;         litterSize = individual.tag</span></span>
<span><span class="co">#&gt;         if (litterSize &gt; 0) {</span></span>
<span><span class="co">#&gt;             mate = i1.drawByStrength(individual)</span></span>
<span><span class="co">#&gt;             if (mate.size()) {</span></span>
<span><span class="co">#&gt;                 offspring = sapply(seqLen(litterSize), CROSS_SCRIPT)</span></span>
<span><span class="co">#&gt;                 offspring.setSpatialPosition(individual.getValue("PREY_POS"))</span></span>
<span><span class="co">#&gt;             }</span></span>
<span><span class="co">#&gt;         }</span></span>
<span><span class="co">#&gt;     }),</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     slim_block(all = 1, early(),  {</span></span>
<span><span class="co">#&gt;         host.addSubpop("p1", N0_host)</span></span>
<span><span class="co">#&gt;         p1.setSpatialBounds(c(0, 0, SIDE, SIDE))</span></span>
<span><span class="co">#&gt;         p1.individuals.setSpatialPosition(p1.pointUniform(N0_host))</span></span>
<span><span class="co">#&gt;         parasitoid.addSubpop("p2", N0_parasitoid)</span></span>
<span><span class="co">#&gt;         p2.setSpatialBounds(c(0, 0, SIDE, SIDE))</span></span>
<span><span class="co">#&gt;         p2.individuals.setSpatialPosition(p2.pointUniform(N0_parasitoid))</span></span>
<span><span class="co">#&gt;     }),</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     slim_block(host = survival(),  {</span></span>
<span><span class="co">#&gt;         return((individual.age == 0))</span></span>
<span><span class="co">#&gt;     }),</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     slim_block(parasitoid = survival(),  {</span></span>
<span><span class="co">#&gt;         return((individual.age == 0))</span></span>
<span><span class="co">#&gt;     }),</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     slim_block(all = 250, late(),  {</span></span>
<span><span class="co">#&gt;         </span></span>
<span><span class="co">#&gt;     })</span></span>
<span><span class="co">#&gt; )</span></span>
<span><span class="fu"><a href="../reference/as_slimr_code.html">as_slimr_code</a></span><span class="op">(</span><span class="va">slim_recipes</span><span class="op">$</span><span class="va">`19.6`</span><span class="op">)</span></span>
<span><span class="co">#&gt; slim_script(</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     slim_block(all = initialize(),  {</span></span>
<span><span class="co">#&gt;         defineConstant("K", 100)</span></span>
<span><span class="co">#&gt;         defineConstant("R", log(20))</span></span>
<span><span class="co">#&gt;         defineConstant("A", 0.015)</span></span>
<span><span class="co">#&gt;         defineConstant("S", 10^2)</span></span>
<span><span class="co">#&gt;         defineConstant("N0_host", asInteger((135.6217 + 0.01) * S))</span></span>
<span><span class="co">#&gt;         defineConstant("N0_parasitoid", asInteger((109.301 + 0.01) * S))</span></span>
<span><span class="co">#&gt;         defineConstant("S_M", asFloat(1))</span></span>
<span><span class="co">#&gt;         defineConstant("S_S", asFloat(2))</span></span>
<span><span class="co">#&gt;         initializeSLiMModelType("nonWF")</span></span>
<span><span class="co">#&gt;     }),</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     slim_block(host = initialize(),  {</span></span>
<span><span class="co">#&gt;         initializeSpecies(avatar = "🐛", color = "cornflowerblue")</span></span>
<span><span class="co">#&gt;         initializeMutationType("m1", 0.5, "n", asFloat(0), 0.1)</span></span>
<span><span class="co">#&gt;         initializeGenomicElementType("g1", m1, asFloat(1))</span></span>
<span><span class="co">#&gt;         initializeGenomicElement(g1, 0, 9999)</span></span>
<span><span class="co">#&gt;         initializeMutationRate(1e-07)</span></span>
<span><span class="co">#&gt;         initializeRecombinationRate(1e-08)</span></span>
<span><span class="co">#&gt;     }),</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     slim_block(parasitoid = initialize(),  {</span></span>
<span><span class="co">#&gt;         initializeSpecies(avatar = "🦟", color = "red")</span></span>
<span><span class="co">#&gt;         initializeMutationType("m2", 0.5, "n", asFloat(0), 0.1)</span></span>
<span><span class="co">#&gt;         initializeGenomicElementType("g2", m2, asFloat(1))</span></span>
<span><span class="co">#&gt;         initializeGenomicElement(g2, 0, 9999)</span></span>
<span><span class="co">#&gt;         initializeMutationRate(1e-07)</span></span>
<span><span class="co">#&gt;         initializeRecombinationRate(1e-08)</span></span>
<span><span class="co">#&gt;     }),</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     slim_block(host = mutationEffect(m1),  {</span></span>
<span><span class="co">#&gt;         return(asFloat(1))</span></span>
<span><span class="co">#&gt;     }),</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     slim_block(parasitoid = mutationEffect(m2),  {</span></span>
<span><span class="co">#&gt;         return(asFloat(1))</span></span>
<span><span class="co">#&gt;     }),</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     slim_block(all = 2, 10000, first(),  {</span></span>
<span><span class="co">#&gt;         hosts = host.subpopulations.individuals</span></span>
<span><span class="co">#&gt;         parasitoids = parasitoid.subpopulations.individuals</span></span>
<span><span class="co">#&gt;         x1 = hosts.size()/S</span></span>
<span><span class="co">#&gt;         x2 = parasitoids.size()/S</span></span>
<span><span class="co">#&gt;         host_values = hosts.tagF</span></span>
<span><span class="co">#&gt;         parasitoid_values = parasitoids.tagF</span></span>
<span><span class="co">#&gt;         mean_parasitoid = mean(parasitoid_values)</span></span>
<span><span class="co">#&gt;         scale = dnorm(asFloat(0), asFloat(0), S_M)</span></span>
<span><span class="co">#&gt;         host_match = dnorm(host_values, mean_parasitoid, S_M)/scale</span></span>
<span><span class="co">#&gt;         parasitoids.tag = 0</span></span>
<span><span class="co">#&gt;         P_parasitized_byhost = 1 - exp(-A * x2 * host_match)</span></span>
<span><span class="co">#&gt;         killed = rbinom(hosts.size(), 1, P_parasitized_byhost)</span></span>
<span><span class="co">#&gt;         hosts.tag = killed</span></span>
<span><span class="co">#&gt;         hunters = sapply(hosts[killed == 1], "sample(parasitoids, 1, " + "weights=dnorm(applyValue.tagF - parasitoid_values, asFloat(0.0), S_M));")</span></span>
<span><span class="co">#&gt;         for (hunter in hunters) hunter.tag = hunter.tag + 1</span></span>
<span><span class="co">#&gt;         survivors = hosts[killed == 0]</span></span>
<span><span class="co">#&gt;         P_survives = exp(-x1/K)</span></span>
<span><span class="co">#&gt;         survived = rbinom(survivors.size(), 1, P_survives)</span></span>
<span><span class="co">#&gt;         dead = survivors[survived == 0]</span></span>
<span><span class="co">#&gt;         dead.tag = 1</span></span>
<span><span class="co">#&gt;     }),</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     slim_block(host = reproduction(),  {</span></span>
<span><span class="co">#&gt;         if (individual.tag != 0) return</span></span>
<span><span class="co">#&gt;         litterSize = rpois(1, exp(R))</span></span>
<span><span class="co">#&gt;         if (litterSize &gt; 0) {</span></span>
<span><span class="co">#&gt;             mate = subpop.sampleIndividuals(1, exclude = individual)</span></span>
<span><span class="co">#&gt;             for (i in seqLen(litterSize)) subpop.addCrossed(individual, mate)</span></span>
<span><span class="co">#&gt;         }</span></span>
<span><span class="co">#&gt;     }),</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     slim_block(parasitoid = reproduction(),  {</span></span>
<span><span class="co">#&gt;         litterSize = individual.tag</span></span>
<span><span class="co">#&gt;         if (litterSize &gt; 0) {</span></span>
<span><span class="co">#&gt;             mate = subpop.sampleIndividuals(1, exclude = individual)</span></span>
<span><span class="co">#&gt;             for (i in seqLen(litterSize)) subpop.addCrossed(individual, mate)</span></span>
<span><span class="co">#&gt;         }</span></span>
<span><span class="co">#&gt;     }),</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     slim_block(all = 1, early(),  {</span></span>
<span><span class="co">#&gt;         host.addSubpop("p1", N0_host)</span></span>
<span><span class="co">#&gt;         parasitoid.addSubpop("p2", N0_parasitoid)</span></span>
<span><span class="co">#&gt;         log = community.createLogFile("host-parasite log.txt", logInterval = 1)</span></span>
<span><span class="co">#&gt;         log.addTick()</span></span>
<span><span class="co">#&gt;         log.addPopulationSize(host)</span></span>
<span><span class="co">#&gt;         log.addMeanSDColumns("host", "p1.individuals.tagF;")</span></span>
<span><span class="co">#&gt;         log.addPopulationSize(parasitoid)</span></span>
<span><span class="co">#&gt;         log.addMeanSDColumns("parasitoid", "p2.individuals.tagF;")</span></span>
<span><span class="co">#&gt;     }),</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     slim_block(all = early(),  {</span></span>
<span><span class="co">#&gt;         scale = dnorm(asFloat(0), asFloat(0), S_S)</span></span>
<span><span class="co">#&gt;         hosts = host.subpopulations.individuals</span></span>
<span><span class="co">#&gt;         phenotypes = hosts.sumOfMutationsOfType(m1)</span></span>
<span><span class="co">#&gt;         hosts.fitnessScaling = dnorm(phenotypes, asFloat(0), S_S)/scale</span></span>
<span><span class="co">#&gt;         hosts.tagF = phenotypes</span></span>
<span><span class="co">#&gt;         parasitoids = parasitoid.subpopulations.individuals</span></span>
<span><span class="co">#&gt;         phenotypes = parasitoids.sumOfMutationsOfType(m2)</span></span>
<span><span class="co">#&gt;         parasitoids.fitnessScaling = dnorm(phenotypes, asFloat(0), S_S)/scale</span></span>
<span><span class="co">#&gt;         parasitoids.tagF = phenotypes</span></span>
<span><span class="co">#&gt;         hosts[hosts.age &gt; 0] %.% fitnessScaling = asFloat(0)</span></span>
<span><span class="co">#&gt;         parasitoids[parasitoids.age &gt; 0] %.% fitnessScaling = asFloat(0)</span></span>
<span><span class="co">#&gt;     }),</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     slim_block(all = 10000, late(),  {</span></span>
<span><span class="co">#&gt;         </span></span>
<span><span class="co">#&gt;     })</span></span>
<span><span class="co">#&gt; )</span></span></code></pre></div>
<p>Combining aspects of the above two <code>slimr</code> scripts, and
adding <code>slimr</code> verb functionality gives a final full
model:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">n_gen</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span></span>
<span><span class="fu"><a href="../reference/slim_script.html">slim_script</a></span><span class="op">(</span></span>
<span></span>
<span>    <span class="fu"><a href="../reference/slim_block.html">slim_block</a></span><span class="op">(</span>all <span class="op">=</span> <span class="fu"><a href="../reference/callback_initialize.html">initialize</a></span><span class="op">(</span><span class="op">)</span>,  <span class="op">{</span></span>
<span>        <span class="fu"><a href="../reference/r_template_constant.html">r_template_constant</a></span><span class="op">(</span><span class="st">"K"</span>, <span class="fl">100</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="../reference/r_template_constant.html">r_template_constant</a></span><span class="op">(</span><span class="st">"R"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="../reference/r_template_constant.html">r_template_constant</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="fl">0.015</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="../reference/r_template_constant.html">r_template_constant</a></span><span class="op">(</span><span class="st">"SIDE"</span>, <span class="fl">10</span><span class="op">)</span></span>
<span>        <span class="fu">defineConstant</span><span class="op">(</span><span class="st">"S"</span>, <span class="va">SIDE</span> <span class="op">*</span> <span class="va">SIDE</span><span class="op">)</span></span>
<span>        <span class="fu">defineConstant</span><span class="op">(</span><span class="st">"N0_host"</span>, <span class="fu">asInteger</span><span class="op">(</span><span class="op">(</span><span class="fl">135.6217</span> <span class="op">+</span> <span class="fl">0.01</span><span class="op">)</span> <span class="op">*</span> <span class="va">S</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="fu">defineConstant</span><span class="op">(</span><span class="st">"N0_parasitoid"</span>, <span class="fu">asInteger</span><span class="op">(</span><span class="op">(</span><span class="fl">109.301</span> <span class="op">+</span> <span class="fl">0.01</span><span class="op">)</span> <span class="op">*</span> <span class="va">S</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="../reference/r_template_constant.html">r_template_constant</a></span><span class="op">(</span><span class="st">"S_P"</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="../reference/r_template_constant.html">r_template_constant</a></span><span class="op">(</span><span class="st">"S_H"</span>, <span class="fl">0.2</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="../reference/r_template_constant.html">r_template_constant</a></span><span class="op">(</span><span class="st">"D_H"</span>, <span class="fl">0.2</span><span class="op">)</span></span>
<span>        <span class="fu">defineConstant</span><span class="op">(</span><span class="st">"CROSS_SCRIPT"</span>, <span class="st">"subpop.addCrossed(individual, mate);"</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="../reference/initializeSLiMModelType.html">initializeSLiMModelType</a></span><span class="op">(</span><span class="st">"nonWF"</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="../reference/initializeInteractionType.html">initializeInteractionType</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"xy"</span>, maxDistance <span class="op">=</span> <span class="va">S_P</span><span class="op">)</span></span>
<span>        <span class="fu">i1.setInteractionFunction</span><span class="op">(</span><span class="st">"l"</span>, <span class="fu">asFloat</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="../reference/initializeInteractionType.html">initializeInteractionType</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"xy"</span>, maxDistance <span class="op">=</span> <span class="va">S_H</span><span class="op">)</span></span>
<span>        <span class="fu">i2.setInteractionFunction</span><span class="op">(</span><span class="st">"l"</span>, <span class="fu">asFloat</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span>,</span>
<span></span>
<span>    <span class="fu"><a href="../reference/slim_block.html">slim_block</a></span><span class="op">(</span>host <span class="op">=</span> <span class="fu"><a href="../reference/callback_initialize.html">initialize</a></span><span class="op">(</span><span class="op">)</span>,  <span class="op">{</span></span>
<span>        <span class="fu"><a href="../reference/initializeSpecies.html">initializeSpecies</a></span><span class="op">(</span>avatar <span class="op">=</span> <span class="st">"🐛"</span>, color <span class="op">=</span> <span class="st">"cornflowerblue"</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="../reference/initializeSLiMOptions.html">initializeSLiMOptions</a></span><span class="op">(</span>dimensionality <span class="op">=</span> <span class="st">"xy"</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span>,</span>
<span></span>
<span>    <span class="fu"><a href="../reference/slim_block.html">slim_block</a></span><span class="op">(</span>parasitoid <span class="op">=</span> <span class="fu"><a href="../reference/callback_initialize.html">initialize</a></span><span class="op">(</span><span class="op">)</span>,  <span class="op">{</span></span>
<span>        <span class="fu"><a href="../reference/initializeSpecies.html">initializeSpecies</a></span><span class="op">(</span>avatar <span class="op">=</span> <span class="st">"🦟"</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="../reference/initializeSLiMOptions.html">initializeSLiMOptions</a></span><span class="op">(</span>dimensionality <span class="op">=</span> <span class="st">"xy"</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="fu"><a href="../reference/slim_block.html">slim_block</a></span><span class="op">(</span>all <span class="op">=</span> <span class="fl">2</span>, <span class="op">!</span><span class="op">!</span><span class="va">n_gen</span>, <span class="fu"><a href="../reference/first.html">first</a></span><span class="op">(</span><span class="op">)</span>,  <span class="op">{</span></span>
<span>        <span class="va">host_pop</span> <span class="op">=</span> <span class="va">host.subpopulations</span></span>
<span>        <span class="va">hosts</span> <span class="op">=</span> <span class="va">host_pop.individuals</span></span>
<span>        <span class="va">parasitoid_pop</span> <span class="op">=</span> <span class="va">parasitoid.subpopulations</span></span>
<span>        <span class="va">parasitoids</span> <span class="op">=</span> <span class="va">parasitoid_pop.individuals</span></span>
<span>        <span class="fu">i1.evaluate</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">host_pop</span>, <span class="va">parasitoid_pop</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="fu">i2.evaluate</span><span class="op">(</span><span class="va">host_pop</span><span class="op">)</span></span>
<span>        <span class="va">parasitoid_density_byhost</span> <span class="op">=</span> <span class="fu">i1.localPopulationDensity</span><span class="op">(</span><span class="va">hosts</span>, <span class="va">parasitoid_pop</span><span class="op">)</span></span>
<span>        <span class="va">parasitoids.tag</span> <span class="op">=</span> <span class="fl">0</span></span>
<span>        <span class="fu">parasitoids.setValue</span><span class="op">(</span><span class="st">"PREY_POS"</span>, <span class="cn">NULL</span><span class="op">)</span></span>
<span>        <span class="va">P_parasitized_byhost</span> <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">A</span> <span class="op">*</span> <span class="va">parasitoid_density_byhost</span><span class="op">)</span></span>
<span>        <span class="va">killed</span> <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu">hosts.size</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">P_parasitized_byhost</span><span class="op">)</span></span>
<span>        <span class="va">hosts.tag</span> <span class="op">=</span> <span class="fu">asInteger</span><span class="op">(</span><span class="va">killed</span><span class="op">)</span></span>
<span>        <span class="va">preys</span> <span class="op">=</span> <span class="va">hosts</span><span class="op">[</span><span class="va">killed</span><span class="op">]</span></span>
<span>        <span class="kw">for</span> <span class="op">(</span><span class="va">prey</span> <span class="kw">in</span> <span class="va">preys</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">hunter</span> <span class="op">=</span> <span class="fu">i1.drawByStrength</span><span class="op">(</span><span class="va">prey</span>, <span class="fl">1</span>, <span class="va">parasitoid_pop</span><span class="op">)</span></span>
<span>            <span class="va">preyPos</span> <span class="op">=</span> <span class="va">prey.spatialPosition</span></span>
<span>            <span class="va">preyPos</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">hunter.getValue</span><span class="op">(</span><span class="st">"PREY_POS"</span><span class="op">)</span>, <span class="va">preyPos</span><span class="op">)</span></span>
<span>            <span class="va">hunter.tag</span> <span class="op">=</span> <span class="va">hunter.tag</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>            <span class="fu">hunter.setValue</span><span class="op">(</span><span class="st">"PREY_POS"</span>, <span class="va">preyPos</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="va">unhunted</span> <span class="op">=</span> <span class="va">hosts</span><span class="op">[</span><span class="op">!</span><span class="va">killed</span><span class="op">]</span></span>
<span>        <span class="va">host_density_by_unhunted</span> <span class="op">=</span> <span class="fu">i2.localPopulationDensity</span><span class="op">(</span><span class="va">unhunted</span>, <span class="va">host_pop</span><span class="op">)</span></span>
<span>        <span class="va">P_survives_by_unhunted</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">host_density_by_unhunted</span><span class="op">/</span><span class="va">K</span><span class="op">)</span></span>
<span>        <span class="va">survived</span> <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu">unhunted.size</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">P_survives_by_unhunted</span><span class="op">)</span></span>
<span>        <span class="va">dead</span> <span class="op">=</span> <span class="va">unhunted</span><span class="op">[</span><span class="op">!</span><span class="va">survived</span><span class="op">]</span></span>
<span>        <span class="va">dead.tag</span> <span class="op">=</span> <span class="fl">1</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Host Population Size: "</span>, <span class="fu">hosts.size</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Parasitoid Population Size: "</span>, <span class="fu">parasitoids.size</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span>,</span>
<span></span>
<span>    <span class="fu"><a href="../reference/slim_block.html">slim_block</a></span><span class="op">(</span>host <span class="op">=</span> <span class="fu"><a href="../reference/reproduction.html">reproduction</a></span><span class="op">(</span><span class="op">)</span>,  <span class="op">{</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">individual.tag</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="va">return</span></span>
<span>        <span class="va">mate</span> <span class="op">=</span> <span class="fu">i2.drawByStrength</span><span class="op">(</span><span class="va">individual</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu">mate.size</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">litterSize</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="va">litterSize</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="va">offspring</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu">seqLen</span><span class="op">(</span><span class="va">litterSize</span><span class="op">)</span>, <span class="va">CROSS_SCRIPT</span><span class="op">)</span></span>
<span>                <span class="va">positions</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">individual.spatialPosition</span>, <span class="va">litterSize</span><span class="op">)</span></span>
<span>                <span class="va">positions</span> <span class="op">=</span> <span class="va">positions</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">litterSize</span> <span class="op">*</span> <span class="fl">2</span>, <span class="fl">0</span>, <span class="va">D_H</span><span class="op">)</span></span>
<span>                <span class="va">positions</span> <span class="op">=</span> <span class="fu">p1.pointReflected</span><span class="op">(</span><span class="va">positions</span><span class="op">)</span></span>
<span>                <span class="fu">offspring.setSpatialPosition</span><span class="op">(</span><span class="va">positions</span><span class="op">)</span></span>
<span>            <span class="op">}</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">}</span><span class="op">)</span>,</span>
<span></span>
<span>    <span class="fu"><a href="../reference/slim_block.html">slim_block</a></span><span class="op">(</span>parasitoid <span class="op">=</span> <span class="fu"><a href="../reference/reproduction.html">reproduction</a></span><span class="op">(</span><span class="op">)</span>,  <span class="op">{</span></span>
<span>        <span class="va">litterSize</span> <span class="op">=</span> <span class="va">individual.tag</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">litterSize</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">mate</span> <span class="op">=</span> <span class="fu">i1.drawByStrength</span><span class="op">(</span><span class="va">individual</span><span class="op">)</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="fu">mate.size</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="va">offspring</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu">seqLen</span><span class="op">(</span><span class="va">litterSize</span><span class="op">)</span>, <span class="va">CROSS_SCRIPT</span><span class="op">)</span></span>
<span>                <span class="fu">offspring.setSpatialPosition</span><span class="op">(</span><span class="fu">individual.getValue</span><span class="op">(</span><span class="st">"PREY_POS"</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="op">}</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">}</span><span class="op">)</span>,</span>
<span></span>
<span>    <span class="fu"><a href="../reference/slim_block.html">slim_block</a></span><span class="op">(</span>all <span class="op">=</span> <span class="fl">1</span>, <span class="fu"><a href="../reference/early.html">early</a></span><span class="op">(</span><span class="op">)</span>,  <span class="op">{</span></span>
<span>        <span class="fu">host.addSubpop</span><span class="op">(</span><span class="st">"p1"</span>, <span class="va">N0_host</span><span class="op">)</span></span>
<span>        <span class="fu">p1.setSpatialBounds</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="va">SIDE</span>, <span class="va">SIDE</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="fu">p1.individuals.setSpatialPosition</span><span class="op">(</span><span class="fu">p1.pointUniform</span><span class="op">(</span><span class="va">N0_host</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="fu">parasitoid.addSubpop</span><span class="op">(</span><span class="st">"p2"</span>, <span class="va">N0_parasitoid</span><span class="op">)</span></span>
<span>        <span class="fu">p2.setSpatialBounds</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="va">SIDE</span>, <span class="va">SIDE</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="fu">p2.individuals.setSpatialPosition</span><span class="op">(</span><span class="fu">p2.pointUniform</span><span class="op">(</span><span class="va">N0_parasitoid</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span>,</span>
<span></span>
<span>    <span class="fu"><a href="../reference/slim_block.html">slim_block</a></span><span class="op">(</span>host <span class="op">=</span> <span class="fu"><a href="../reference/survival.html">survival</a></span><span class="op">(</span><span class="op">)</span>,  <span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">(</span><span class="va">individual.age</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span>,</span>
<span></span>
<span>    <span class="fu"><a href="../reference/slim_block.html">slim_block</a></span><span class="op">(</span>parasitoid <span class="op">=</span> <span class="fu"><a href="../reference/survival.html">survival</a></span><span class="op">(</span><span class="op">)</span>,  <span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">(</span><span class="va">individual.age</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span>,</span>
<span></span>
<span>    <span class="fu"><a href="../reference/slim_block.html">slim_block</a></span><span class="op">(</span>all <span class="op">=</span> <span class="op">!</span><span class="op">!</span><span class="va">n_gen</span>, <span class="fu"><a href="../reference/late.html">late</a></span><span class="op">(</span><span class="op">)</span>,  <span class="op">{</span></span>
<span>        <span class="fu">community.simulationFinished</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">hp_script</span></span>
<span></span>
<span><span class="va">hp_script</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; &lt;slimr_script[10]&gt;</span></span>
<span><span class="co">#&gt; block_init:species all  initialize() {</span></span>
<span><span class="co">#&gt;     defineConstant("K", ..K..);</span></span>
<span><span class="co">#&gt;     defineConstant("R", ..R..);</span></span>
<span><span class="co">#&gt;     defineConstant("A", ..A..);</span></span>
<span><span class="co">#&gt;     defineConstant("SIDE", ..SIDE..);</span></span>
<span><span class="co">#&gt;     defineConstant("S", SIDE * SIDE);</span></span>
<span><span class="co">#&gt;     defineConstant("N0_host", asInteger((135.6217 + 0.01) * S));</span></span>
<span><span class="co">#&gt;     defineConstant("N0_parasitoid", asInteger((109.301 + 0.01) * S));</span></span>
<span><span class="co">#&gt;     defineConstant("S_P", ..S_P..);</span></span>
<span><span class="co">#&gt;     defineConstant("S_H", ..S_H..);</span></span>
<span><span class="co">#&gt;     defineConstant("D_H", ..D_H..);</span></span>
<span><span class="co">#&gt;     defineConstant("CROSS_SCRIPT", "subpop.addCrossed(individual, mate);");</span></span>
<span><span class="co">#&gt;     initializeSLiMModelType("nonWF");</span></span>
<span><span class="co">#&gt;     initializeInteractionType(1, "xy", maxDistance = S_P);</span></span>
<span><span class="co">#&gt;     i1.setInteractionFunction("l", asFloat(1));</span></span>
<span><span class="co">#&gt;     initializeInteractionType(2, "xy", maxDistance = S_H);</span></span>
<span><span class="co">#&gt;     i2.setInteractionFunction("l", asFloat(1));</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; block_init:species host  initialize() {</span></span>
<span><span class="co">#&gt;     initializeSpecies(avatar = "🐛", color = "cornflowerblue");</span></span>
<span><span class="co">#&gt;     initializeSLiMOptions(dimensionality = "xy");</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; block_init:species parasitoid  initialize() {</span></span>
<span><span class="co">#&gt;     initializeSpecies(avatar = "🦟", color = "red");</span></span>
<span><span class="co">#&gt;     initializeSLiMOptions(dimensionality = "xy");</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; block_04:ticks all 2:1000 first() {</span></span>
<span><span class="co">#&gt;     host_pop = host.subpopulations;</span></span>
<span><span class="co">#&gt;     hosts = host_pop.individuals;</span></span>
<span><span class="co">#&gt;     parasitoid_pop = parasitoid.subpopulations;</span></span>
<span><span class="co">#&gt;     parasitoids = parasitoid_pop.individuals;</span></span>
<span><span class="co">#&gt;     i1.evaluate(c(host_pop, parasitoid_pop));</span></span>
<span><span class="co">#&gt;     i2.evaluate(host_pop);</span></span>
<span><span class="co">#&gt;     parasitoid_density_byhost = i1.localPopulationDensity(hosts, parasitoid_pop);</span></span>
<span><span class="co">#&gt;     parasitoids.tag = 0;</span></span>
<span><span class="co">#&gt;     parasitoids.setValue("PREY_POS", NULL);</span></span>
<span><span class="co">#&gt;     P_parasitized_byhost = 1 - exp(-A * parasitoid_density_byhost);</span></span>
<span><span class="co">#&gt;     killed = (runif(hosts.size()) &lt; P_parasitized_byhost);</span></span>
<span><span class="co">#&gt;     hosts.tag = asInteger(killed);</span></span>
<span><span class="co">#&gt;     preys = hosts[killed];</span></span>
<span><span class="co">#&gt;     for (prey in preys) {</span></span>
<span><span class="co">#&gt;         hunter = i1.drawByStrength(prey, 1, parasitoid_pop);</span></span>
<span><span class="co">#&gt;         preyPos = prey.spatialPosition;</span></span>
<span><span class="co">#&gt;         preyPos = c(hunter.getValue("PREY_POS"), preyPos);</span></span>
<span><span class="co">#&gt;         hunter.tag = hunter.tag + 1;</span></span>
<span><span class="co">#&gt;         hunter.setValue("PREY_POS", preyPos);</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     unhunted = hosts[!killed];</span></span>
<span><span class="co">#&gt;     host_density_by_unhunted = i2.localPopulationDensity(unhunted, host_pop);</span></span>
<span><span class="co">#&gt;     P_survives_by_unhunted = exp(-host_density_by_unhunted/K);</span></span>
<span><span class="co">#&gt;     survived = (runif(unhunted.size()) &lt; P_survives_by_unhunted);</span></span>
<span><span class="co">#&gt;     dead = unhunted[!survived];</span></span>
<span><span class="co">#&gt;     dead.tag = 1;</span></span>
<span><span class="co">#&gt;     cat("Host Population Size: ", hosts.size());</span></span>
<span><span class="co">#&gt;     cat("Parasitoid Population Size: ", parasitoids.size());</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; block_05:species host 1:1000 reproduction() {</span></span>
<span><span class="co">#&gt;     if (individual.tag != 0) return;</span></span>
<span><span class="co">#&gt;     mate = i2.drawByStrength(individual);</span></span>
<span><span class="co">#&gt;     if (mate.size()) {</span></span>
<span><span class="co">#&gt;         litterSize = rpois(1, exp(R));</span></span>
<span><span class="co">#&gt;         if (litterSize &gt; 0) {</span></span>
<span><span class="co">#&gt;             offspring = sapply(seqLen(litterSize), CROSS_SCRIPT);</span></span>
<span><span class="co">#&gt;             positions = rep(individual.spatialPosition, litterSize);</span></span>
<span><span class="co">#&gt;             positions = positions + rnorm(litterSize * 2, 0, D_H);</span></span>
<span><span class="co">#&gt;             positions = p1.pointReflected(positions);</span></span>
<span><span class="co">#&gt;             offspring.setSpatialPosition(positions);</span></span>
<span><span class="co">#&gt;         }</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; block_06:species parasitoid 1:1000 reproduction() {</span></span>
<span><span class="co">#&gt;     litterSize = individual.tag;</span></span>
<span><span class="co">#&gt;     if (litterSize &gt; 0) {</span></span>
<span><span class="co">#&gt;         mate = i1.drawByStrength(individual);</span></span>
<span><span class="co">#&gt;         if (mate.size()) {</span></span>
<span><span class="co">#&gt;             offspring = sapply(seqLen(litterSize), CROSS_SCRIPT);</span></span>
<span><span class="co">#&gt;             offspring.setSpatialPosition(individual.getValue("PREY_POS"));</span></span>
<span><span class="co">#&gt;         }</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; block_07:ticks all 1 early() {</span></span>
<span><span class="co">#&gt;     host.addSubpop("p1", N0_host);</span></span>
<span><span class="co">#&gt;     p1.setSpatialBounds(c(0, 0, SIDE, SIDE));</span></span>
<span><span class="co">#&gt;     p1.individuals.setSpatialPosition(p1.pointUniform(N0_host));</span></span>
<span><span class="co">#&gt;     parasitoid.addSubpop("p2", N0_parasitoid);</span></span>
<span><span class="co">#&gt;     p2.setSpatialBounds(c(0, 0, SIDE, SIDE));</span></span>
<span><span class="co">#&gt;     p2.individuals.setSpatialPosition(p2.pointUniform(N0_parasitoid));</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; block_08:species host 1:1000 survival() {</span></span>
<span><span class="co">#&gt;     return((individual.age == 0));</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; block_09:species parasitoid 1:1000 survival() {</span></span>
<span><span class="co">#&gt;     return((individual.age == 0));</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; block_10:ticks all 1000 late() {</span></span>
<span><span class="co">#&gt;     community.simulationFinished();</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; This slimr_script has templating in block(s) block_init for</span></span>
<span><span class="co">#&gt; variables K and R and A and SIDE and S_P</span></span>
<span><span class="co">#&gt; and S_H and D_H.</span></span></code></pre>
<p>Writing a multispecies model in <code>slimr</code> is simple. You
only have to use a single named argument in each
<code><a href="../reference/slim_block.html">slim_block()</a></code> call to specify the species to which the block
applies. You use <code>all</code> to specify that the block applies to
all species. Note in particular the use of
<code><a href="../reference/r_template_constant.html">r_template_constant()</a></code>, a variation of
<code><a href="../reference/r_template.html">r_template()</a></code> that inserts the templated variable into a
<code>defineConstant()</code> statement. <code>defineConstant()</code>
assigns the variable into a constant in the SLiM initialization block so
that it can be uses throughout any block of code in the simulation. It
also makes it easier to adjust parameter values manually within SLiMGUI
if we choose to test the model in SLiMGUI with its interactive
features.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slim_run.html">slim_run</a></span><span class="op">(</span><span class="va">hp_script</span>, progress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Russell Dinnage, Stephen Sarre, Bernd Gruber, Richard Duncan.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
